@model Net4Courier.Models.InvoiceAllParam
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="~/Content/NewCSS/plugins/jQuery/moment.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.43/js/bootstrap-datetimepicker.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.43/css/bootstrap-datetimepicker.min.css" />

<link href="/Content/Multiselect/bootstrap-multiselect.css" rel="stylesheet" />
<script src="/Content/Multiselect/bootstrap-multiselect.js"></script>
<style>
    textarea {
        width: 100%;
        resize: vertical;
        border-radius: 10px;
        border: 1px solid #ccc;
    }

    .searchdiv {
        background-color: #fff;
        width: 100%;
        margin: 0 auto;
        max-width: 500px;
        padding: 20px;
        margin-top: 50px;
        border-radius: 10px;
        box-shadow: 0 9px 23px rgba(0, 0, 0, 0.09), 0 5px 5px rgba(0, 0, 0, 0.06) !important;
    }

    .headinglabel {
        font-family: Calibri;
        font-size: 16px;
        color: #2b2929 !important;
    }
</style>
<style>
    #invoicesearch .row .col-md-1 {
        width: 12%;
    }

    #movementid + .btn-group button, #movementid + .btn-group {
        display: block;
        width: 100%;
    }

    #FormDate {
        border-radius: 10px;
    }
</style>

<script>
    //$(function () {
    //    $('#FromDate').datetimepicker({ format: 'DD-MM-YYYY' });

    //    $('#ToDate').datetimepicker({ format: 'DD-MM-YYYY' });

    //    $('#InvoiceDate').datetimepicker({ format: 'DD-MM-YYYY HH:mm' });

    //    var d = new Date();
    //    var curr_date = d.getDate();
    //    var curr_month = d.getMonth() + 1;
    //    var curr_year = d.getFullYear();

    //    var reqdate = curr_date + "-" + curr_month + "-" + curr_year + ' ' + d.getHours() + ':' + d.getMinutes();

    //    $('#InvoiceDate').val(reqdate);
    //});


    $(document).ready(function () {
        var startdate = '@Session["FyearFrom"].ToString()';
        var enddate = '@Session["FyearTo"].ToString()';
        var sd = new Date(startdate.split('-')[1] + '-' + startdate.split('-')[0] + '-' + startdate.split('-')[2]);
        var ed = new Date(enddate.split('-')[1] + '-' + enddate.split('-')[0] + '-' + enddate.split('-')[2]);
        $(function () {
            $('#FromDate').datetimepicker({
                maxDate: ed,
                minDate: sd,
                format: 'DD-MM-YYYY',
            });
        });
        $(function () {
            $('#ToDate').datetimepicker({
                maxDate: ed,
                minDate: sd,
                format: 'DD-MM-YYYY',
            });
        });
        $(function () {
            $('#InvoiceDate').datetimepicker({
                maxDate: ed,
                minDate: sd,
                format: 'DD-MM-YYYY HH:mm',
            });
        });
        var d = new Date();
        var curr_date = d.getDate();
        var curr_month = d.getMonth() + 1;
        var curr_year = d.getFullYear();

        var reqdate = curr_date + "-" + curr_month + "-" + curr_year + ' ' + d.getHours() + ':' + d.getMinutes();

        $('#InvoiceDate').val(reqdate);


              $.ajax({
                type: "Get",
                url: "/CustomerInvoice/GetCourierType",
                datatype: "Json",
                  success: function (response) {

                      var data = response.data;
                    $('#movementid').empty();

                    $.each(data, function (index, value) {

                        var o_st = $("#MovementId").val().split(",");

                        var flag = 0;
                        for (var j = 0 ; j < o_st.length; j++) {
                            debugger;
                                if (o_st[j] == value.MovementID) {
                                    flag = 1;
                                    break;
                                }

                        }

                        if (flag == 1) {
                            $('#movementid').append('<option value="' + value.MovementID + '" selected=true>' + value.MovementType + '</option>');
                        }
                        else {
                            $('#movementid').append('<option value="' + value.MovementID + '">' + value.MovementType + '</option>');
                        }

                    });



                      $('#movementid').multiselect({
                        nonSelectedText:'Select',
                        enableClickableOptGroups: true,
                        enableCollapsibleOptGroups: true,
                        enableFiltering: false,
                        includeSelectAllOption: true,
                        enableCaseInsensitiveFiltering: false,
                        selectAllValue: 'multiselect-all'
                      });


                }
              });

        $('#btngenerate').click(function () {
            debugger;

            if ($('#FromDate').val() == null || $('#FromDate').val() == '') {
                $('#FromDate').focus();
                alert('Select From Date!')
                return false;
            }
            if ($('#ToDate').val() == null || $('#ToDate').val() == '') {
                $('#ToDate').focus();
                alert('Select To Date!')
                return false;
            }

            if ($('#movementid').val() == null) {
                $('#movementid').focus();
                alert('Select Courier type!')
                return false;
            }
            if ($('#InvoiceDate').val() == null || $('#InvoiceDate').val() == '') {
                $('#InvoiceDate').focus();
                alert('Select Invoice Date!')
                return false;
            }


            var obj = {
                FromDate: $('#FromDate').val(),
                ToDate: $('#ToDate').val(),
                InvoiceDate: $('#InvoiceDate').val(),
                SelectedValues: $('#movementid').val(),

            }
            $('#imgloader').css('display', 'block');

            $.ajax({
                type: "POST",
                url: "/CustomerInvoice/GenerateInvoice",
                datatype: "Json",
                data: obj,
                success: function (response) {
                    if (response.status == "ok") {
                        alert(response.message);
                        $('#imgloader').css('display', 'none');
                        return;
                    }
                    else {
                        $('#imgloader').css('display', 'none');
                        alert(response.message);
                    }
                }

            });
        })

    });


    @*$('#MovementId').select2({
        data:@ViewBag.Movement,
        multiple: true
    });*@

</script>

<section class="content-header">
    <h1 class="headingfont">Generate Multiple Invoice</h1>
</section>
@using (Html.BeginForm("multipleinvoice", "CustomerInvoice", FormMethod.Post, new { @id = "invoiceall" }))
{
    @Html.AntiForgeryToken()


    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
<div class="searchdiv sm-width">
    <div class="row no-margin">
        <div class="form-group row">
            <div class="col-md-3">
                <label class="required headinglabel">From Date</label>
            </div>
            <div class="col-md-9">
                @Html.HiddenFor(model => model.MovementId)                
                @Html.TextBoxFor(model => model.FromDate, new { @class = "form-control text-right" })
            </div>

        </div>
    </div>
    <div class="row no-margin">

        <div class="form-group row">
            <div class="col-md-3">
                <label class="required headinglabel">To Date</label>
            </div>
            <div class="col-md-9">
                @Html.TextBoxFor(model => model.ToDate, new { @class = "form-control text-right" })
            </div>

        </div>
    </div>
    <div class="row no-margin">

        <div class="form-group row">
            <div class="col-md-3">
                <label class="headinglabel required ">Courier Type</label>

            </div>
            <div class="col-md-9">
                <select id="movementid" name="SelectedValues" multiple="multiple" class="form-control">
                    <option value=""></option>
                </select>
            </div>

        </div>
    </div>

    <div class="row no-margin">

        <div class="form-group row">
            <div class="col-md-3">
                <label class="headinglabel required ">Invoice Date</label>
            </div>
            <div class="col-md-9">                
                @Html.TextBoxFor(model => model.InvoiceDate, new { @class = "form-control text-right" })
            </div>
        </div>
    </div>


    <div class="row no-margin" style="padding-top:10px">
        <div class="col-md-10" style="text-align:right;padding:10px">
            <input type="button" value="Generate" class="btn btn-primary" id="btngenerate" />
        </div>
        <div class="col-md-2" style="padding-top:13px">
            <img id="imgloader" src="~/Content/img/loading-gif-free-download-6.gif" style="width:35px;height:35px;display:none" />
        </div>
    </div>
</div>

    }


