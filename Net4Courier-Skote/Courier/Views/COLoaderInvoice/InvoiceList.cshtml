@model Net4Courier.Models.AgentInvoiceVM
@{
    int i = 0;
    var _decimal = @Session["Decimal"].ToString();
}
<script type="text/javascript">
    function redrawgrid(obj) {
        debugger;
        var awbno = $(obj).attr('awbno');
        var statuschecked = $(obj).prop('checked');

        $.ajax({
            type: "POST",
            url: "/COLoaderInvoice/ShowItemListSelect",
            datatype: "html",
            data: { AWBNo: awbno, statuschecked: statuschecked },
            success: function (response) {
                $("#listContainer").html(response);
                ValidateTotal();
            }
        });
    }
    function redrawgridall() {
        debugger;
        var customer = 0;
        var statuschecked = $('#Selectall').prop('checked');

        $.ajax({
            type: "POST",
            url: "/COLoaderInvoice/ShowItemListSelect",
            datatype: "html",
            data: { AWBNo: '', statuschecked: statuschecked },
            success: function (response) {
                $("#listContainer").html(response);
                setTimeout(function () {
                    $('#Selectall').prop('checked', statuschecked);
                    ValidateTotal();
                }, 300)

            }
        });
    }
    $(document).ready(function () {


        var table1 = $('#DetailsTable').DataTable({ "paging": false, "sPaginationType": "simple" });

        //table1.columns().every(function () {
        //    var that = this;

        //    $('input', this.footer()).on('keyup change', function () {
        //        if (that.search() !== this.value) {
        //            that
        //                .search(this.value)
        //                .draw();
        //        }
        //    });
        //});
    });
</script>
<table class="table table-bordered mb-0" id="details" style="width:100%">
    <thead class="table-light">
    <th style="text-align:center">
        SNo.
        All  <input type="checkbox" style="width:20px;" class="Selectall" id="Selectall" value="0" name="Selectall" onchange="redrawgridall()" />
    </th>
    <th width="10%">AWB No.</th>
    <th width="10%">AWB Date</th>
    <th width="40%">Consignee</th>
    <th width="20%" >Destination Country</th>
    <th width="10%">Courier Charge</th>
    <th width="10%">Other Charge</th>
    <th width="5%">VAT</th>
    <th width="5%">Surcharge %</th>
    <th width="5%">Fuel Surcharge</th>
    <th width="10%">Total Charge</th>

    </thead>
    <tbody class="input-table">

        @foreach (var item in Model.Details)
        {
            <tr>
                <td>
                    @Html.HiddenFor(model => model.Details[i].AgentInvoiceDetailID, new { @Value = @item.AgentInvoiceDetailID, @id = "hdnCustomerInvoiceDetailID_" + @i })
                    @Html.HiddenFor(model => model.Details[i].AgentInvoiceID, new { @Value = @item.AgentInvoiceID })
                    @Html.HiddenFor(model => model.Details[i].AWBNo, new { @Value = @item.AWBNo, @id = "hdnAWBNo_" + @i })
                    @Html.HiddenFor(model => model.Details[i].ShipmentID, new { @Value = @item.ShipmentID, @id = "hdnShipmentID_" + @i })
                    @Html.HiddenFor(model => model.Details[i].InscanID, new { @Value = @item.InscanID, @id = "hdnInscanID_" + @i })
                    @Html.HiddenFor(model => model.Details[i].CourierCharge, new { @Value = @item.CourierCharge, @id = "hdnCourierCharge_" + @i })
                    @Html.HiddenFor(model => model.Details[i].CustomCharge, new { @Value = @item.CustomCharge, @id = "hdnCustomCharge_" + @i })
                    @Html.HiddenFor(model => model.Details[i].OtherCharge, new { @Value = @item.OtherCharge, @id = "hdnOtherCharge_" + @i })
                    @Html.HiddenFor(model => model.Details[i].NetValue, new { @id = "hdnTotalCharge_" + @i })
                    @Html.HiddenFor(model => model.Details[i].VATAmount, new { @id = "hdnVatAmount_" + @i })
                    @Html.HiddenFor(model => model.Details[i].FuelSurcharge, new { @id = "hdnSurCharge_" + @i })
                    @Html.HiddenFor(model => model.Details[i].SurchargePercent, new { @id = "hdnSurchargePercent_" + @i })

                    @(i + 1)
                    @Html.CheckBoxFor(model => model.Details[i].AWBChecked, new { @class = "checkfilter calfield", style = "margin-left:10px;", @id = "hdnawbchecked_" + @i, @awbno = @item.AWBNo, @onchange = "redrawgrid(this)" })


                </td>
                <td>
                    @item.AWBNo
                </td>
                <td>
                    @Net4Courier.Models.CommonFunctions.GetShortDateFormat(@item.AWBDateTime)
                </td>
                <td>
                    @item.ConsigneeName
                </td>
                <td>
                    @item.ConsigneeCountryName
                </td>
                <td class="text-right">
                    @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.CourierCharge, _decimal)
                </td>
                <td class="text-right">
                    @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.OtherCharge, _decimal)
                </td>
                <td class="text-right">
                    @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.VATAmount, _decimal)
                </td>
                <td class="text-right">
                    @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.SurchargePercent, _decimal)
                </td>
                <td class="text-right">
                    @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.FuelSurcharge, _decimal)
                </td>
                <td class="text-right">
                    @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.NetValue, _decimal)
                </td>
            </tr>
            i++;
        }
    </tbody>
    <tfoot style="background-color:#dedede;color:blue">
        <tr class="charegRow">
            <td colspan="5" class="text-md-end"><b>Total</b></td>
            <td class="text-right"><label class="headinglabel" id="lblcouriercharge">@Net4Courier.Models.CommonFunctions.GetFormatNumber(@Model.TotalCourierCharge, _decimal)</label></td>
            <td class="text-right"><label class="headinglabel" id="lblothercharge">@Net4Courier.Models.CommonFunctions.GetFormatNumber(@Model.OtherCharge, _decimal)</label></td>
            <td class="text-right"><label class="headinglabel" id="lbltaxamount">@Net4Courier.Models.CommonFunctions.GetFormatNumber(@Model.ChargeableWT, _decimal)</label></td>
            <td></td>
            <td class="text-right"><label class="headinglabel" id="lblfuelamount">@Net4Courier.Models.CommonFunctions.GetFormatNumber(@Model.FuelAmt, _decimal)</label></td>
            <td class="text-right"> <label class="headinglabel" id="lbltotalcharge">@Net4Courier.Models.CommonFunctions.GetFormatNumber(@Model.TotalCharges, _decimal)</label></td>
        </tr>



        <tr class="charegRow">
            <td colspan="6"></td>
            <td colspan="2">Admin Amount (+)</td>
            <td class="text-right"><label class="headinglabel" id="lbladminpercent">@Net4Courier.Models.CommonFunctions.GetFormatNumber(@Model.AdminPer, _decimal)</label></td>
            <td></td>
            <td class="text-right"><label class="headinglabel" id="lbladminamount">@Net4Courier.Models.CommonFunctions.GetFormatNumber(@Model.AdminAmt, _decimal)</label></td>
        </tr>

        <tr class="charegRow">
            <td colspan="6"></td>
            <td colspan="2">Clearance Charge(+)</td>
            <td></td>
            <td></td>
            <td class="text-right"> <label class="headinglabel" id="lblclearancecharge">@Net4Courier.Models.CommonFunctions.GetFormatNumber(@Model. ClearingCharge, _decimal)</label></td>
        </tr>
        <tr class="charegRow">
            <td colspan="6"></td>
            <td colspan="2">Discount(-)</td>
            <td></td>
            <td></td>
            <td class="text-right"> <label class="headinglabel" id="lbldiscount">@Net4Courier.Models.CommonFunctions.GetFormatNumber(@Model.Discount, _decimal)</label></td>
        </tr>
        <tr class="charegRow">
            <td colspan="6"></td>
            <td colspan="2"><b>Net Invoice Total   </b></td>
            <td></td>
            <td> </td>
            <td class="text-right"> <label class="headinglabel" style="font-weight:600" id="lblinvoicetotal">@Net4Courier.Models.CommonFunctions.GetFormatNumber(@Model.InvoiceTotal, _decimal)   @Model.InvoiceTotal</label></td>
        </tr>
    </tfoot>
</table>
<style>
    .charegRow td{
        padding: 5px 10px;
    }
</style>
<script>
    $(document).ready(function () {


        $("#Selectall").change(function () {
            var i = 0;
            debugger;
            var selectall = false;
            if ($(this).prop("checked") == true) {
                i = 1;
                selectall = true;
                $("#listContainer tbody tr").addClass('Selected');
                $(".checkfilter").prop('checked', true);
            } else {
                $("#listContainer tbody tr").removeClass('Selected');
                $(".checkfilter").prop('checked', false);
                selectall = false;
            }


            var maxrow = $('#inputtable > tr').length;
            for (var i = 0; i < maxrow; i++) {
                $('#awbchecked_' + i).attr('checked', selectall);
                if ((i+1) == maxrow) {
                    debugger;
                    gettotal();
                }
            }

        });
        $('.checkfilter').click(function () {
            gettotal();
        })
        $('.calfield').change(function () {
            gettotal();

        })
        @*$(".checkfilter").change(function () {

            var id = this.id;
            var countryid = id.split('_');
            if ($(this).prop("checked") == true) {
                $("#listContainer tbody tr[id=" + countryid[1] + "]").addClass('Selected');

            } else {
                $("#listContainer tbody tr[id=" + countryid[1] + "]").removeClass('Selected');
                $("#Selectall").prop('checked', false);
            }

             var fullform = $('form#customerInvoice').serialize();
            var cust = JSON.stringify(fullform);

              $.ajax({
                type: 'POST',
                url: '@Url.Action("GetTotalCharge", "CustomerInvoice")?Id=' + $('#CustomerID').val(),
                datatype: "json",
                data: cust ,
                success: function (response) {
                    console.log(response.data);
                    var _custdata = response.data;
                    $('#lbltotalcharge').html(addCommas(parseFloat(_custdata.TotalCharges).toFixed(@_decimal)));
                    $('#lbladminpercent').html(addCommas(parseFloat(_custdata.AdminPer).toFixed(@_decimal)));
                    $('#lbltaxpercent').html(addCommas(parseFloat(_custdata.CustomerInvoiceTax).toFixed(@_decimal)));
                    $('#lblfuelpercent').html(addCommas(parseFloat(_custdata.FuelPer).toFixed(@_decimal)));
                    $('#lblothercharge').html(addCommas(parseFloat(_custdata.OtherCharge).toFixed(@_decimal)));

                    $('#AdminAmt').val(addCommas(parseFloat(_custdata.AdminAmt).toFixed(@_decimal)));
                    $('#FuelAmt').val(addCommas(parseFloat(_custdata.FuelAmt).toFixed(@_decimal)));
                    $('#ChargeableWT').val(addCommas(parseFloat(_custdata.ChargeableWT).toFixed(@_decimal)));
                    $('#InvoiceTotal').val(addCommas(parseFloat(_custdata.InvoiceTotal).toFixed(@_decimal)));
                    $('#lbladminamount').html(addCommas(parseFloat(_custdata.AdminAmt).toFixed(@_decimal)));
                    $('#lbltaxamount').html(addCommas(parseFloat(_custdata.ChargeableWT).toFixed(@_decimal)));
                    $('#lblfuelamount').html(addCommas(parseFloat(_custdata.FuelAmt).toFixed(@_decimal)));
                    $('#lblinvoicetotal').html(addCommas(parseFloat(_custdata.InvoiceTotal).toFixed(@_decimal)));
                }
            });
        });*@
    });

</script>
