@model Net4Courier.Models.ShipmentInvoiceVM


@{
    int i = 0;
    var _decimal = @Session["Decimal"].ToString();
    Layout = "~/Views/Shared/_Layout.cshtml";
}




<script type="text/javascript">
    function ExportExcelNew() {
        debugger;
        var d = new Date();
        var curr_date = d.getDate();
        var curr_month = d.getMonth() + 1;
        var curr_year = d.getFullYear();
        //$('#CustomerInvoiceNo').val();
        var reqdate = $('#InvoiceNo').val() + "_" + curr_date.toString() + curr_month.toString() + curr_year.toString();// + '_' + d.getHours() + d.getMinutes();
        $("#divreportNew").table2excel({
            filename: "VatInvoice_" + reqdate + ".xls"
        });


    }

    function printDiv() {
        var divid = "divreportNew"
        var contents = document.getElementById(divid).innerHTML;
        var frame1 = document.createElement('iframe');
        frame1.name = "frame1";
        frame1.style.position = "absolute";
        frame1.style.top = "-1000000px";
        document.body.appendChild(frame1);
        var frameDoc = frame1.contentWindow ? frame1.contentWindow : frame1.contentDocument.document ? frame1.contentDocument.document : frame1.contentDocument;
        frameDoc.document.open();
        frameDoc.document.write('<html><head><title>DIV Contents</title>');
        frameDoc.document.write('</head><body>');
        frameDoc.document.write(contents);
        frameDoc.document.write('</body></html>');
        frameDoc.document.close();
        setTimeout(function () {
            window.frames["frame1"].focus();
            window.frames["frame1"].print();
            document.body.removeChild(frame1);
        }, 500);
        return false;
    }
    $(document).ready(function () {







        $('#btnprint').click(function () {


            var obj = [];
            var shipmentdetailids = '';
            var maxrow = $('#listbody > tr').length;
            $('#btnprint').attr('disabled', 'disabled');
            for (i = 0; i < maxrow; i++) {
                debugger;
                //var deleted = $('#hdndeleted_' + i).val();
                var checked = $('#hdnawbchecked_' + i).prop('checked');

                if (checked) {

                    if (shipmentdetailids == '') {
                        shipmentdetailids = $('#hdnawbchecked_' + i).attr('shipmentdetailid');
                    }
                    else {
                        shipmentdetailids = shipmentdetailids + ',' + $('#hdnawbchecked_' + i).attr('shipmentdetailid');
                    }
                }


                if (maxrow == (i + 1) && shipmentdetailids != '') {
                    $('#btnprint').removeAttr('disabled');
                    var printurl = "/TaxInvoice/InvoicePrint?id=" + $('#ShipmentInvoiceID').val() + "&Details=" + shipmentdetailids;
                    window.open(printurl, '_blank');

                    //$.ajax({
                    //    type: "POST",
                    //    url: "/TaxInvoice/InvoicePrintSelected",
                    //    datatype: "Json",
                    //    data: {
                    //        id: $('#ShipmentInvoiceID').val(), AWBDetails: JSON.stringify(obj)
                    //    } ,
                    //    success: function (response) {
                    //        $.notify("VAT Invoice Saved Succesfully!", "success");
                    //        $('#btnprint').removeAttr('disabled');
                    //        window.location = "/TaxInvoice/Index";
                    //    }
                    //});
                }
                else if (maxrow == (i + 1) && shipmentdetailids == '') {
                    $.notify('Select Invoice Detail to Print!');
                    return;
                }
            }

        });




    });

</script>




<div class="row no-margin" style="padding-top: 10px">
    <div class="col-md-12 text-md-end">
        <button type="button" value="" class="btn btn-success" onclick="ExportExcelNew()"><i class="mdi mdi-file-excel font-size-16"></i></button>
        <button type="button" value="Print" class="btn btn-warning" onclick="printDiv()"><i class="mdi mdi-file-pdf font-size-16"></i></button>
        @*@Html.ActionLink("Create", "TaxInvoice",  new { @id = Model.ShipmentInvoiceID, @class = "btn btn-primary" })*@
        <a class="btn btn-primary waves-effect waves-light   text-md-end" href="/TaxInvoice/Create?id=@Model.ShipmentInvoiceID"><i class="mdi mdi-plus me-1"></i> Edit</a>
        @Html.ActionLink("Cancel", "Index", null, new { @class = "btn btn-secondary" })
    </div>
</div>

@using (Html.BeginForm("Details", "TaxInvoice", FormMethod.Post, new { @id = "taxinvoice" }))
{
    @Html.AntiForgeryToken()

    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    @Html.HiddenFor(model => model.ShipmentInvoiceID, new { })
    @Html.HiddenFor(model => model.InvoiceNo, new { })
<div class="card">
    <div class="card-body">
        <div id="divreportNew">
            <table class="table table-bordered">
                <tr>
                    <th colspan="2">
                        Invoice No.
                    </th>
                    <th colspan="2">
                        Invoice Date
                    </th>
                    <th colspan="2">
                        MAWB
                    </th>
                    <th colspan="4"></th>
                </tr>
                <tr>
                    <td colspan="2">
                        @Model.InvoiceNo
                    </td>
                    <td colspan="2">
                        @Model.InvoiceDate
                    </td>
                    <td colspan="2">
                        @Model.MAWB
                    </td>
                    <td colspan="4">

                    </td>
                </tr>
                <tr>
                    <th>AWB No.</th>
                    <th>AWB Date</th>
                    <th>Bag</th>
                    <th>Shipper</th>
                    <th>Receiver</th>
                    <th>Customs Value</th>
                    <th>Currency</th>
                    <th>Ex.Rate</th>
                    <th>Invoice Value</th>
                  
                    <th>Tax %</th>
                    <th>Tax Amount</th>
                    <th>Admin Charges</th>
                </tr>


                @foreach (var item in Model.Details)
                {
                    <tr>
                        <td>
                            @item.AWBNo
                        </td>
                        <td>@Net4Courier.Models.CommonFunctions.GetShortDateFormat(@item.AWBDate)</td>
                        <td>@item.BagNo</td>
                        <td>
                            @item.Shipper
                        </td>
                        <td>
                            @item.Receiver
                        </td>
                        <td style="text-align:right">
                            @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.CustomValue, "2")
                        </td>
                        <td>
                            @item.CurrencyName
                        </td>
                        <td>@Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.ExchangeRate, "3")</td>
                        <td style="text-align:right">
                            @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.InvoiceValue, _decimal)
                        </td>

                        <td style="text-align:right">

                            @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.TaxP, _decimal)

                        </td>
                        <td style="text-align:right">

                            @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.Tax, _decimal)
                        </td>
                        <td style="text-align:right">
                            @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.adminCharges, _decimal)
                        </td>
                    </tr>
                    i++;
                }





            </table>
        </div>
    </div>
</div>

}

@section scripts{


    <script src="~/Content/plugins/excel/jquery.table2excel.js"></script>
}