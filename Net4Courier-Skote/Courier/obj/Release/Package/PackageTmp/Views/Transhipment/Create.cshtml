@model Net4Courier.Models.ImportManifestVM
@{
    ViewBag.Title = "Create";
    ViewBag.pTitle = "Transhipment Upload";
    ViewBag.pageTitle = "Transhipment Upload";
    Layout = "~/Views/Shared/_Layout.cshtml";

    //var cities = (IEnumerable<CourierMVC.EntityFramework.S_CityMaster>)ViewBag.Cities;
}
<style>


    .reve_rates > input {
        font-size: 12px !important;
    }

    .reve_rates1 > input {
        font-size: 12px !important;
    }

    .reve_rates2 > input {
        font-size: 12px !important;
    }



    .reve_rates3 > textarea {
        min-height: 4rem !important;
        font-size: 12px !important;
    }
</style>

<script>
    //Origin and Destination City  Autocomplete code
    $(document).ready(function () {

        $('#OriginAirportCity').autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "@Url.Action("GetCityList", "ZoneChart")",
                    data: { SearchText: request.term },
                    dataType: "json",
                    type: "GET",
                    success: function (data) {
                        response($.map(data, function (val, item) {
                            return {
                                label: val.City,
                                value: val.City,
                                Country: val.CountryName
                            }
                        }))
                    }
                });
            },
            minLength: 1,
            autoFocus: false,
            select: function (event, ui) {
                event.preventDefault();
                $('#OriginAirportCity').val(ui.item.label);

                return false;
            },
            focus: function (event, ui) {
                $('#OriginAirportCity').val(ui.item.label);

                return false;
            }
        });

        $('#DestinationAirportCity').autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "@Url.Action("GetCityList", "ZoneChart")",
                    data: { SearchText: request.term },
                    dataType: "json",
                    type: "GET",
                    success: function (data) {
                        response($.map(data, function (val, item) {
                            return {
                                label: val.City,
                                value: val.City,
                                Country: val.CountryName
                            }
                        }))
                    }
                });
            },
            minLength: 1,
            autoFocus: false,
            select: function (event, ui) {
                event.preventDefault();
                $('#DestinationAirportCity').val(ui.item.label);

                return false;
            },
            focus: function (event, ui) {
                $('#DestinationAirportCity').val(ui.item.label);

                return false;
            }
        });
        @*//ConsignorLocationName
        $("#OriginAirportCity").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "@Url.Action("GetEventVenuesList", "ZoneChart")",
                    data: { SearchText: request.term },
                    dataType: "json",
                    type: "GET",
                    success: function (data) {
                        if (data.length == 0) {
                            //$('#EventVenueId').val("");
                            //$('#VenueLocationMesssage').show();
                            return false;
                        }
                        else {
                            response($.map(data, function (item) {
                                return {
                                    label: item.description,
                                    value: item.place_id
                                }
                            }));
                        }
                    },
                    error: function (x, y, z) {
                        alert('error');
                    }
                });
            },
            messages: {
                noResults: "", results: ""
            },
            select: function (event, ui) {
                $('#OriginAirportCity').val(ui.item.label);

                return false;
            },
            focus: function (event, ui) {
                $('#OriginAirportCity').val(ui.item.label);

                return false;
            }
        });
        //ConsigneeLocationName
        $("#DestinationAirportCity").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "@Url.Action("GetEventVenuesList", "ZoneChart")",
                    data: { SearchText: request.term },
                    dataType: "json",
                    type: "GET",
                    success: function (data) {
                        if (data.length == 0) {
                            //$('#EventVenueId').val("");
                            //$('#VenueLocationMesssage').show();
                            return false;
                        }
                        else {
                            response($.map(data, function (item) {
                                return {
                                    label: item.description,
                                    value: item.place_id
                                }
                            }));
                        }
                    },
                    error: function (x, y, z) {
                        alert('error');
                    }
                });
            },
            messages: {
                noResults: "", results: ""
            },
            select: function (event, ui) {
                $('#DestinationAirportCity').val(ui.item.label);
                return false;
            },
            focus: function (event, ui) {
                $('#DestinationAirportCity').val(ui.item.label);
                return false;
            }
        });*@


    })
</script>
<script type="text/javascript">
    var objitems = [];

    function CheckProcess() {
        $.ajax({
            type: "Post",
            url: "/Transhipment/GetProcessedStatus",
            datatype: "Json",
            //async :true,
            //data: { ManifestDate: $('#ManifestDate').val(), MAWB: $('#MAWB').val() },
            success: function (response) {
                debugger;
                var TotalRow = response.TotalRow;
                var ProcessedCount = response.ProcessedCount;
                var ProcessingRow = response.ProcessingRow;
                $('#divProcessStatus').html('<h4>TotalRow:' + TotalRow + '  ProcessedCount :' + ProcessedCount + ' Processing Row:'+ ProcessingRow + '</h4>');
            }
        });
    }

    function UpdateImported() {
        $.ajax({
            type: "POST",
            url: "/ImportManifest/UpdateImportedItem",
            datatype: "Json",
            data: { Details: JSON.stringify(objitems) },
            contentType:'application/x-www-form-urlencoded',
            success: function (response) {

            },
            error: function (err) {
                console.log(err);
            }
        });
    }
    function CallAutoFixation() {
        //AutoDataFixation
        $('#loaderpopup').modal('show')
        $('#divProcessStatus').html('<h2 style="color:red">Data Auto Fixation</h2>');
          $.ajax({
                type: 'POST',
                url: '@Url.Action("AutoDataFixation", "Transhipment")',
             datatype: "json",
            success: function (data) {
                if (data == "ok") {
                    $.ajax({
                        type: 'POST',
                        url: '@Url.Action("ShowItemList", "Transhipment")',
                        datatype: "html",
                        success: function (data) {
                            $("#listContainer").html(data);
                            var max = $('#listbody > tr').length;
                            $('#loaderpopup').modal('hide')
                            $('#divProcessStatus').html('');
                            $('#btnUpload').removeAttr('disabled');
                            $('#TotalAWB').val(max);
                        },
                        error: function (err) {
                            $('#loaderpopup').modal('hide')
                            $('#divProcessStatus').html('');
                            console.log(err);
                        }
                    });
                }
                else {
                    $('#loaderpopup').modal('hide');
                    $('#divProcessStatus').html('');
                }
              },
            error: function (err) {
                  $('#loaderpopup').modal('hide')
                 $('#divProcessStatus').html('');
              }
            });
    }
    function savefixation() {
        debugger;
        $('#btnsavefixation').attr('disabled', 'disabled');
        var Field = $('#FieldName').val();
        var SourceValue = $('#SourceValue').val();
        var DestinationValue = $('#DestinationValue').val();
        var DestinationCountry = $('#DestinationCountry').val();
        var DestinationCity = $('#DestinationCity').val();
        var DestinationLocation = $('#DestinationLocation').val();

        var TargetValue = "";

        if (Field == 'ConsigneeLocationName') {
            TargetValue = DestinationLocation;
        }
        else if (Field == 'ConsigneeCountryName') {
            TargetValue = DestinationCountry;
        }
        else if (Field == 'ConsigneeCityName') {
            TargetValue = DestinationCity;
        }
        else {
            TargetValue = DestinationValue;
        }

        //UpdateDataFixation
         $.ajax({
                type: 'POST',
                url: '@Url.Action("UpdateDataFixation", "Transhipment")',
             datatype: "html",
             data: { TargetColumn: Field, SourceValue: SourceValue, TargetValue: TargetValue },
            success: function (data) {
                $("#listContainer").html(data);
                $('#SourceValue').val('');
                $('#TargetValue').val('');
                $('#DestinationCity').val('');
                $('#DestinationLocation').val('');
                $('#DestinationCountry').val('');
                $('#spanmsg').html('Fixation Saved Succesfully!')
                $('#btnsavefixation').removeAttr('disabled');
                $('#SourceValue').focus();
              }
            });

        //$("#listContainer").html('');
        ////$('#imgloader').removeClass('hide');
        //$('#loaderpopup').modal('show')
        //var newobjitems = [];
        //$.each(objitems, function (index, item) {
        //    var i = index;
        //    debugger;
        //    if (Field == 'DestinationLocation') {
        //        if (SourceValue == item.DestinationLocation) {
        //            item.DestinationLocation = DestinationLocation;
        //            item.DestinationCountry = DestinationCountry;
        //            item.DestinationCity = DestinationCity;
        //        }
        //    }
        //    else if (Field == 'DestinationCountry') {
        //        if (SourceValue == item.DestinationCountry) {
        //            item.DestinationCountry = DestinationCountry;
        //        }
        //    }
        //    else if (Field == 'DestinationCity') {
        //            if (SourceValue == item.DestinationCity) {
        //                item.DestinationCity = DestinationCity;
        //            }
        //    }
        //    else {

        //    }
        //    var CompanyCountryName = $('#CompanyCountryName').val().toLowerCase();
        //    if (item.DestinationCountry.toLowerCase().indexOf(CompanyCountryName) >= 0)
        //        item.ImportType = 'Import';
        //    else
        //        item.ImportType = 'Transit';
        //    //if (item.DestinationCity.indexOf("DUBAI") >= 0)
        //    //    item.ImportType = 'Import';
        //    //else
        //    //    item.ImportType = 'Transit';

        //    //if (item.DestinationLocation.indexOf("DUBAI") >= 0)
        //    //    item.ImportType = 'Import';
        //    //else
        //    //    item.ImportType = 'Transit';

        //    newobjitems.push(item);
        //    if (objitems.length == (i + 1)) {
        //        debugger;
        //        objitems = [];
        //        objitems = newobjitems;
        //        additem();
        //        UpdateImported();
        //        $('#imgloader').addClass('hide');
        //        $('#loaderpopup').modal('hide')
        //        $('#fixationpopup').modal('hide');
        //    }
        //});
    }
    function additem() {
        $.each(objitems, function (index, item) {
            var i = index;
            var ReceiverContact = item.ReceiverContact;
            var ReceiverAddress = item.ReceiverAddress;
            var datahtml = '<input type="hidden" class="hdndeleted" id="hdndeleted_' + i + '"  value="false" /> <input type="hidden" id="hdnAWBNo_' + i + '"  value="' + item.AWBNo + '" /> ';
            datahtml = datahtml + '<input type="hidden" id="hdnBag_' + i + '"  value="' + item.Bag + '"/>';
            datahtml = datahtml + '<input type="hidden" id="hdnAWBDate_' + i + '"  value="' + item.AWBDate + '"/>';
            datahtml = datahtml + '<input type="hidden" id="hdnShipper_' + i + '"  value="' + item.Shipper + '"/>';
            datahtml = datahtml + '<input type="hidden" id="hdnReceiver_' + i + '"  value="' + item.Receiver + '"/>';
            datahtml = datahtml + '<input type="hidden" id="hdnReceiverContact_' + i + '"  value="' + ReceiverContact + '"/>';
            datahtml = datahtml + '<input type="hidden" id="hdnReceiverPhone_' + i + '"  value="' + item.ReceiverPhone + '"/>';
            datahtml = datahtml + '<input type="hidden" id="hdnReceiverAddress_' + i + '"  value="' + ReceiverAddress + '"/>';
            datahtml = datahtml + '<input type="hidden" id="hdnDestinationLocation_' + i + '"  value="' + item.DestinationLocation + '"/>';
            datahtml = datahtml + '<input type="hidden" id="hdnDestinationCountry_' + i + '"  value="' + item.DestinationCountry + '"/>';
            datahtml = datahtml + '<input type="hidden" id="hdnDestinationCity_' + i + '"  value="' + item.DestinationCity + '"/>';
            datahtml = datahtml + '<input type="hidden" id="hdnPcs_' + i + '"  value="' + item.Pcs + '"/>';
            datahtml = datahtml + '<input type="hidden" id="hdnWeight_' + i + '"  value="' + item.Weight + '"/>';
            datahtml = datahtml + '<input type="hidden" id="hdnValue_' + i + '"  value="' + item.Value + '"/>';
            datahtml = datahtml + '<input type="hidden" id="hdnCOD_' + i + '"  value="' + item.COD + '"/>';
            datahtml = datahtml + '<input type="hidden" id="hdnContent_' + i + '"  value="' + item.Content + '"/>';
            datahtml = datahtml + '<input type="hidden" id="hdnImportType_' + i + '"  value="' + item.ImportType + '"/>';
            var html = '<tr><td>' + datahtml + (parseInt(i) + 1) + '</td><td>' + item.AWBNo + '</td><td>' + item.AWBDate + '</td><td>' + item.Shipper + '</td>' +
                '<td><strong>' + item.Receiver + '</strong><br/><span style="color:blue">' + ReceiverContact + '</span></br>' + ReceiverAddress + '<br/>' + item.ReceiverPhone + '</td>' +
                '<td>' + item.DestinationLocation + '</td><td>' + item.DestinationCity + '<br/>' + item.DestinationCountry + '</td>' +
                '<td>' + item.Bag + '</td>' +
                '<td>' + item.Content + '</td>' +
                '<td>' + item.Pcs + '</td>' +
                '<td class="text-right">' + parseFloat(item.Weight).toFixed(3) + '</td>' +
                '<td class="text-right">' + parseFloat(item.Value).toFixed(2) + '</td>' +
                '<td class="text-right">' + item.COD + '</td>' +
                '<td class="text-right">' + item.ImportType + '</td></tr>';

            $("#listContainer").append(html);
        });
    }
    function saveimport() {
        $('#btnSave').attr('disabled', 'disabled');
        $('#loaderpopup').modal('show');
        $('#divProcessStatus').html('<h2 style="color:red">Data Save Processing</h2>');
        var obj = [];
        //var maxrow = $('#listbody > tr').length;
        //if (maxrow == 0) {
        //    alert('Click upload to import Items from Excel!');
        //    return;
        //}
        var master = {
            ID: $('#ID').val(),
            ManifestNumber: $('#ManifestNumber').val(),
            AgentID: $('#AgentID').val(),
            ManifestDate: $('#ManifestDate').val(),
            //ShipmentTypeId: $('#ShipmentTypeId').val(),
            OriginAirportCity: $('#OriginAirportCity').val(),
            DestinationAirportCity: $('#DestinationAirportCity').val(),
            FlightDate1: $('#FlightDate1').val(),
            FlightNo: $('#FlightNo').val(),
            MAWB: $('#MAWB').val(),
            Type: $('#Type').val(),
            TotalAWB: $('#TotalAWB').val(),
            ParcelNo: $('#ParcelNo').val(),
            Weight: $('#Weight').val(),
            Bags: $('#Bags').val(),
            Route: $('#Route').val()
        }
        $.ajax({
            type: "POST",
            url: "/Transhipment/SaveImport",
            datatype: "Json",
            data: { Master: JSON.stringify(master), Details: JSON.stringify(obj) },
            success: function (response) {
                $.notify("Transhipment Saved Succesfully!", "success");
                $('#btnSave').removeAttr('disabled');
                $('#loaderpopup').modal('hide');
                $('#divProcessStatus').html('');
                window.location.href = "/Transhipment/Index";

                },
            error: function (err) {
                console.log(err);
            }
        });
    }
    $(document).on("change", "#importFile", function () {
        var files = $("#importFile").get(0).files;

        var formData = new FormData();
        formData.append('importFile', files[0]);

        if (files.length > 0) {
            $('#btnUpload').attr('disabled', 'disabled');
            $('#loaderpopup').modal('show');
            $('#divProcessStatus').html('<h2 style="color:red">Data Processing</h2>');
            $.ajax({
                url: '/Transhipment/ImportFile',
                data: formData,
                type: 'POST',
                contentType: false,
                processData: false,
                success: function (response) {
                    if (response.Status === 1) {
                        //var data = response.data;
                        //$('#imgloader').removeClass('hide');
                              $.ajax({
                              type: 'POST',
                              url: '@Url.Action("ShowItemList", "Transhipment")',
                              datatype: "html",
                            success: function (data) {
                                    $("#listContainer").html(data);
                                var max = $('#listbody > tr').length;
                                $('#loaderpopup').modal('hide')
                                $('#btnUpload').removeAttr('disabled');
                                    $('#TotalAWB').val(max);
                            }
                      });

                    } else {
                        $('#loaderpopup').modal('hide')
                        $('#btnUpload').removeAttr('disabled');
                        $.notify(response.Message, 'error');
                    }
                },
                error: function (err) {
                    $('#loaderpopup').modal('hide')
                    console.log(err);
                }
            });
        }
        else {
            $('#btnUpload').removeAttr('disabled');
            $('#loaderpopup').modal('hide')
        }
    });

    $(document).on("click", "#btnUpload", function () {
        //CheckDuplicationTranshipment
        if ($('#ManifestDate').val() == '') {
            $.notify('Please Fill Required Fields!');
            $('#ManifestDate').focus();
            return;
        }
        else if ($('#AgentID').val() == '') {
            $.notify('Please Select Co Loader!');
            $('#AgentID').focus();
            return;
        }
         else if ($('#MAWB').val() == '') {
            $.notify('Please Fill Required Fields!');
            $('#MAWB').focus();
            return;
        }
        $.ajax({
            type: "GET",
            url: "/Transhipment/CheckDuplicationTranshipment",
            datatype: "Json",
            data: { ManifestDate: $('#ManifestDate').val(), MAWB: $('#MAWB').val(), AgentID:$('#AgentID').val() },
            success: function (response) {
                var status = response.status;
                if (status == "ok")
                    $('#importFile').trigger('click');
                else {
                    $.notify(response.Message, "error");
                }
            }
        });

    });


    $(document).ready(function () {
       // callniceapi();
        var startdate = '@Session["FyearFrom"].ToString()';
        var enddate = '@Session["FyearTo"].ToString()';
        var sd = new Date(startdate.split('-')[1] + '-' + startdate.split('-')[0] + '-' + startdate.split('-')[2]);
        var ed = new Date(enddate.split('-')[1] + '-' + enddate.split('-')[0] + '-' + enddate.split('-')[2]);
        $('#ManifestDate').datetimepicker({
            maxDate: ed,
            minDate: sd,
            format: 'DD-MM-YYYY HH:mm'
        });
        $('#FlightDate1').datetimepicker({
            maxDate: ed,
            minDate: sd,
            format: 'DD-MM-YYYY HH:mm'
        });
        var RateProcessing = false;
        $('#ManifestDate').change(function () {
             $.ajax({
                type: 'GET',
                url: '@Url.Action("GetManifestNo", "Transhipment")',
                datatype: "json",
                data: {
                    ManifestDateTime: $('#ManifestDate').val()
                },
                success: function (data) {
                    $('#ManifestNumber').val(data);
                }
            });

        })
        $('#btnFixation').click(function () {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("ShowImportDataFixation", "Transhipment")',
                datatype: "html",
                data: {
                    FieldName: 'ConsigneeCountryName'
                },
                success: function (data) {
                    $("#popupContainer").html(data);
                    $('#fixationpopup').modal('show');
                }
            });
        })

        $('#btnUpdateRate').click(function () {
            $('#loaderpopup').modal('show');
            RateProcessing = true;
            //setInterval(function () {
            //    if (RateProcessing == true) {
            //        CheckProcess();
            //    }
            //}, 500)

             $.ajax({
                type: "GET",
                url: "/Transhipment/CheckDataValidation",
                datatype: "Json",
                //data: { ManifestDate: $('#ManifestDate').val(), MAWB: $('#MAWB').val() },
                success: function (response) {
                    var status = response.status;
                         $.ajax({
                        type: 'POST',
                        url: '@Url.Action("ShowItemList", "Transhipment")',
                        datatype: "html",
                             success: function (data) {
                                RateProcessing = false;
                            $("#listContainer").html(data);
                            $('#loaderpopup').modal('hide')
                        },
                             error: function (err) {
                                 RateProcessing = false;
                            $('#loaderpopup').modal('hide')
                            console.log(err);
                        }
                    });
                }
            });

        });
        $('#btnSave').click(function () {
            debugger;

            if ($('#AgentID').val() == '') {
                $.notify('Please Fill Required Fields!');
                $('#AgentID').focus();
                return;
            }
            //else if ($('#Route').val() == '') {
            //    $.notify('Please Fill Required Fields!');
            //    $('#Route').focus();
            //    return;
            //}
            //else if ($('#Type').val() == '') {
            //    $.notify('Please Fill Required Fields!');
            //    $('#ShipmentTypeId').focus();
            //    return;
            //}
            //else if ($('#OriginAirportCity').val() == '') {
            //        $.notify('Please Fill Required Fields!');
            //    $('#OriginAirportCity').focus();
            //        return;
            //}
            //else if ($('#DestinationAirportCity').val() == '') {
            //    $.notify('Please Fill Required Fields!');
            //    $('#DestinationAirportCity').focus();
            //        return;
            //}
            //else if ($('#FlightDate1').val() == '') {
            //    $.notify('Please Fill Required Fields!');
            //    $('#FlightDate1').focus();
            //    return;
            //}
            //else if ($('#FlightNo').val() == '') {
            //    $.notify('Please Fill Required Fields!');
            //    $('#FlightNo').focus();
            //    return;
            //}
            else if ($('#MAWB').val() == '') {
                $.notify('Please Fill Required Fields!');
                $('#MAWB').focus();
                return;
            }
            else if ($('#TotalAWB').val() == '') {
                $.notify('Please Fill Required Fields!');
                $('#TotalAWB').focus();
                return;
            }
            //else if ($('#ParcelNo').val() == '') {
            //    $.notify('Please Fill Required Fields!');
            //    $('#ParcelNo').focus();
            //    return;
            //}
            //else if ($('#Weight').val() == '') {
            //    $.notify('Please Fill Required Fields!');
            //    $('#Weight').focus();
            //    return;
            //}
            //else if ($('#Bags').val() == '') {
            //    $.notify('Please Fill Required Fields!');
            //    $('#Bags').focus();
            //    return;
            //}
            //else if ($('#Bags').val() == '') {
            //    $.notify('Please Fill Required Fields!');
            //    $('#Bags').focus();
            //    return;
            //}

            saveimport();

            @*$.ajax({
                type: "GET",
                url: "/Transhipment/CheckDataValidation",
                datatype: "Json",
                //data: { ManifestDate: $('#ManifestDate').val(), MAWB: $('#MAWB').val() },
                success: function (response) {
                    var status = response.status;
                    if (status == "ok")

                    else {
                         $.ajax({
                        type: 'POST',
                        url: '@Url.Action("ShowItemList", "Transhipment")',
                        datatype: "html",
                        success: function (data) {
                            $("#listContainer").html(data);
                            var max = $('#listbody > tr').length;
                            $.notify(response.Message, "error");
                        },
                        error: function (err) {
                            $('#loaderpopup').modal('hide')
                            console.log(err);
                        }
                    });


                    }
                }
            });*@





        });
        if ($('#ID').val() > 0) {
            //DisplayImprotItem();
        }
        $('#btnGETAPI').click(function () {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("ShowItemList", "ImportManifest")',
                datatype: "html",
                data: {
                    InputDate: $('#ManifestDate').val()
                },
                success: function (data) {
                    $("#listContainer").html(data);
                    var max=$('#listbody > tr').length;
                    $('#TotalAWB').val(max);
                }
            });
        });
        @*$('#btnGETAPI1').click(function () {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("GetAPI", "ImportManifest")',
                dataType: 'json',
                data: { InputDate: $('#ManifestDate').val() },
                contentType: "application/json;charset=UTF-8",
                success: function (data) {

                }
            });
        })**@

    });
    function DisplayImprotItem() {
        //GetImportItem
        $("#listContainer").html('');
        $.ajax({
            type: "POST",
            url: "/ImportManifest/GetImportItem",
            datatype: "Json",
            data: { id: $("#ID").val() },  //$("#CollectedByID option:selected").val()
            success: function (response) {
                debugger;
                var data = response.data;
                $.each(data, function (index, item) {
                    var i = $("#listContainer > tr").length;
                    var ReceiverContact = item.ReceiverContact;
                    var ReceiverAddress = item.ReceiverAddress;
                    objitems.push(item);
                    var datahtml = '<input type="hidden" class="hdndeleted" id="hdndeleted_' + i + '"  value="false" /> <input type="hidden" id="hdnAWBNo_' + i + '"  value="' + item.AWBNo + '" /> ';
                    datahtml = datahtml + '<input type="hidden" id="hdnBag_' + i + '"  value="' + item.Bag + '"/>';
                    datahtml = datahtml + '<input type="hidden" id="hdnAWBDate_' + i + '"  value="' + item.AWBDate + '"/>';
                    datahtml = datahtml + '<input type="hidden" id="hdnShipper_' + i + '"  value="' + item.Shipper + '"/>';
                    datahtml = datahtml + '<input type="hidden" id="hdnReceiver_' + i + '"  value="' + item.Receiver + '"/>';
                    datahtml = datahtml + '<input type="hidden" id="hdnReceiverContact_' + i + '"  value="' + ReceiverContact + '"/>';
                    datahtml = datahtml + '<input type="hidden" id="hdnReceiverPhone_' + i + '"  value="' + item.ReceiverPhone + '"/>';
                    datahtml = datahtml + '<input type="hidden" id="hdnReceiverAddress_' + i + '"  value="' + ReceiverAddress + '"/>';
                    datahtml = datahtml + '<input type="hidden" id="hdnDestinationLocation_' + i + '"  value="' + item.DestinationLocation + '"/>';
                    datahtml = datahtml + '<input type="hidden" id="hdnDestinationCountry_' + i + '"  value="' + item.DestinationCountry + '"/>';
                    datahtml = datahtml + '<input type="hidden" id="hdnDestinationCity_' + i + '"  value="' + item.DestinationCity + '"/>';
                    datahtml = datahtml + '<input type="hidden" id="hdnPcs_' + i + '"  value="' + item.Pcs + '"/>';
                    datahtml = datahtml + '<input type="hidden" id="hdnWeight_' + i + '"  value="' + item.Weight + '"/>';
                    datahtml = datahtml + '<input type="hidden" id="hdnValue_' + i + '"  value="' + item.Value + '"/>';
                    datahtml = datahtml + '<input type="hidden" id="hdnCOD_' + i + '"  value="' + item.COD + '"/>';
                    datahtml = datahtml + '<input type="hidden" id="hdnContent_' + i + '"  value="' + item.Content + '"/>';
                    var html = '<tr><td>' + datahtml + (parseInt(i) + 1) + '</td><td>' + item.AWBNo + '</td><td>' + item.AWBDate + '</td><td>' + item.Shipper + '</td>' +
                        '<td><strong>' + item.Receiver + '</strong><br/><span style="color:blue">' + ReceiverContact + '</span></br>' + ReceiverAddress + '<br/>' + item.ReceiverPhone + '</td>' +
                        '<td>' + item.DestinationLocation + '</td><td>' + item.DestinationCity + '<br/>' + item.DestinationCountry + '</td>' +
                        '<td>' + item.Bag + '</td>' +
                        '<td>' + item.Content + '</td>' +
                        '<td>' + item.Pcs + '</td>' +
                        '<td class="text-right">' + parseFloat(item.Weight).toFixed(3) + '</td>' +
                        '<td class="text-right">' + parseFloat(item.Value).toFixed(2) + '</td>' +
                        '<td class="text-right">' + item.COD + '</td>'+
                        '<td class="text-right">' + item.ImportType + '</td></tr>';

                    $("#listContainer").append(html);
                    if ((i + 1) == data.length) {
                        UpdateImported();
                    }
                });
            }
        });
    }
    //$(function () {
    //    $('#ManifestDate').datetimepicker({ format: 'DD-MM-YYYY HH:mm' });
    //    $('#FlightDate1').datetimepicker({ format: 'DD-MM-YYYY HH:mm' });

    //});
</script>


        @using (Html.BeginForm("Create", "Transhipment", FormMethod.Post, new { @id = "importShipment" }))
        {
            @Html.AntiForgeryToken()

            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-2">
                            <div class="mb-2">
                                @Html.HiddenFor(mode => Model.ID)
                                @Html.HiddenFor(mode => Model.CompanyCountryName)
                                @Html.LabelFor(model => model.ManifestNumber, "Manifest Number", htmlAttributes: new { @class = "col-form-label" })

                                @Html.TextBoxFor(model => model.ManifestNumber, new { @class = "form-control", @disabled = "true", @style = "text-decoration:none", @width = "100%" })
                            </div>
                        </div>
                       
                        <div class="col-md-2">
                            <div class="mb-2">
                                <label class="col-form-label">Manifest Date</label>
                                <div class="docs-datepicker">
                                    <div class="input-group">
                                        <input type="text" class="form-control docs-date" name="ManifestDate" id="ManifestDate" value="@Model.ManifestDate"
                                            placeholder="Pick a From Date" autocomplete="off">
                                        <button type="button"
                                                class="btn btn-secondary docs-datepicker-trigger"
                                                disabled>
                                            <i class="mdi mdi-calendar" aria-hidden="true"></i>
                                        </button>
                                    </div>
                                    <div class="docs-datepicker-container"></div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-2">
                            <div class="mb-2">
                                <label class="col-form-label required">Agent</label>
                                @Html.DropDownListFor(model => model.AgentID, new SelectList(@ViewBag.Agent, "CustomerID", "CustomerName"), "Select", new { @class = "form-select" })
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-2">
                                @Html.LabelFor(model => model.MAWB, htmlAttributes: new { @class = "col-form-label required" })

                                @Html.TextBoxFor(model => model.MAWB, new { @class = "form-control", @required = "true" })
                                @Html.ValidationMessageFor(model => model.MAWB, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="col-md-3 text-md-end" style="padding-top:35px">
                            <input class="form-control" type="file" style="display:none" name="importFile" id="importFile" />
                            <input type="button" id="btnfile" style="display:none" />

                        
<button type="button" class="btn btn-success waves-effect waves-light filter" id="btnUpload" title="Upload Excel">
                                    <i class="bx bx-upload mt-1" style="font-size: 21px;"></i>
                                </button>
                            <input class="btn btn-data" id="btnFixation" type="button" value="Data Fix" title="Data Fixation" style="margin-right: 10px;" />
<button type="button" class="btn btn-primary waves-effect waves-light filter" title="Auto Fixation" onclick="CallAutoFixation()">
                                    <i class="fa fa-th mt-1" style="font-size: 21px;"></i>
                                </button>
                           
                            @*<input class="btn btn-primary" type="button" value="Auto Fixation" onclick="CallAutoFixation()" />*@
<button type="button" class="btn btn-primary waves-effect waves-light filter" id="btnUpdateRate" title="Rate Update">
                                    <i class="bx bx-money mt-1" style="font-size: 21px;"></i>
                                </button>
                          
                            @*<input class="btn btn-primary" id="btnUpdateRate" type="button" value="Update Rate" />*@
                        </div>
                  
                
                        <div class="col-md-2">
                            <div class="mb-2">
                                <label class="col-form-label">Airport City</label>
                                @Html.TextBoxFor(model => model.OriginAirportCity, new { @class = "form-control", @type = "text", @autocomplete = "off" })
                                @*@Html.ValidationMessageFor(model => model.OriginAirportCity, "", new { @class = "text-danger" })*@
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="mb-2">
                                @Html.LabelFor(model => model.DestinationAirportCity, "Destination Airport City", htmlAttributes: new { @class = "col-form-label" })
                                @Html.TextBoxFor(model => model.DestinationAirportCity, new { @class = "form-control", @autocomplete = "off", @type = "search" })
                                @Html.ValidationMessageFor(model => model.DestinationAirportCity, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="col-md-1">
                            <div class="mb-2">
                                <label class="col-form-label">Flight No</label>
                                @Html.TextBoxFor(model => model.FlightNo, new { @class = "form-control", @autocomplete = "off" })
                                @Html.ValidationMessageFor(model => model.FlightNo, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-md-1">
                            <div class="mb-2">
                                <label class="col-form-label">Flight Date</label>
                                @Html.TextBoxFor(model => model.FlightDate1, new { @class = "form-control", @autocomplete = "off" })
                                @Html.ValidationMessageFor(model => model.FlightDate1, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-md-1">
                            <div class="mb-2">
                                <label class="col-form-label">Route</label>
                                @Html.TextBoxFor(model => model.Route, new { @class = "form-control", @autocomplete = "off" })
                            </div>
                        </div>
                        @*<div class="col-md-2">
                            <label class="headinglabel required">Type</label>
                            @Html.DropDownListFor(model => model.Type, (IEnumerable<SelectListItem>)ViewBag.Type, Model.Type, htmlAttributes: new { @class = "form-control", @required = "true", @selected = @Model.Type })
                            @Html.ValidationMessageFor(model => model.Type, "", new { @class = "text-danger" })
                        </div>*@
                        <div class="col-md-1">
                            <div class="mb-2">
                                <label class="col-form-label">Parcel No.</label>
                                @Html.TextBoxFor(model => model.ParcelNo, new { @class = "form-control text-right", @required = "true" })
                                @Html.ValidationMessageFor(model => model.ParcelNo, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-md-1">
                            <div class="mb-2">
                                <label class="col-form-label">Bag</label>
                                @Html.TextBoxFor(model => model.Bags, new { @class = "form-control text-right" })
                                @Html.ValidationMessageFor(model => model.Bags, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-md-1">
                            <div class="mb-2">
                                <label class="col-form-label">Weight</label>
                                @Html.TextBoxFor(model => model.Weight, new { @class = "form-control text-right" })
                                @Html.ValidationMessageFor(model => model.Weight, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="col-md-2">
                            <div class="mb-2">
                                <label class="col-form-label required">Total AWB</label>
                                @Html.TextBoxFor(model => model.TotalAWB, new { @class = "form-control text-right", @min = 1, @required = "true" })
                                @Html.ValidationMessageFor(model => model.TotalAWB, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="col-md-12 text-md-end mt-3">
                            <input type="button" value="Save" id="btnSave" class="btn btn-success waves-effect waves-light" />
                            @Html.ActionLink("Cancel", "Index", null, new { @class = "btn btn-secondary" })
                        </div>
 </div>             </div>
                </div>
            <div class="card" id="listContainer">
                <div class="card-body">
                    @{Html.RenderPartial("ItemList", Model);}
                </div>
            </div>
           
        }




<div class="modal fade" id="fixationpopup" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius:5px">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">
                    Import Data Fixation
                </h4>
            </div>

            <div class="modal-body">
                <div class="container-fluid" id="popupContainer">

                </div>
            </div>
            <div class="modal-footer" style="padding-top: 5px">
                <span id="spanmsg" style="color:red"></span>
                <button type="button" class="btn btn-success" id="btnsavefixation" onclick="savefixation()">Save</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="loaderpopup" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius:5px">
            <div class="modal-header">
                @*<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>*@
                <h4 class="modal-title" id="LoaderModalLabel">
                    Transhipment Uploading
                </h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12" style="text-align:center">
                        <h2>Processing...</h2>
                        <img src="~/Content/img/loading-gif-free-download-6.gif" id="imgloader" class="" style="padding-left:15px;height:60px;width:60px;" />
                    </div>

                </div>
                <div class="row">
                    <div class="col-md-12" style="text-align:center" id="divProcessStatus">

                    </div>
                </div>
            </div>
            @*<div class="modal-footer" style="padding-top: 5px">
                    <button type="button" class="btn btn-primary" onclick="savefixation()">Save</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>*@
        </div>
    </div>
</div>

