@model Net4Courier.Models.DRSReceiptVM

@{
   
    ViewBag.pTitle = "DRS Receipt";
    ViewBag.pageTitle = "Delivery Run Sheet";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var spath = "/DRSReceipt/Index/0";// System.Configuration.ConfigurationManager.AppSettings["spath"].ToString();
    var _decimal = @Session["Decimal"].ToString();
}


<style>


    .modal-dialog {
        width: 800px;
    }

    #staffmodelbody {
        max-height: calc(100vh - 200px);
        overflow-y: auto;
    }

    .flex {
        display: flex;
    }

    .justify-content-between {
        justify-content: space-between;
    }

    #popup h5 {
        border: 2px solid #35b8eb;
        min-width: 150px;
        height: 40px;
        border-radius: 5px;
        line-height: 40px;
        color: #35b8eb;
        text-align: center;
        font-weight: bold;
    }
</style>
<script type="text/javascript">
    function parseDate(dateStr) {
        // Split the string into day, month, and year
        let parts = dateStr.split('-');
        let day = parseInt(parts[0], 10);
        let month = parseInt(parts[1], 10) - 1; // JavaScript months are 0-based (0 = January)
        let year = parseInt(parts[2], 10);

        // Create a new Date object (year, month, day)
        return new Date(year, month, day);
    }
    function getCollectedAmountDetail() {

        if ($('#DRSRecPayID').val() > 0) {
            var drsdate = '';
            if ($('#DRSBased').val() == 1) {
                drsdate = $('#DRSDate').val();
            }
            else if ($('#DRSBased').val() == 2) {
                drsdate = $('#PODDate').val();
            }
            $.ajax({
                type: "POST",
                url: "/DRSReceipt/GetCollectedAmount", //GetAWBDetail",
                datatype: "Json",
                data: {
                    collectedby: $('#DeliveredBy').val(), Collecteddate: drsdate, DRSRecPayID: $('#DRSRecPayID').val()
                },
                success: function (response) {
                    $("#detailsbody").html('');
                    if (response.status == "ok") {
                        debugger;
                        var data = response.data;
                        $('#CollectedAmount').val(parseFloat(data).toFixed(@_decimal));

                        $("#detailsbody").html('');
                        var AWBItems = response.awblist;
                        var pickupcashtot = 0;
                        var codtot = 0;
                        var mctot = 0;
                        var otheramt = 0;
                        var expenseamount = 0;
                        $.each(AWBItems, function (index, item) {
                            debugger;
                            var i = $('#detailsbody > tr').length;
                            pickupcashtot = parseFloat(pickupcashtot) + parseFloat(item.PickupCash);
                            codtot = parseFloat(codtot) + parseFloat(item.COD);
                            otheramt = parseFloat(otheramt) + parseFloat(item.OtherAmount);
                            mctot = parseFloat(mctot) + parseFloat(item.MaterialCost);
                            expenseamount = parseFloat(expenseamount) + parseFloat(item.ExpenseAmount);
                            var datahtml = '<input type="hidden" class="hdndeleted" id="hdndeleted_' + i + '"  value="false" /> <input type="hidden" id="hdnAWbNo_' + i + '"  value="' + item.AWBNo + '" />  <input type="hidden" name="AWBDetails[' + i + '].CollectionId" id="hdnCollectionId_' + i + '"  value="' + item.CollectionId + '" /><input type="hidden" name="AWBDetails[' + i + '].CollectionType" id="hdnCollectionType_' + i + '"  value="' + item.CollectionType + '" />';
                            $("#detailsbody").append('<tr awbno="' + item.AWBNo + '"><td>' + datahtml + (parseInt(i) + 1) + '</td><td>' + item.AWBNo + '</td><td class="text-right">' + parseFloat(item.PickupCash).toFixed(2) + '</td><td class="text-right">' + parseFloat(item.COD).toFixed(2) + '</td><td class="text-right">' + parseFloat(item.MaterialCost).toFixed(2) + '</td><td class="text-right">' + parseFloat(item.OtherAmount).toFixed(2) + '</td><td class="text-right">' + parseFloat(item.ExpenseAmount).toFixed(2) + '</td><td>' + item.Remarks + '</td></tr>');
                            if ((index + 1) == AWBItems.length) {
                                $('#detailsfoot').html('<th></th><th>Total</th><th class="text-right">' + parseFloat(pickupcashtot).toFixed(2) + '</th><th class="text-right">' + parseFloat(codtot).toFixed(2) + '</th><th class="text-right">' + parseFloat(mctot).toFixed(2) + '</th><th class="text-right">' + parseFloat(otheramt).toFixed(2) + '</th><th class="text-right">' + parseFloat(expenseamount).toFixed(2) + '</th><th></th>');
                            }
                        });

                    }




                }


            });
        }
    }
    function getCollectedAmount() {
        var CollectedByID = $('#DeliveredBy').val();
        var drsdate = '';
        if ($('#DRSBased').val() == 1) {
            drsdate = $('#DRSDate').val();
        }
        else if ($('#DRSBased').val() == 2) {
            drsdate = $('#PODDate').val();
        }
        if (CollectedByID == null || CollectedByID == '')
            CollectedByID = 0;
        if (CollectedByID == '') {
           // Swal.fire('Data Validation', 'Select Collected By!', 'error');
            return false;
        }
        else if (drsdate == '') {

                Swal.fire('Data Validation', 'Select Collected Date!', 'error');
            $('#DRSDate').focus();
            return false;
        }


        $.ajax({
            type: "POST",
            url: "/DRSReceipt/GetCollectedAmount", //GetAWBDetail",
            datatype: "Json",
            data: {
                collectedby: CollectedByID, Collecteddate: drsdate, DRSRecPayID: $('#DRSRecPayID').val() },
            success: function (response) {
                $("#detailsbody").html('');
                if (response.status == "ok") {
                    debugger;
                    var data = response.data;
                    $('#CollectedAmount').val(data);
                    $('#ReceivedAmount').val(data);
                    $("#detailsbody").html('');
                    var AWBItems = response.awblist;
                    var pickupcashtot = 0;
                    var codtot = 0;
                    var mctot = 0;
                    var otheramt = 0;
                    var expenseamount = 0;
                    $.each(AWBItems, function (index, item) {
                        debugger;
                        var i = $('#detailsbody > tr').length;
                        pickupcashtot = parseFloat(pickupcashtot) + parseFloat(item.PickupCash);
                        codtot = parseFloat(codtot) + parseFloat(item.COD);
                        otheramt = parseFloat(otheramt) + parseFloat(item.OtherAmount);
                        mctot = parseFloat(mctot) + parseFloat(item.MaterialCost);
                        expenseamount = parseFloat(expenseamount) + parseFloat(item.ExpenseAmount);
                        var datahtml = '<input type="hidden" class="hdndeleted" id="hdndeleted_' + i + '"  value="false" /> <input type="hidden" id="hdnAWbNo_' + i + '"  value="' + item.AWBNo + '" />  <input type="hidden" name="AWBDetails[' + i + '].CollectionId" id="hdnCollectionId_' + i + '"  value="' + item.CollectionId + '" /><input type="hidden" name="AWBDetails[' + i + '].CollectionType" id="hdnCollectionType_' + i + '"  value="' + item.CollectionType + '" />';
                        $("#detailsbody").append('<tr awbno="' + item.AWBNo + '"><td>' + datahtml + (parseInt(i) + 1) + '</td><td>' + item.AWBNo + '</td><td class="text-right">' + parseFloat(item.PickupCash).toFixed(2) + '</td><td class="text-right">' + parseFloat(item.COD).toFixed(2) + '</td><td class="text-right">' + parseFloat(item.MaterialCost).toFixed(2) + '</td><td class="text-right">' + parseFloat(item.OtherAmount).toFixed(2) + '</td><td class="text-right">' + parseFloat(item.ExpenseAmount).toFixed(2) + '</td><td>' + item.Remarks + '</td></tr>');
                        if ((index + 1) == AWBItems.length) {
                            $('#detailsfoot').html('<th></th><th>Total</th><th class="text-right">' + parseFloat(pickupcashtot).toFixed(2) + '</th><th class="text-right">' + parseFloat(codtot).toFixed(2) + '</th><th class="text-right">' + parseFloat(mctot).toFixed(2) + '</th><th class="text-right">' + parseFloat(otheramt).toFixed(2) + '</th><th class="text-right">' + parseFloat(expenseamount).toFixed(2) + '</th><th></th>');
                        }
                    });

                }
                else {
                    Swal.fire('Data Validation', response.message,'error');
                }




            }


        });
    }
    function isNumberKey1(evt) {
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        //if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
        if (charCode != 8 && charCode != 0 && (charCode < 48 || charCode > 57))
            return false;

        return true;
    }

    $(document).ready(function () {

        $(":text").css({ "border-radius": "5px" });
        $("select").css({ "border-radius": "5px" });
        $("textarea").css({ "border-radius": "5px" });


        //$("#FMoney").attr("readonly", false);
        $("#PaymentMode").focus();
        document.addEventListener('keydown', function (event) {
            if (event.code == 'KeyC' && (event.altKey)) { //ADD AWB
                window.location = '/DRSReceipt/Index';
                //$('#btnCreateNew').trigger('click');
            }
        });
        $("#DRSBased").change(function () {
            if (!$("#DRSBased").is(':checked')) {
                $('#DRSNo').attr('readonly', 'readonly');
                $('#DRSNo').val('');
                $('#DRSID').val(0);
                $('#DRSNo').removeAttr('required');
            }
            else {
                $('#DRSNo').removeAttr('readonly');
                $('#DRSNo').attr('required', 'required');
            }
        });

        if ('@Model.DRSRecPayID' == 0) {
            $("#divCash").css({ "display": "none" });
            $("#divBank").css({ "display": "block" });

            //$("#CurrencyId").val('@Session["BaseCurrencyId"]');
            $("#EXRate").val('1.00');

            var m_names = new Array("Jan", "Feb", "Mar",
                "Apr", "May", "Jun", "Jul", "Aug", "Sep",
                "Oct", "Nov", "Dec");

            var d = new Date();
            var curr_date = d.getDate();
            var curr_month = d.getMonth() + 1;
            var curr_year = d.getFullYear();

            var reqdate = curr_date + "-" + curr_month + "-" + curr_year;
            $('#DRSRecPayDate').val(reqdate);

        } else {
            $('#btnsearch').attr('disabled', 'disabled');
            if ('@Model.ChequeNo' == null || '@Model.ChequeNo' == '') {
                $("#divCash").css({ "display": "block" });
                $("#divBank").css({ "display": "none" });
                $("#ChequeNo").attr("readonly", "readonly")
                $("#ChequeDate").attr("readonly", "readonly")
                $("#PaymentMode").val(2);

            } else {
                $("#divCash").css({ "display": "none" });
                $("#divBank").css({ "display": "block" });

            }
        }

        //setTimeout(function () {
        //    $("#DRSBased").trigger('change');
        //}, 300)

        var wt = $("#EXRate").val();
        if (wt == null || wt == "") {
            $("#EXRate").val("0.00");
        } else {
            $("#EXRate").val(parseFloat(wt).toFixed(@_decimal));
        }

        $("#EXRate").blur(function () {
            var wt = $(this).val();
            $("#EXRate").val(parseFloat(wt).toFixed(@_decimal));

        });
        $("#CashBank").blur(function () {
            var val = $("#PaymentMode").val();
            if (val == 2) { //cash
                $('#ReceivedAmount').focus();
            }
            else {
                $('#ChequeNo').focus();
            }
        });
        $("#DRSNo").change(function () {
            $("#CashBank").focus();
        });
        $('#DeliveredBy').blur(function () {
            if ($("#DRSBased").val()==1) {
                $("#DRSNo").focus();
            }
            else if ($("#DRSBased").val() == 2)
            {
                $("#PODDate").focus();
            }
            else {
                $("#CashBank").focus();
            }

        });

        //$('#DeliveredBy').change(function () {
        //    if ($('#DRSRecPayID').val() == 0) //create mode
        //    {
        //        getCollectedAmount();
        //    }
        //})
        $('#DRSRecPayDate').change(function () {
            if ($('#DRSRecPayID').val() == 0) //create mode
            {
                getCollectedAmount();
            }
        })
        $('#btnrefresh').click(function () {
            if ($('#DRSRecPayID').val() == 0) //create mode
            {
                getCollectedAmount();
            }
        })
           $("#ReceivedAmount").blur(function () {
            var wt = $(this).val();
            if (wt == null || wt == "") {
                $("#ReceivedAmount").val("0.00");
            } else {
                $("#ReceivedAmount").val(parseFloat(wt).toFixed(@_decimal));
            }
        });

         $("#DRSNo").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: '/DRSReceipt/GetDRSNo',
                    datatype: "json",
                    data: {
                        term: request.term, DeliveredBy: $('#DeliveredBy').val(), RecpayId: $("#DRSRecPayID").val()},
                    success: function (data) {
                        response($.map(data, function (val, item) {
                            return {
                                label: val.DRSNo,
                                value: val.DRSID,
                                DRSDate: val.DRSDate,
                                CheckedBy: val.CheckedBy,
                                TotalAmount:val.TotalAmount
                            }
                        }))
                    }
                })
            },
            minLength: 0,
            autoFocus: false,
             focus: function (e, i) {
                 e.preventDefault();
                $("#DRSNo").val(i.item.label);
                $('#DRSID').val(i.item.value);
                $('#DRSID').attr('label', i.item.label);
                var myDate = new Date(i.item.DRSDate.match(/\d+/)[0] * 1);
                 var cmon = myDate.getMonth() + 1;
                var collectdate = myDate.getDate() + "-" + cmon + "-" + myDate.getFullYear();
                $('#DRSDate').val(collectdate);
                //$('#DeliveredBy').val(i.item.CheckedBy);
                $('#DRSAmount').val(i.item.TotalAmount);
             },
            select: function (e, i) {
                e.preventDefault();
                $("#DRSNo").val(i.item.label);
                $('#DRSID').val(i.item.value);
                $('#DRSID').attr('label', i.item.label);
                var myDate = new Date(i.item.DRSDate.match(/\d+/)[0] * 1);
                var cmon = myDate.getMonth() + 1;
                var collectdate = myDate.getDate() + "-" + cmon + "-" + myDate.getFullYear();// + ' ' + myDate.getHours() + ':' + myDate.getMinutes();
                $('#DRSDate').val(collectdate);

                //$('#DeliveredBy').val(i.item.CheckedBy);
                $('#DRSAmount').val(i.item.TotalAmount);

            },

         });

        @*$('#btnsearch').click(function () {

            if ($('#CustomerID').val() == 0) {
                alert('Select Customer!');
                return;
            }

            if ($('#ReceivedAmount').val() == "") {// || $('#FMoney').val()=="0") {
                //alert('Enter Receipt Amount!');
                $('#ReceivedAmount').val(0);
            }

            var ID = $('#DRSID').val();
            var RecPayId = $('#DRSRecPayID').val();
            $.ajax({
                type: "GET",
                url: '/DRSReceipt/GetDRSAWB/',
                data: { 'DRSID': ID, 'RecPayId': RecPayId },
                success: function (data) {
                    $('#tbl1').html('');
                    //$scope.Orders = data;
                    var amt = 0;
                    for (var i = 0; i < data.length; i++) {

                        debugger;

                        $('#tbl1').append('<tr>' +
                            '<td>' + data[i].AWBNO + '<input type = "hidden" name ="Details[' + i + '].AWBNO"  value = "' + data[i].AWBNO + '" /><input type="hidden" name="Details[' + i + '].DRSRecPayDetailID"  value="' + data[i].DRSRecPayDetailID + '" /><input type="hidden" name="Details[' + i + '].InScanID"  value="' + data[i].InScanID + '" />  </td>' +
                            '<td>' + data[i].AWBDate + '<input id="" name="Details[' + i + '].AWBDate" value=' + data[i].DateTime + ' type="hidden"></td>' +
                            '<td class="text-right">' + parseFloat(data[i].CourierCharge).toFixed(@_decimal) + '<input id="" name="Details[' + i + '].CourierCharge" value=' + data[i].CourierCharge + ' type="hidden"></td>' +
                            '<td class="text-right">' + parseFloat(data[i].MaterialCost).toFixed(@_decimal) + '<input id="" name="Details[' + i + '].MaterialCost" value=' + data[i].MaterialCost+ ' type="hidden"/></td>' +
                            '<td class="text-right"><input class="text-right" id="txtccrec_' + i + '" name="Details[' + i + '].CCReceived" value="' + data[i].CCReceived + '" type="text" onchange="CheckAmt1(this)"/></td>' +
                            '<td class="text-right"><input class="text-right" id="txtmcrec_' + i + '" name="Details[' + i + '].MCReceived" value="' + data[i].MCReceived + '" type="text" onchange="CheckAmt1(this)"/></td>' +
                            '<td class="text-right"><input class="text-right" id="txttotal_' + i + '" name="Details[' + i + '].TotalAmount" value="' + data[i].TotalAmount + '" type="text"></td>' +
                            '<td class="text-right"><input class="text-right" id="txtbalance_' + i + '" name="Details[' + i + '].Balance" value="' + data[i].Balance + '" type="text"></td>' +
                            '<td class="text-right"><input class="text-right" id="txtdiscount_' + i + '" name="Details[' + i + '].Discount" value="' + data[i].Discount + '" type="text" onchange="CheckAmt1(this)"></td>' +
                            '<td> <input type="checkbox" id="chkstatus_' + data[i].StatusClose + '" class="" name="Details[' + i + '].StatusClose" />' +
                            '</tr>');
                        //hideLoading();
                    }


                }
            });

        });*@
        $("#DRSNo").change(function () {
            if ($('#DRSNo').val() != $('#DRSID').attr('label')) {
                $('#DRSNo').val('');
                $('#DRSID').val('0');
                $('#DRSNo').focus();
            }

        });

        $('input[name=formRadios]').change(function () {
            debugger;
            if ($('#formRadios1').prop('checked')) {
                $('#DRSNo').removeAttr('readonly');
                $('#divdrs').removeClass('hide');
                $('#divpod').addClass('hide');
                $('#DRSBased').val(1);
            }
            else if ($('#formRadios2').prop('checked')) {
                $('#DRSNo').attr('readonly', 'readonly');
                $('#divpod').removeClass('hide');
                $('#divdrs').addClass('hide');
                $('#DRSBased').val(2);
            }
            else {
                $('#DRSNo').attr('readonly', 'readonly');
                $('#divdrs').removeClass('hide');
                $('#divpod').addClass('hide');
                $('#DRSBased').val(0);
            }
        });


        if ($("#DRSRecPayID").val() > 0) {
            if ($("#StatusEntry").val() == "BK") {
                $("#Bank").prop('checked', true);
                $("#Cash").prop('checked', false);
                $("#Bank").trigger("click");
            }
            else if ($("#StatusEntry").val() == "CS") {
                $("#Cash").prop('checked', true);
                $("#Bank").prop('checked', false);
                $("#Cash").trigger("click");
            }
            PaymentModeChange();

            var money = parseFloat($("#FMoney").val());
            $("#FMoney").val(money.toFixed(@_decimal));

            var exrate = parseFloat($("#EXRate").val());
            $("#ExRate").val(exrate.toFixed(@_decimal));
            $('#DRSNo').attr('readonly', 'readonly');
            if ($('#ReceivedAmount').val() == '')
                $('#ReceivedAmount').val(0);

            if ($('#DRSAmount').val() == '')
                $('#DRSAmount').val(0);

            $('#ReceivedAmount').val(parseFloat($('#ReceivedAmount').val()).toFixed(@_decimal));
            $('#DRSAmount').val(parseFloat($('#DRSAmount').val()).toFixed(@_decimal));
            getCollectedAmountDetail();
            $('#btnrefresh').attr('disabled', 'disabled');

            if ($("#DRSBased").val() == 1) {
                $('#DRSNo').removeAttr('readonly');
                $('#divdrs').removeClass('hide');
                $('#divpod').addClass('hide');
                $('#formRadios1').prop('checked', true);

            }
            else if ($('#DRSBased').val() == 2) {
                $('#DRSNo').attr('readonly', 'readonly');
                $('#divpod').removeClass('hide');
                $('#divdrs').addClass('hide');
                $('#formRadios2').prop('checked', true);
            }
            else {
                $('#DRSNo').attr('readonly', 'readonly');
                $('#divdrs').removeClass('hide');
                $('#divpod').addClass('hide');
                $('#formRadios3').prop('checked', true);
            }
        }
        else {
            $("#PaymentMode").val(2).trigger('change');
            if ($("#DRSBased").val() == 1) {
                $('#DRSNo').removeAttr('readonly');
                $('#divdrs').removeClass('hide');
                $('#divpod').addClass('hide');
                $('#formRadios1').prop('checked', true);

            }
            else if ($('#DRSBased').val() == 2) {
                $('#DRSNo').attr('readonly', 'readonly');
                $('#divpod').removeClass('hide');
                $('#divdrs').addClass('hide');
                $('#formRadios2').prop('checked', true);
            }
            else {
                $('#DRSNo').attr('readonly', 'readonly');
                $('#divdrs').removeClass('hide');
                $('#divpod').addClass('hide');
                $('#formRadios3').prop('checked', true);
            }
            //alert($('#DRSBased').val());
            //$('#DRSBased').prop('checked', true);
            //$('#DRSBased').trigger('change');
            //$('#DRSNo').removeAttr('readonly');
            //$('#divdrs').removeClass('hide');
            //$('#divpod').addClass('hide');
           /* $('#DRSBased').val(1);*/
            $('#DRSRecPayDate').focus();
        }





        document.addEventListener('keydown', function (event) {
            if (event.code == 'KeyS' && (event.altKey)) { //ADD AWB
                $('#btnSave').trigger('click');
            }
        });
    });
</script>

<script>
    function Comma(Num) { //function to add commas to textboxes
        Num += '';
        Num = Num.replace(',', ''); Num = Num.replace(',', ''); Num = Num.replace(',', '');
        Num = Num.replace(',', ''); Num = Num.replace(',', ''); Num = Num.replace(',', '');
        x = Num.split('.');
        x1 = x[0];
        x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1))
            x1 = x1.replace(rgx, '$1' + ',' + '$2');
        $(".aeamt").val(x1 + x2);
    }
</script>

<script type="text/javascript">
      function PaymentModeChange() {
        var val = $("#PaymentMode").val();
        if (val == 1) {
            $("#divCash").css({ "display": "none" });
            $("#divBank").css({ "display": "block" });
            $("#ChequeNo").attr('required', 'required');
            $("#ChequeDate").attr('required', 'required');
            $("#ChequeNo").removeAttr('readonly');
            $("#ChequeDate").removeAttr('readonly');
            $('#CashBank').removeAttr('required', 'required');
            $('#ChequeBank').attr('required', 'required');
        } else {
            $("#divBank").css({ "display": "none" });
            $("#divCash").css({ "display": "block" });
            $("#ChequeNo").removeAttr('required');
            $("#ChequeDate").removeAttr('required');
            $("#ChequeNo").attr('readonly', 'readonly');
            $("#ChequeDate").attr('readonly','readonly')
            $('#CashBank').attr('required','required');

            $('#ChequeBank').removeAttr('required')
        }

    }
</script>

<!-- Main content -->

    @using (Html.BeginForm("Create", "DRSReceipt", FormMethod.Post, new { @id = "FormReceipt" }))
    {
        @Html.ValidationSummary(true)
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        @Html.HiddenFor(model => model.DRSRecPayID)
                        @Html.HiddenFor(model => model.StatusEntry)
                        @Html.HiddenFor(model => model.AcJournalID)
                        @Html.HiddenFor(model => model.DRSBased)
                        <div class="row">
                            <div class="col-md-8">
                              
                            </div>
                            <div class="col-md-4 text-md-end">
                                <div class="mb-2">
                                    @if (Model.DRSRecPayID > 0)
                                    {
                                        <input type="submit" class="btn btn-success" value="Update" id="btnSave" />
                                    }
                                    else
                                    {
                                        <input type="submit" class="btn btn-success" value="Save" id="btnSave" name="Command" />
                                    }
                                    <a href='@Url.Action("Index", "DRSReceipt", new { id = 0 })' class="btn btn-secondary">Cancel</a>
                                </div>
                            </div>
                            <div class="col-xs-4 col-sm-2">
                                <div class="mb-2">
                                    <label class="col-form-label">DRS Receipt No.</label>
                                    @Html.TextBoxFor(model => model.DocumentNo, new { @class = "form-control", @readonly = "readonly" })
                                </div>
                            </div>

                            <div class="col-md-2">
                                <div class="mb-2">
                                    <label class="col-form-label">DRS Receipt Date</label>
                                    <div class="docs-datepicker">
                                        <div class="input-group">
                                            <input type="text" class="form-control docs-date" name="DRSRecPayDate" id="DRSRecPayDate" value="@Model.DRSRecPayDate.ToShortDateString()"
                                                   placeholder="Pick a From Date" autocomplete="off">
                                            <button type="button"
                                                    class="btn btn-secondary docs-datepicker-trigger"
                                                    disabled>
                                                <i class="mdi mdi-calendar" aria-hidden="true"></i>
                                            </button>
                                        </div>
                                        <div class="docs-datepicker-container"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-2">
                                <div class="mb-2">
                                    <label class="col-form-label required">Courier Name</label>
                                    @Html.DropDownListFor(model => model.DeliveredBy, new SelectList(ViewBag.Deliverdby, "EmployeeID", "EmployeeName"), "Select", new { @class = "form-select", @required = true })
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-2">
                                <div class="mb-2">
                                    <div class="flexTitle">

                                        <div class="text-right">
                                            <div class="row">
                                                <div class="col-md-4 form-check mb-3">
                                                    <input class="form-check-input" type="radio" name="formRadios" id="formRadios1" checked="">
                                                    <label class="form-check-label" for="formRadios1" title="DRS Based">
                                                        DRS
                                                    </label>
                                                </div>
                                                <div class=" col-md-4 form-check">
                                                    <input class="form-check-input" type="radio" name="formRadios" id="formRadios2">
                                                    <label class="form-check-label" for="formRadios2" title="POD Based">
                                                        POD
                                                    </label>
                                                </div>
                                                <div class=" col-md-4 form-check">
                                                    <input class="form-check-input" type="radio" name="formRadios" id="formRadios3">
                                                    <label class="form-check-label" for="formRadios3" title="Direct">
                                                        None
                                                    </label>
                                                </div>
                                            </div>

                                        </div>
                                        @*<div class="checkboxdesign no-padding  text-right" style="float:right">
                            @Html.CheckBox("DRSBased", new { @name = "DRSBased" }) &nbsp
                            <label class="col-form-label" style="color:#07a7e3!important;padding-left: 0!important">DRS Based</label>
                        </div>*@
                                    </div>
                                    @Html.TextBoxFor(model => model.DRSNo, new { @class = "form-control", @placeholder = "Select DRS No." })
                                    @Html.HiddenFor(mode => Model.DRSID)
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="mb-2" id="divdrs">
                                    <label class="col-form-label">DRS Date</label>
                                    <div class="docs-datepicker">
                                        <div class="input-group">
                                            <input type="text" class="form-control docs-date" name="DRSDate" id="DRSDate" readonly title="Actual date of delivery and Amount collected Date!" value="@Model.DRSDate"
                                                   placeholder="DRS Date" autocomplete="off">
                                            <button type="button"
                                                    class="btn btn-secondary docs-datepicker-trigger"
                                                    disabled>
                                                <i class="mdi mdi-calendar" aria-hidden="true"></i>
                                            </button>
                                        </div>
                                        <div class="docs-datepicker-container"></div>
                                    </div>
                                </div> 
                                <div class="mb-2 hide" id="divpod">
                                    <label class="col-form-label">POD Date</label>
                                    <div class="docs-datepicker">
                                        <div class="input-group">
                                            @{
                                                if (Model.PODDate != null)
                                                {
                                                    <input type="text" class="form-control docs-date" name="PODDate" id="PODDate" title="Actual date of delivery and Amount collected Date!" value="@Model.PODDate.Value.ToShortDateString()"
                                                           placeholder="Pick a POD Date" autocomplete="off">
                                                }
                                                else
                                                {
                                                    <input type="text" class="form-control docs-date" name="PODDate" id="PODDate" title="Actual date of delivery and Amount collected Date!" value=""
                                                           placeholder="Pick a POD Date" autocomplete="off">
                                                }
                                            }
                                            <button type="button"
                                                    class="btn btn-secondary docs-datepicker-trigger"
                                                    disabled>
                                                <i class="mdi mdi-calendar" aria-hidden="true"></i>
                                            </button>
                                        </div>
                                        <div class="docs-datepicker-container"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-2">
                                <div class="mb-2">
                                    <label class="col-form-label">DRS Amount</label>
                                    @Html.TextBoxFor(model => model.DRSAmount, new { @class = "form-control text-right", @readonly = "true" })
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-2">
                                <div class="mb-2">
                                    <label class="col-form-label">Skylark Amount</label>
                                    @Html.TextBoxFor(model => model.CollectedAmount, new { @class = "form-control aamt textright TotalInvoiceAmount", @readonly = "readonly" })
                                </div>
                            </div>

                            <div class="col-md-1">

                                <div class="mb-2 mt-2">
                                    <button type="button" class="btn btn-success waves-effect waves-light filter btn_top" id="btnrefresh" title="Get AWB List of Collected and POD!">
                                        <i class="bx bx-search mt-1" style="font-size: 21px;"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-3">
                                <div class="mb-2">
                                    <label class="col-form-label">Payment Mode</label>
                                    <select id="PaymentMode" class="form-select" onchange="PaymentModeChange()">
                                        <option value="1">Bank</option>
                                        <option value="2">Cash</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-2">
                                <div class="mb-2">
                                    <div id="divCash">
                                        <label class="required col-form-label">Cash</label>
                                        @Html.DropDownListFor(model => model.CashBank, new SelectList(@ViewBag.achead, "AcHeadID", "AcHead"), "Select", new { @class = "form-select" })

                                    </div>
                                    <div id="divBank">
                                        <div class="form-title">
                                            <label class=" required col-form-label">Cash/Bank Account</label>
                                        </div>
                                        <div class="form-field">
                                            @Html.DropDownListFor(model => model.ChequeBank, new SelectList(@ViewBag.acheadbank, "AcHeadID", "AcHead"), "Select", new { @class = "form-select", @required = true })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-2">
                                <div class="mb-2">
                                    <label class=" required col-form-label">Cheque Number.</label>
                                    @Html.TextBoxFor(model => model.ChequeNo, new { @class = "form-control textright", @required = true })
                                </div>
                            </div>


                            <div class="col-md-2">
                                <div class="mb-2">
                                    <label class="col-form-label">Cheque Date</label>
                                    <div class="docs-datepicker">
                                        <div class="input-group">
                                            <input type="text" class="form-control docs-date" name="ChequeDate" id="ChequeDate" value="@Model.ChequeDate"
                                                   placeholder="Pick a From Date" autocomplete="off">
                                            <button type="button"
                                                    class="btn btn-secondary docs-datepicker-trigger"
                                                    disabled>
                                                <i class="mdi mdi-calendar" aria-hidden="true"></i>
                                            </button>
                                        </div>
                                        <div class="docs-datepicker-container"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-2">
                                <div class="mb-2">
                                    <label class=" required col-form-label">DRS Receipt Amount</label>
                                    @Html.TextBoxFor(model => model.ReceivedAmount, new { @class = "form-control aamt textright TotalInvoiceAmount", @required = "required" })
                                </div>
                            </div>
                            <div class="col-xs-5 col-sm-10">
                                <div class="mb-2">
                                    <label class="col-form-label">Remarks</label>
                                    @Html.TextAreaFor(model => model.Remarks, new { @class = "form-control txttarget", @rows = '1' })
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-12">
                <div class="card">
                         <div class="card-body">
                                <table class="table table-bordered mb-0" id="datatable">
                                    <thead>
                                        <tr id="detailsfoot" style="background-color:#f2ebeb" ></tr>
                                        <tr style="background-color:#dedede">
                                            <th>S No.</th>
                                            <th>AWB No.</th>
                                            <th>PKP Cash</th>
                                            <th>COD</th>
                                            <th>MC Amt.</th>
                                            <th>Receipt Amt.</th>
                                            <th>Expense Amt.</th>
                                            <th>Remarks</th>
                                        </tr>
                                    </thead>
                                    <tbody id="detailsbody"></tbody>
                             </table>

                         </div>



                     </div>
                 </div>
   </div>






    }



<script type="text/javascript">
     function ValidateTotal() {
                             debugger;
                             var TotalAmount = 0;
                             var idtext = 'txtinvoice_';
                             var amt = 0;
                             if ($('#Balance').val() == "") {
            $('#Balance').val(0);
                             }
                             var balance =parseFloat($('#Balance').val());

            $('[id^=' + idtext + ']').each(function (index, item) {
                                 //  var id = $(item).attr('id').split('_')[1];
                                 if ($(item).val() == "" || $(item).val()==null) {
                    $(item).val(0);
                                 }
                                 var paidamount = parseFloat($(item).val());
                                 amt = amt + paidamount;

                                 if (parseFloat(amt) == 0) {
                    $('#btnSave').attr('disabled', 'disabled');
                                 }

                @*if (parseFloat($('#FMoney').val()) == 0) {
                    $('#FMoney').val(parseFloat(amt).toFixed(@_decimal))
                }*@
                $('#AllocatedAmount').val(parseFloat(amt).toFixed(@_decimal));
                var payingamount = parseFloat($('#FMoney').val());
                var allocatedamount = parseFloat($('#AllocatedAmount').val());
                var advance = 0;
                if (allocatedamount > (payingamount + advance)) {
                    $('#btnSave').attr('disabled', 'disabled');
                }
                else if (parseFloat(amt) == 0) {
                    $('#btnSave').attr('disabled', 'disabled');
                }
                else {
                    $('#btnSave').removeAttr('disabled');
                }

                //$('#Balance').val(parseFloat(advance).toFixed(@_decimal));

            });

            //var TotalInvoiceAmount = parseFloat($('.TotalInvoiceAmount').val());
            //if (TotalAmount > TotalInvoiceAmount) {
            //    $('#msg1').show();
            //    $('#msg1').text('Sum of Amount cannot be greater than Total Invoice Amount');
            //    return false;
            //} else {
            //    return true;
            //}
        }
    // When the document is ready

    $(document).ready(function () {
        var startdate = '@Session["FyearFrom"].ToString()';
        var enddate = '@Session["FyearTo"].ToString()';
        var sd = new Date(startdate.split('-')[1] + '-' + startdate.split('-')[0] + '-' + startdate.split('-')[2]);
        var ed = new Date(enddate.split('-')[1] + '-' + enddate.split('-')[0] + '-' + enddate.split('-')[2]);
        var datevalid = false;
        var dateerror = "";

        //$('#DRSRecPayDate').datetimepicker({
        //    maxDate: ed,
        //    minDate: sd,
        //    format: 'DD-MM-YYYY'
        //});
        $('#DRSDate').datepicker({
            maxDate: ed,
            minDate: sd,
            dateFormat: 'dd-mm-yy'
        });
        $('#ChequeDate').datepicker({
            maxDate: ed,
            minDate: sd,
            dateFormat: 'dd-mm-yy'
        });
        $('#PODDate').datepicker({
            maxDate: ed,
            minDate: sd,
            dateFormat: 'dd-mm-yy'
        });
          $('#RecPayDate').keydown(function (e) {

            if (e.keyCode == 13 || e.keyCode == 9) {
                if ($("#RecPayDate").val() != "") {
                    $.ajax({
                        url: "@Url.Action("CheckDateValidate", "Accounts")",
                        data: { entrydate: $("#RecPayDate").val() },
                        type: "GET",
                        dataType: "json",
                        success: function (response) {

                            if (response.Status == "OK") {
                                datevalid = true;
                                dateerror = response.Message;
                            }
                            else {
                                datevalid = false;
                                dateerror = response.Message;
                                $('#RecPayDate').val(response.ValidDate);
                            }

                        },
                        error: function () {
                            alert("Failed! Please try again.");
                        }
                    });
                }
            }
        });
        $('#RecPayDate').change(function ()    {

            if ($("#RecPayDate").val() != "") {
                 $.ajax({
                url: "@Url.Action("CheckDateValidate", "Accounts")",
                     data: { entrydate: $("#RecPayDate").val()},
                type: "GET",
                dataType: "json",
                     success: function (response) {
                    if (response.Status == "OK") {
                        datevalid = true;
                        dateerror = response.Message;
                    }
                    else {
                        datevalid = false;
                        dateerror = response.Message;
                        $('#RecPayDate').val(response.ValidDate);
                        alert(dateerror);
                    }

                },
                error: function () {
                    alert("Failed! Please try again.");
                }
            });
            }
        });

        $('#RecPayDate').on('dp.change', function (e) {
            $('#RecPayDate').trigger('change');
        })

        $('#RecPayDate').datepicker("setDate", new Date());


    });

</script>
