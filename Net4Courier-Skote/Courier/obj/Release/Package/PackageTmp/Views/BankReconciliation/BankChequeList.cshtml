@model Net4Courier.Models.BankReconcSearch
@{
    int i = 0;
    var _decimal = @Session["Decimal"].ToString();
}

<style>
    .Receipt{
        color:blue;
    }
    .Payment{
        color:red;
    }
</style>
<script type="text/javascript">
    //millions format
    function addCommas(nStr) {

        nStr += '';
        var x = nStr.split('.');
        var x1 = x[0];
        var x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + ',' + '$2');
        }
        return x1 + x2;
    }
    function ValidateTotal() {
    debugger;
    var TotalAmount = 0;
    
    var idtext = 'hdnAmount_';
    var amt = 0;

 
   
        $('[id^=' + idtext + ']').each(function (index, item) {
            debugger;
        var id = $(item).attr('id').split('_')[1];
        if ($(item).val() == "" || $(item).val() == null) {
            $(item).val(0);
        }
        var itemval = $(item).val();
        itemval = itemval.replace(',', '');

        if ($('#hdnVoucherType_' + index).val() == 'Receipt') {

             TotalAmount = parseFloat(TotalAmount) + parseFloat(itemval);

        }
        else {
             TotalAmount = parseFloat(TotalAmount) - parseFloat(itemval);
        }

            $('#spantotal').html(addCommas(parseFloat(TotalAmount).toFixed(2)));
            if (TotalAmount < 0) {
                $('#spantotal').addClass('Payment');
                $('#spantotal').removeClass('Receipt');
            }
            else {
                $('#spantotal').removeClass('Payment');
                $('#spantotal').addClass('Receipt');
            }

});


    }
    $(document).ready(function () {


        var table1 = $('#DetailsTable').DataTable({ "paging": false, "sPaginationType": "simple" });

        //table1.columns().every(function () {
        //    var that = this;

        //    $('input', this.footer()).on('keyup change', function () {
        //        if (that.search() !== this.value) {
        //            that
        //                .search(this.value)
        //                .draw();
        //        }
        //    });
        //});
        ValidateTotal();
    });
</script>
<table class="table table-bordered table-responsive" id="DetailsTable" style="background-color: white">

    <thead >
        <tr class="table-light">
            <th width="2%">SNo.</th>
            <th width="5%">Voucher No.</th>
            <th width="5%">Voucher Date</th>
            <th width="5%">Cheque No.</th>         
            <th width="18%">Particulars | Party Name | <br /> Updated Status | Comments</th>
            
            <th width="10%">Amount</th>
            
            @*<th width="20%">Status</th>*@

            <th width="5%">Charges</th>
            @*<th width="10%">Comments</th>*@
        </tr>
        
    </thead>
    <tbody class="input-table" id="chequetablebody">
        <tr>
            <td> </td>
            <td></td>
            <td></td>
            <td></td>
            
        
          
            <td><span id="spantotal" style="font-weight:bold"></span></td>
            <td></td>
            @*<td width="20%"></td>*@

            <td width="5%"></td>
            @*<td width="10%"></td>*@
        </tr>
        @foreach (var item in Model.Details)
        {
            <tr class="@item.VoucherType">
                <td>

                    @Html.HiddenFor(model => model.Details[i].AcBankDetailID, new { @Value = @item.AcBankDetailID, @id = "hdnDetailID_" + @i })
                    @Html.HiddenFor(model => model.Details[i].VoucherType, new { @Value = @item.VoucherType, @id = "hdnVoucherType_" + @i })
                    @Html.HiddenFor(model => model.Details[i].Amount, new { @Value = @item.Amount, @id = "hdnAmount_" + @i })
                    @Html.HiddenFor(model => model.Details[i].AcJournalID, new { @Value = @item.AcJournalID })
                    @Html.HiddenFor(model => model.Details[i].ChequeNo, new { @Value = @item.ChequeNo })

                    @(i + 1)
                    @Html.CheckBoxFor(model => model.Details[i].StatusReconciled, new { @class = " ", style = "margin-left:10px;", @id = "chk_" + @i, @Detailid = @item.AcBankDetailID, @onchange = "redrawgrid(this)" })  @*, @onchange = "redrawgrid(this)"*@
                </td>
                <td>
                    <a target="_blank" style="text-decoration:underline" href="@item.TransactionPage">@item.VoucherNo</a> <br />
                    @item.VoucherType1
                    
                </td>
                <td>@Net4Courier.Models.CommonFunctions.GetShortDateFormat(@item.VoucherDate)</td>
                <td>
                    @item.ChequeNo <br />
                    @Net4Courier.Models.CommonFunctions.GetShortDateFormat(@item.ChequeDate)
                </td>
                
                <td>
                    <span class="text_over" title="@item.Narration"> @item.Narration </span> <br />
                    @{
                        if (@item.PartyName != null && @item.PartyName != "")
                        {
                            <p class="text_over" title="@item.PartyName"> @item.PartyName </p> <br />
                        }
                    }
                    @Html.DropDownListFor(model => model.Details[i].ChangeStatus, new SelectList(ViewBag.ChequeStatus, "BRCode", "Comment"), new { @class = "form-select-sm", @id = "dwstatus_" + @i, @value = @item.ChangeStatus }) <br /><br />
                    @Html.TextBoxFor(model => model.Details[i].Remarks, new { @id = "txtremarks_" + @i, @class = "form-control-sm",@style="width:100%" })
                </td>
                
                <td class="text-right">
                    @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.Amount, _decimal)
                </td>
                
                @*<td>
                    @Html.TextBoxFor(model => model.Details[i].ReconcDate, new { @class = " ", style = "margin-left:10px;", @id = "txtreconcdate_" + @i})
                </td>*@
                @*<td>
                 
                </td>*@
                <td>
                    @Html.TextBoxFor(model => model.Details[i].BankCharges, new { @id = "txtcharge_" + @i, @class = "text-right form-control-sm" ,@style="width:100px!important" })
                </td>
                @*<td>
                   
                </td>*@
            </tr>
            i++;
        }




    </tbody>

</table>

<script>
    $(document).ready(function () {


        $("#AWBSelectall").change(function () {
            getconsignorawblist();
           
        });
       
    });

</script>
