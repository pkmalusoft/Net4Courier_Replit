@model Net4Courier.Models.CourierExpensesVM

@{
    
    ViewBag.pTitle = "DRS Expenses";
    ViewBag.pageTitle = "OutScan";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var spath = "/DRSExpense/Index/0";// System.Configuration.ConfigurationManager.AppSettings["spath"].ToString();
    var _decimal = @Session["Decimal"].ToString();
}


<style>


    .modal-dialog {
        width: 800px;
    }

    #staffmodelbody {
        max-height: calc(100vh - 200px);
        overflow-y: auto;
    }

    .flex {
        display: flex;
    }

    .justify-content-between {
        justify-content: space-between;
    }

    #popup h5 {
        border: 2px solid #35b8eb;
        min-width: 150px;
        height: 40px;
        border-radius: 5px;
        line-height: 40px;
        color: #35b8eb;
        text-align: center;
        font-weight: bold;
    }
</style>
<script type="text/javascript">
    
  
    function isNumberKey1(evt) {
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        //if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
        if (charCode != 8 && charCode != 0 && (charCode < 48 || charCode > 57))
            return false;

        return true;
    }

    $(document).ready(function () {

        $(":text").css({ "border-radius": "5px" });
        $("select").css({ "border-radius": "5px" });
        $("textarea").css({ "border-radius": "5px" });

        //$("#FMoney").attr("readonly", false);
        $("#PaymentMode").focus();

        $("#DRSBased").change(function () {
            if (!$("#DRSBased").is(':checked')) {
                $('#DRSNo').attr('readonly', 'readonly');
                $('#DRSNo').val('');
                $('#DRSID').val(0);
                $('#DRSNo').removeAttr('required');
            }
            else {
                $('#DRSNo').removeAttr('readonly');
                $('#DRSNo').attr('required', 'required');
            }
        });

       
         
       
        
        $('#DeliveredBy').blur(function () {
            if (!$("#DRSBased").is(':checked')) {
                $("#CashBank").focus();
            }
            else {
                $("#DRSNo").focus();
            }

        });

        
        
        $('#btnrefresh').click(function () {
            if ($('#DRSRecPayID').val() == 0) //create mode
            {
                getCollectedAmount();
            }
        })
           $("#ReceivedAmount").blur(function () {
            var wt = $(this).val();
            if (wt == null || wt == "") {
                $("#ReceivedAmount").val("0.00");
            } else {
                $("#ReceivedAmount").val(parseFloat(wt).toFixed(@_decimal));
            }
        });

         $("#DRSNo").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: '/DRSReceipt/GetDRSNo',
                    datatype: "json",
                    data: {
                        term: request.term, DeliveredBy: $('#EmployeeID').val(), RecpayId: 0},
                    success: function (data) {
                        response($.map(data, function (val, item) {
                            return {
                                label: val.DRSNo,
                                value: val.DRSID,
                                DRSDate: val.DRSDate,
                                CheckedBy: val.CheckedBy,
                                TotalAmount:val.TotalAmount
                            }
                        }))
                    }
                })
            },
            minLength: 0,
            autoFocus: false,
             focus: function (e, i) {
                 e.preventDefault();
                $("#DRSNo").val(i.item.label);
                $('#DRSID').val(i.item.value);
                $('#DRSID').attr('label', i.item.label);
                var myDate = new Date(i.item.DRSDate.match(/\d+/)[0] * 1);
                var cmon = myDate.getMonth() + 1;
                var collectdate = myDate.getDate() + "-" + cmon + "-" + myDate.getFullYear();
                $('#DRSDate').val(collectdate);
                //$('#DeliveredBy').val(i.item.CheckedBy);
                $('#DRSAmount').val(i.item.TotalAmount);
             },
            select: function (e, i) {
                e.preventDefault();
                $("#DRSNo").val(i.item.label);
                $('#DRSID').val(i.item.value);
                $('#DRSID').attr('label', i.item.label);
                var myDate = new Date(i.item.DRSDate.match(/\d+/)[0] * 1);
                var cmon = myDate.getMonth() + 1;
                var collectdate = myDate.getDate() + "-" + cmon + "-" + myDate.getFullYear();// + ' ' + myDate.getHours() + ':' + myDate.getMinutes();
                $('#DRSDate').val(collectdate);

                //$('#DeliveredBy').val(i.item.CheckedBy);
                $('#DRSAmount').val(i.item.TotalAmount);

            },

        });
        $('#btnsearch').click(function () {

            if ($('#CustomerID').val() == 0) {
                alert('Select Customer!');
                return;
            }

            if ($('#ReceivedAmount').val() == "") {// || $('#FMoney').val()=="0") {
                //alert('Enter Receipt Amount!');
                $('#ReceivedAmount').val(0);
            }

            var ID = $('#DRSID').val();
            var RecPayId = $('#DRSRecPayID').val();
            $.ajax({
                type: "GET",
                url: '/DRSReceipt/GetDRSAWB/',
                data: { 'DRSID': ID, 'RecPayId': RecPayId },
                success: function (data) {
                    $('#tbl1').html('');
                    //$scope.Orders = data;
                    var amt = 0;
                    for (var i = 0; i < data.length; i++) {

                        debugger;

                        $('#tbl1').append('<tr>' +
                            '<td>' + data[i].AWBNO + '<input type = "hidden" name ="Details[' + i + '].AWBNO"  value = "' + data[i].AWBNO + '" /><input type="hidden" name="Details[' + i + '].DRSRecPayDetailID"  value="' + data[i].DRSRecPayDetailID + '" /><input type="hidden" name="Details[' + i + '].InScanID"  value="' + data[i].InScanID + '" />  </td>' +
                            '<td>' + data[i].AWBDate + '<input id="" name="Details[' + i + '].AWBDate" value=' + data[i].DateTime + ' type="hidden"></td>' +
                            '<td class="text-right">' + parseFloat(data[i].CourierCharge).toFixed(@_decimal) + '<input id="" name="Details[' + i + '].CourierCharge" value=' + data[i].CourierCharge + ' type="hidden"></td>' +
                            '<td class="text-right">' + parseFloat(data[i].MaterialCost).toFixed(@_decimal) + '<input id="" name="Details[' + i + '].MaterialCost" value=' + data[i].MaterialCost+ ' type="hidden"/></td>' +
                            '<td class="text-right"><input class="text-right" id="txtccrec_' + i + '" name="Details[' + i + '].CCReceived" value="' + data[i].CCReceived + '" type="text" onchange="CheckAmt1(this)"/></td>' +
                            '<td class="text-right"><input class="text-right" id="txtmcrec_' + i + '" name="Details[' + i + '].MCReceived" value="' + data[i].MCReceived + '" type="text" onchange="CheckAmt1(this)"/></td>' +
                            '<td class="text-right"><input class="text-right" id="txttotal_' + i + '" name="Details[' + i + '].TotalAmount" value="' + data[i].TotalAmount + '" type="text"></td>' +
                            '<td class="text-right"><input class="text-right" id="txtbalance_' + i + '" name="Details[' + i + '].Balance" value="' + data[i].Balance + '" type="text"></td>' +
                            '<td class="text-right"><input class="text-right" id="txtdiscount_' + i + '" name="Details[' + i + '].Discount" value="' + data[i].Discount + '" type="text" onchange="CheckAmt1(this)"></td>' +
                            '<td> <input type="checkbox" id="chkstatus_' + data[i].StatusClose + '" class="" name="Details[' + i + '].StatusClose" />' +
                            '</tr>');
                        //hideLoading();
                    }


                }
            });

        });
        $("#DRSNo").change(function () {
            if ($('#DRSNo').val() != $('#DRSID').attr('label')) {
                $('#DRSNo').val('');
                $('#DRSID').val('0');
                $('#DRSNo').focus();
            }

    });


        if ($('#ExpenseID').val() > 0) {
            if ($('#IsLocked').val() == "True") {
                Swal.fire('Data Validation', 'Settlement Expense could not be edited!', 'error');
                $('#btnSave').attr('disabled', 'disabled');
            }
        }
        else {
            
        }

         
      

    
     
        document.addEventListener('keydown', function (event) {
            if (event.code == 'KeyS' && (event.altKey)) { //ADD AWB
                $('#btnSave').trigger('click');
            }
        });
    });
</script>

<script>
     
</script>

 

<!-- Main content -->

    @using (Html.BeginForm("Create", "DRSExpense", FormMethod.Post, new { @id = "FormReceipt" }))
    {
        @Html.ValidationSummary(true)
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        @Html.HiddenFor(model => model.ExpenseID)
                        @Html.HiddenFor(model => model.IsLocked)
                        <div class="row">
                            <div class="col-md-8"></div>
                            <div class="col-md-4 text-md-end">
                                <div class="mb-2">
                                    @if (Model.ExpenseID > 0)
                                    {
                                        <input type="submit" class="btn btn-success" value="Update" id="btnSave" />
                                    }
                                    else
                                    {
                                        <input type="submit" class="btn btn-success" value="Save" id="btnSave" name="Command" />
                                    }
                                    <a href='@Url.Action("Index", "DRSExpense", new { id = 0 })' class="btn btn-secondary">Cancel</a>
                                </div>
                            </div>


                            <div class="col-md-2">
                                <div class="mb-2">
                                    <label class="col-form-label">Expense Date</label>
                                    <div class="docs-datepicker">
                                        <div class="input-group">
                                            <input type="text" class="form-control docs-date" name="ExpenseDate" id="ExpenseDate" value="@Model.ExpenseDate.ToShortDateString()"
                                                   placeholder="Pick a From Date" autocomplete="off">
                                            <button type="button"
                                                    class="btn btn-secondary docs-datepicker-trigger"
                                                    disabled>
                                                <i class="mdi mdi-calendar" aria-hidden="true"></i>
                                            </button>
                                        </div>
                                        <div class="docs-datepicker-container"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-2">
                                <div class="mb-2">
                                    <label class="col-form-label required">Courier Name</label>
                                    @Html.DropDownListFor(model => model.EmployeeID, new SelectList(ViewBag.Deliverdby, "EmployeeID", "EmployeeName"), "Select", new { @class = "form-select", @required = true })
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-2">
                                <div class="mb-2">
                                    <div class="flexTitle">
                                        <label class="col-form-label">DRS Number</label>
                                        <div class="checkboxdesign no-padding  text-right" style="float:right">
                                            @Html.CheckBox("DRSBased", new { @name = "DRSBased" }) &nbsp
                                            <label class="col-form-label" style="color:#07a7e3!important;padding-left: 0!important">DRS Based</label>
                                        </div>
                                    </div>
                                    @Html.TextBoxFor(model => model.DRSNo, new { @class = "form-control" })
                                    @Html.HiddenFor(mode => Model.DRSID)
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="mb-2">
                                    <label class="col-form-label">DRS Date</label>
                                    <div class="docs-datepicker">
                                        <div class="input-group">
                                            <input type="text" class="form-control docs-date" name="DRSDate" id="DRSDate" title="Actual date of delivery and Amount collected Date!" value="@Model.DRSDate"
                                                   placeholder="Pick a From Date" autocomplete="off">
                                            <button type="button"
                                                    class="btn btn-secondary docs-datepicker-trigger"
                                                    disabled>
                                                <i class="mdi mdi-calendar" aria-hidden="true"></i>
                                            </button>
                                        </div>
                                        <div class="docs-datepicker-container"></div>
                                    </div>
                                </div>
                            </div>




                            <div class="col-xs-12 col-sm-4">
                                <div class="mb-2">
                                    <label class="col-form-label">Expense Type</label>
                                    @Html.DropDownListFor(model => model.RevenueTypeID, new SelectList(@ViewBag.Revenuetypes, "RevenueTypeID", "RevenueType1"), "Select", new { @class = "form-select" })
                                </div>
                            </div>






                            <div class="col-xs-12 col-sm-2">
                                <div class="mb-2">
                                    <label class=" required col-form-label" id="lblAmountType">Expense Amount</label>
                                    @Html.TextBoxFor(model => model.ExpenseAmount, new { @class = "form-control aamt textright TotalInvoiceAmount", @required = "required" })
                                </div>
                            </div>
                            <div class="col-xs-5 col-sm-4">
                                <div class="mb-2">
                                    <label class="col-form-label">Remarks</label>
                                    @Html.TextAreaFor(model => model.Remarks, new { @class = "form-control txttarget", @rows = '1' })
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            
      
   </div>






    }



<script type="text/javascript">
   
    // When the document is ready

    $(document).ready(function () {
        var startdate = '@Session["FyearFrom"].ToString()';
        var enddate = '@Session["FyearTo"].ToString()';
        var sd = new Date(startdate.split('-')[1] + '-' + startdate.split('-')[0] + '-' + startdate.split('-')[2]);
        var ed = new Date(enddate.split('-')[1] + '-' + enddate.split('-')[0] + '-' + enddate.split('-')[2]);
        var datevalid = false;
        var dateerror = "";

       
        $('#ExpenseDate').datepicker({
            maxDate: ed,
            minDate: sd,
            dateFormat: 'dd-mm-yy'
        });
        

    });

</script>
