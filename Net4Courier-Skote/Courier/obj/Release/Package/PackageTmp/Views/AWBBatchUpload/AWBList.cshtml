@model  Net4Courier.Models.AWBBatchVM

@{    
    Layout = null;
    var _alphanum = Session["AWBAlphaNumeric"].ToString();
    var i = 0;
    var _decimal = "2";
}


<script type="text/javascript">
     
    $(document).ready(function () {

        $('#AWBNo').change(function () {
            if ('@_alphanum' == 'True') {
                var txt = $('#AWBNo').val().trim();
                $('#AWBNo').val(txt.replace(/[^\d,]/g, ''));
            }
        });


    });
</script>
<script type="text/javascript">
    function ClearData() {
        $('#MovementTypeID').val(0).trigger('change');
        $('#PaymentModeId').val(0).trigger('change');
        $('#Destination').val('');
        $('#Origin').val('');
        $('#ConsignorConsignee').val('');
        var d = new Date();
        var curr_date = d.getDate();
        var curr_month = d.getMonth() + 1;
        var curr_year = d.getFullYear();

        var reqdate = curr_date + "-" + curr_month + "-" + curr_year;
        $('#FromDate').val(reqdate);
        $('#ToDate').val(reqdate);
    }

    function ShowInvoice(InScanId, obj) {
        debugger;
        var invoiceid = $(obj).attr('invoiceid');
        var coinvoiceid = $(obj).attr('coinvoiceid');
        var importshipmentid = $(obj).attr('importshipmentid');

        var url = '';
        if (importshipmentid == 0 && invoiceid == 0) {
            url = '/CustomerInvoice/Create';
        }
        else if (importshipmentid > 0 && coinvoiceid == 0) {
            url = '/COLoaderInvoice/Create';
        }
        else if (importshipmentid == 0 && invoiceid > 0) {

            url = '/CustomerInvoice/Edit?id=' + invoiceid;
        }
        else if (importshipmentid > 0 && coinvoiceid > 0) {
            url = '/COLoader/Edit?id=' + coinvoiceid;
        }

        window.open(url, '_blank').focus();


    }
        function ShowStatusModal(InScanId) {

            $('#InScanID').val(InScanId);

          $.ajax({
            type: "POST",
            url: "/AWB/GetActiveStatus",
            datatype: "Json",
            data: { 'InScanID': InScanId },
            success: function (response) {
                debugger;
                console.log(response);
                var _detail = response.data;
                console.log(_detail);
                $('#CourierStatusId').val(_detail.CourierStatusID);
                $('#StatusTypeId').val(_detail.StatusTypeID);
                $('#ChangeStatusTypeId').val(_detail.StatusTypeID).trigger('change');
                $('#ChangeCourierStatusId').val($('#CourierStatusId').val()).trigger('change');
                $('#ChangeCourierStatusId').attr('disabled', 'disabled');
                if (_detail.ShipmentReturned)
                    $('#ChkReturned').prop('checked', true);
                if ($('#ChangeCourierStatusId').val() != 13) {
                    $('#ChkReturned').attr('disabled','disabled')
                } else{
                    $('#ChkReturned').removeAttr('disabled');
                }
                $('#txtRemarks').val(_detail.Remarks);
                 $('#StatusModal').modal('show');

            }
        });

    }
        $(document).ready(function () {
            $('#dataTables-example tfoot th').each(function () {
                var title = $(this).text();
                $(this).html('<input type="text" style="width:100%" />');
            });



            var table = $('#dataTables-example').DataTable({
                "aaSorting": []
                //"dom": '<"top"i>rt<"top"flp><"clear">',
                	//dom: "<'row'<'col-sm-3'l><'col-sm-3'f><'col-sm-6'p>>" +
                 //       "<'row'<'col-sm-12'tr>>" +"<'row'<'col-sm-5'i><'col-sm-7'p>>",
                 //"pagingType": "simple"
            });
            table.draw();
           table.columns().every(function () {
                var that = this;

                $('input', this.footer()).on('keyup change', function () {
                    if (that.search() !== this.value) {
                        that
                            .search(this.value)
                            .draw();
                    }
                });
            });


               $('#ChangeStatusTypeId').change(function () {
            debugger;
            var pcourierstatusid = $('#CourierStatusId').val();
            if (pcourierstatusid == null)
                pcourierstatusid = 0;

            $.ajax({
                type: "POST",
                url: "/AWB/GetStatus",
                datatype: "Json",
                data: { 'StatusTypeId' : $('#ChangeStatusTypeId').val() },
                success: function (response) {
                    debugger;
                    //$('#CourierStatusId').select2("destroy");
                    $('#ChangeCourierStatusId').html('');
                    var opthtml = '<option value="0">Select</option>';
                    $(response.data).each(function (index, item) {
                        if (item.id == pcourierstatusid) {
                               opthtml += '<option selected value="' + item.id + '">' + item.text + '</option>';
                        }
                        else {
                            opthtml += '<option value="' + item.id + '">' + item.text + '</option>';
                        }
                    });
                    $('#ChangeCourierStatusId').html(opthtml);
                     $('#ChangeCourierStatusId').val($('#CourierStatusId').val()).trigger('change');
                    //$('#CourierStatusId').val(response.data[2].id);
                    //$('#ChangeCourierStatusId').select2();
                    //$('#CourierStatusId').val("2").trigger('change');
                    //$('#CourierStatusId').select2('data', response.data[2]);
                    //$('#CourierStatusId').val('2').text(response.data[2].text);


                    // $('#ChangeCourierStatusId').select2({
                    //        width: '100%',
                    //        allowClear: true,
                    //        multiple: false,
                    //        maximumSelectionSize: 1,
                    //        minimumResultsForSearch :-1,
                    //        placeholder: "Select Status"
                    //        });

                    }
              });
           });

            $('#btnsavestatus').click(function () {
                debugger;
               console.log($('#ChkReturned').prop('checked'));
             var statusobj = {
                InScanID: $('#InScanID').val(),
                StatusTypeID: $('#ChangeStatusTypeId').val(),
                CourierStatusID: $('#ChangeCourierStatusId').val(),
                Remarks : $('#txtRemarks').val(),
                ShipmentReturned: $('#ChkReturned').prop('checked')
            };

             $.ajax({
                type: "POST",
                url: "/AWB/SaveStatus",
                datatype: "Json",
                data: statusobj,
                success: function (response) {
                    debugger;
                    if (response.status == "ok") {
                        $.notify("Status Updated Successfully!", "success");
                        window.location.reload();
                    }
                    else
                    { $.notify("Save Failed :" + response.message, "warning"); }


                     $('#StatusModal').modal('hide');
                }
            });


        });
            $("#Origin").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "@Url.Action("GetEventVenuesList", "ZoneChart")",
                    data: { SearchText: request.term },
                    dataType: "json",
                    type: "GET",
                    success: function (data) {
                        if (data.length == 0) {
                            return false;
                        }
                        else {
                            response($.map(data, function (item) {
                                return {
                                    label: item.description,
                                    value: item.place_id
                                }
                            }));
                        }
                    },
                    error: function (x, y, z) {
                        alert('error');
                    }
                });
            },
            messages: {
                noResults: "", results: ""
            },
            select: function (event, ui) {
                $('#Origin').val(ui.item.label);
                return false;
            },
            focus: function (event, ui) {
                $('#Origin').val(ui.item.label);
                return false;
            }
            });

             $("#Destination").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "@Url.Action("GetEventVenuesList", "ZoneChart")",
                    data: { SearchText: request.term },
                    dataType: "json",
                    type: "GET",
                    success: function (data) {
                        if (data.length == 0) {
                            return false;
                        }
                        else {
                            response($.map(data, function (item) {
                                return {
                                    label: item.description,
                                    value: item.place_id
                                }
                            }));
                        }
                    },
                    error: function (x, y, z) {
                        alert('error');
                    }
                });
            },
            messages: {
                noResults: "", results: ""
            },
            select: function (event, ui) {
                $('#Destination').val(ui.item.label);
                return false;
            },
            focus: function (event, ui) {
                $('#Destination').val(ui.item.label);
                return false;
            }
        });

            document.addEventListener('keydown', function (event) {
                console.log(event.code);
                if (event.code == 'KeyR' && (event.altKey)) {
                    $('#btnsearch').trigger('click');
                }
                if (event.code == 'KeyEnter' && (event.altKey)) {
                    $('#btnsearch').trigger('click');
                }
                //if (event.code == 'KeyL' && (event.altKey)) {
                //    $('#lblconsignorLocation').attr('popup', 'open');
                //    $('#lblconsigneeLocation').attr('popup', '');
                //    showLocationEntry();
                //}
                //if (event.code == 'KeyN' && (event.altKey)) {
                //    $('#lblconsignorLocation').attr('popup', '');
                //    $('#lblconsigneeLocation').attr('popup', 'open');
                //    showLocationEntry();
                //}
            });
            $('#AWBNo').focus();

            //$('#AWBNo').blur(function () {
            //    $('#AWBNo').focus();
            //});
        });


</script>

 
<div class="card">
    <div class="card-body">
        <div class="table-responsive" style="padding:15px">
            <table class="table table-bordered mb-0" id="datatable1" style="width:100%">
                <thead class="table-light">
                    <tr>
                        <th width="10%">
                            AWB No. & Date
                        </th>
                        <th width="15%">
                            Consignor | Origin
                        </th>
                        <th width="15%">
                            Consignee | Destination
                        </th>
                        <th width="20%">AWB Type</th>
                        <th width="10%">Pcs | Weight <br /> Invoice</th>
                        <th width="10%">Charges</th>
                        <th width="5%">Action</th>
                    </tr>
                </thead>


                <tbody id="tblbody">
                    @foreach (var item in Model.Details)
                    {

                    <tr id="trrow_@i">

                        <td>
                            @Html.HiddenFor(model => model.Details[i].InScanID, new { @Value = @item.InScanID, @id = "hdnShipmentID_" + @i })
                            @Html.HiddenFor(model => model.Details[i].AWBNo, new { @Value = @item.AWBNo, @id = "hdnAWBNo_" + @i })
                            @Html.HiddenFor(model => model.Details[i].CustomerID, new { @Value = @item.CustomerID, @id = "hdnCustomerID_" + @i })
                            @Html.HiddenFor(model => model.Details[i].CustomerName, new { @Value = @item.CustomerName, @id = "hdnCustomerName_" + @i })
                            @Html.HiddenFor(model => model.Details[i].PaymentModeId, new { @Value = @item.PaymentModeId, @id = "hdnPaymentModeId_" + @i })
                            @Html.HiddenFor(model => model.Details[i].Consignor, new { @Value = @item.Consignor, @id = "hdnConsignor_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsignorContact, new { @Value = @item.ConsignorContact, @id = "hdnConsignorContact_" + @i })
                            @Html.HiddenFor(model => model.Details[i].Consignee, new { @Value = @item.Consignee, @id = "hdnConsignee_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsigneeContact, new { @Value = @item.ConsigneeContact, @id = "hdnConsigneeContact_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsignorAddress1_Building, new { @Value = @item.ConsignorAddress1_Building, @id = "hdnConsignorAddress1_Building_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsignorAddress2_Street, new { @Value = @item.ConsignorAddress2_Street, @id = "hdnConsignorAddress2_Street_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsignorAddress3_PinCode, new { @Value = @item.ConsignorAddress3_PinCode, @id = "hdnConsignorAddress3_PinCode_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsignorPhone, new { @Value = @item.ConsignorPhone, @id = "hdnConsignorPhone_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsignorMobileNo, new { @Value = @item.ConsignorMobileNo, @id = "hdnConsignorMobileNo_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsignorLocationName, new { @Value = @item.ConsignorLocationName, @id = "hdnConsignorLocationName_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsignorCityName, new { @Value = @item.ConsignorCityName, @id = "hdnConsignorCityName_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsignorCountryName, new { @Value = @item.ConsignorCountryName, @id = "hdnConsignorCountryName_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsigneeAddress1_Building, new { @Value = @item.ConsigneeAddress1_Building, @id = "hdnConsigneeAddress1_Building_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsigneeAddress2_Street, new { @Value = @item.ConsigneeAddress2_Street, @id = "hdnConsigneeAddress2_Street_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsigneeAddress3_PinCode, new { @Value = @item.ConsigneeAddress3_PinCode, @id = "hdnConsigneeAddress3_PinCode_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsigneeCountryName, new { @Value = @item.ConsigneeCountryName, @id = "hdnConsigneeCountryName_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsigneeCityName, new { @Value = @item.ConsigneeCityName, @id = "hdnConsigneeCityName_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsigneeLocationName, new { @Value = @item.ConsigneeLocationName, @id = "hdnConsigneeLocationName_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsigneePhone, new { @Value = @item.ConsigneePhone, @id = "hdnConsigneePhone_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ConsigneeMobileNo, new { @Value = @item.ConsigneeMobileNo, @id = "hdnConsigneeMobileNo_" + @i })
                            @Html.HiddenFor(model => model.Details[i].CourierCharge, new { @Value = @item.CourierCharge, @id = "hdnCourierCharge_" + @i })
                            @Html.HiddenFor(model => model.Details[i].OtherCharge, new { @Value = @item.OtherCharge, @id = "hdnOtherCharge_" + @i })
                            @Html.HiddenFor(model => model.Details[i].NetTotal, new { @id = "hdnNetTotal_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ParcelTypeId, new { @id = "hdnParcelTypeID_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ProductTypeID, new { @id = "hdnProductTypeID_" + @i })
                            @Html.HiddenFor(model => model.Details[i].MovementID, new { @id = "hdnMovementID_" + @i })
                            @Html.HiddenFor(model => model.Details[i].Pieces, new { @id = "hdnPieces_" + @i })
                            @Html.HiddenFor(model => model.Details[i].Weight, new { @id = "hdnWeight_" + @i })
                            @Html.HiddenFor(model => model.Details[i].TaxPercent, new { @id = "hdnTaxPercent_" + @i })
                            @Html.HiddenFor(model => model.Details[i].TaxAmount, new { @id = "hdnTaxAmount_" + @i })
                            @Html.HiddenFor(model => model.Details[i].SurchargePercent, new { @id = "hdnSurchargePercent_" + @i })
                            @Html.HiddenFor(model => model.Details[i].SurchargeAmount, new { @id = "hdnSurchargeAmount_" + @i })
                            @Html.HiddenFor(model => model.Details[i].MaterialCost, new { @id = "hdnMaterialCost_" + @i })

                            @*@Html.HiddenFor(model => model.Details[i].BagNo, new { @id = "hdnBagNo_" + @i })*@
                            @Html.HiddenFor(model => model.Details[i].AWBDate, new { @id = "hdnAWBDate_" + @i })
                            
                            @Html.HiddenFor(model => model.Details[i].Remarks, new { @id = "hdnRemarks_" + @i })
                            @Html.HiddenFor(model => model.Details[i].CargoDescription, new { @id = "hdnCargoDescription_" + @i })
                            @Html.HiddenFor(model => model.Details[i].IsDeleted, new { @id = "hdndeleted_" + @i })
                            @Html.HiddenFor(model => model.Details[i].EntrySource, new { @id = "hdnEntrySource_" + @i })
                            @Html.HiddenFor(model => model.Details[i].MovementType, new { @id = "hdnMovementType_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ParcelType, new { @id = "hdnParcelType_" + @i })
                            @Html.HiddenFor(model => model.Details[i].ProductType, new { @id = "hdnProductType_" + @i })
                            @Html.HiddenFor(model => model.Details[i].Currency, new { @id = "hdnCurrency_" + @i })
                            @Html.HiddenFor(model => model.Details[i].CurrencyID, new { @id = "hdnCurrencyID_" + @i })
                            @Html.HiddenFor(model => model.Details[i].CustomsValue, new { @id = "hdnCustomsValue_" + @i })
                            @*@Html.HiddenFor(model => model.Details[i].MAWB, new { @id = "hdnMAWB_" + @i })*@
                            @*@Html.HiddenFor(model => model.Details[i].ManifestWeight, new { @id = "hdnManifestWeight_" + @i })*@
                            
                            <a target="_blank" href="/AWB/Create?id=@item.InScanID">@item.AWBNo</a>
                            <br />
                            @Net4Courier.Models.CommonFunctions.GetShortDateFormat(@item.AWBDate)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Consignor)
                            <br />
                            <span class="text-over  color_blue">@item.ConsignorCountryName</span>
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Consignee)
                            <br />
                            <span class="text-over color_blue">@item.ConsigneeCountryName</span>

                        </td>

                        <td>
                            <span class="text-over color_blue">@item.MovementType</span>

                            <br />
                            <span class="text-over color_red">@item.ParcelType</span>

                            <br />
                            @Html.DisplayFor(modelItem => item.ProductType)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Pieces)
                            <br />
                            @Html.DisplayFor(modelItem => item.Weight)
                           
                        </td>
                        <td>
                            <span class="text-over color_blue">C.C : @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.CourierCharge, _decimal)</span>

                            <br />
                            <span class="text-over color_blue">O.C : @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.OtherCharge, _decimal)</span>
                            <br />
                            <span class="text-over color_blue">Net : @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.NetTotal, _decimal)</span>

                        </td>
                        <td>
                            <div class="d-flex gap-3">


                                <a href="javascript:void(0)" onclick="EditAWB(@i)" class="text-success"><i class="mdi mdi-pencil font-size-18"></i></a>


                                <a href="#" class="text-danger" onclick="deleteawb(@item.InScanID,@i)"><i class="mdi mdi-delete font-size-18"></i></a>

                            </div>
                        </td>
                    </tr>
                        i++;
                    }
                </tbody>

            </table>
        </div>
    </div>
</div>


 
