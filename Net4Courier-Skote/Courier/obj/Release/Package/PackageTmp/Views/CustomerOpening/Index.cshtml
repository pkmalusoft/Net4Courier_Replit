@model Net4Courier.Models.CustomerOpeningSearch

@{
    ViewBag.Title = "List";
    ViewBag.pTitle = "Customer Opening";
    ViewBag.pageTitle = "Account Receivable";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string path = "/CustomerOpening/Index";
    var ismodify = true;
    var isdelete = true;
    var isprint = true;
    var isadd = true;
    if (Convert.ToInt32(Session["UserRoleID"]) > 1)
    {
        Net4Courier.Models.SourceMastersModel obj = new Net4Courier.Models.SourceMastersModel();
        isprint = obj.GetPrintpermission(Convert.ToInt32(Session["UserRoleID"]), path);
        ismodify = obj.GetModifypermission(Convert.ToInt32(Session["UserRoleID"]), path);
        isdelete = obj.GetDeletepermission(Convert.ToInt32(Session["UserRoleID"]), path);

    }

    if (ViewBag.EnableSave == false)
    {
        isdelete = false;
        isadd = false;
    }
}
@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-2">
                        <label class="col-form-label">Customer</label>
                        @Html.TextBoxFor(model => model.CustomerName, new { @class = "form-select", @required = "true" })
                        @Html.HiddenFor(model => model.CustomerID)
                    </div>
                </div>
                <div class="col-md-2 mt-2">
                    <div class="mb-2">
                        @*<a class="btn btn-success waves-effect waves-light filter mt-3 refresh_btn" href="Javascript:void(0)" onclick="location.href='@Url.Action("IndexAcBook", "Accounts")?VoucherType=' + $('#VoucherType').val() + '&FromDate=' + $('#FromDate').val() + '&ToDate=' + $('#ToDate').val()"><i class="mdi mdi-refresh mt-1"></i></a>*@
                        <button type="submit" class="btn btn-success waves-effect waves-light filter btn_top">
                            <i class="bx bx-search mt-1" style="font-size: 21px;"></i>
                        </button>
                    </div>
                </div>
                <div class="col-md-6 mt-2 text-md-end">
                    <div class="mb-2">
                        @{
                            if (ViewBag.EnableSave == false)
                            {
                                <label class="text-danger" id="lbldanger">The Previous Year Opening Update is Restricted!</label>
                            }
                        }
                        @if (Net4Courier.Models.CommonFunctions.CheckCreateEntryValid() == false || (!isadd))
                        {

                            <a disabled class="btn btn-primary waves-effect btn_top waves-light"><i class="mdi mdi-plus me-1"></i> New Credit Note Entry</a>
                        }
                        else
                        {

                            <a class="btn btn-primary waves-effect waves-light btn_top" href="/CustomerOpening/Create"><i class="mdi mdi-plus me-1"></i> New Opening balance</a>
                        }
                    </div>
                </div>

            </div>

              </div>

            </div>


   <div class="card">
        <div class="card-body">

            <div class="row">
                <table class="table align-middle table-nowrap" id="datatablesaccount">
                    <thead class="table-light">
                        <tr>
                            <th>
                                Customer Name
                            </th>
                            <th>Type</th>
                            <th>
                                Debit
                            </th>
                            <th>
                                Credit
                            </th>
                            <th>
                                Balance
                            </th>
                            <th></th>
                            <th style="display:none"></th>
                        </tr>
                    </thead>



                    <tbody>
                        @foreach (var item in Model.Details)
                        {
                        <tr>

                            <td class="details-control">
                                <img src="/assets/images/details_open.png" id="plus_minus" style="cursor: pointer;" />
                                @item.CustomerName
                            </td>
                            <td>
                                @item.CustomerType
                            </td>
                            <td style="text-align:right">@Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.Debit, "2")</td>
                            <td style="text-align:right">@Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.Credit, "2")</td>
                            <td style="text-align:right">

                                @if (@item.Balance > 0)
                                {
                                    @Net4Courier.Models.CommonFunctions.GetFormatNumber(@item.Balance, "2")
                                }
                                else
                                {
                                    <span class="text-danger">@Net4Courier.Models.CommonFunctions.GetFormatNumber(-1 * @item.Balance, "2")</span>
                                }


                            </td>
                            <td>
                                <div class="d-flex gap-3">
                                    @if (isdelete)
                                    {
                                        <a href="#" onclick="Delete(@item.AcOPInvoiceMasterId)" class="text-danger"><i class="mdi mdi-delete font-size-18"></i></a>
                                    }
                                    <a target="_blank" href="/Accounts/Posting?id=@item.AcJournalID" class="text-primary"><i class="mdi mdi-account-settings font-size-18"></i></a>
                                </div>
                            </td>
                            <td style="display:none">
                                @item.AcOPInvoiceMasterId
                            </td>

                        </tr>
                        }

                    </tbody>
                </table>
            </div>

        </div>
    </div>
}
<script type="text/javascript">

    function Delete(ID) {
        Swal.fire({ title: "Are you sure?", text: "Do you want to delete this?", icon: "warning", showCancelButton: !0, confirmButtonColor: "#34c38f", cancelButtonColor: "#f46a6a", confirmButtonText: "Yes, delete it!" }).then(
            function (t) {
                if (t.value) {

                    $.ajax({
                        type: "POST",
                        url: '/CustomerOpening/DeleteOpeningMaster',
                        data: {
                            'id': ID
                        },
                        success: function (response) {
                            if (response.status == "OK") {
                                Swal.fire("Delete Status!", response.message, "success");
                                window.location.reload();
                            }
                            else {
                                Swal.fire("Delete Status!", response.message, "error");
                            }
                        }
                    });

                }
            });

    }
</script>

<script type="text/javascript">
    $(document).ready(function () {
        $("#CustomerName").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: '/CustomerMaster/GetCustomerName',
                    datatype: "json",
                    data: {
                        term: request.term
                    },
                    success: function (data) {
                        response($.map(data, function (val, item) {
                            return {
                                label: val.CustomerName,
                                value: val.CustomerName,
                                CustomerId: val.CustomerID,
                                type: val.CustomerType
                            }
                        }))
                    }
                })
            },
            minLength: 1,
            autoFocus: false,
            focus: function (event, ui) {
                $("#CustomerName").val(ui.item.value);
                $('#CustomerID').val(ui.item.CustomerId);
            },
            select: function (e, i) {
                e.preventDefault();
                $("#CustomerName").val(i.item.label);
                $('#CustomerID').val(i.item.CustomerId);
            },

        });

    })

   
</script>

@section scripts{

    <script src="~/Scripts/JS/CustomerOpeningIndex.js"></script>
}