@model Net4Courier.Models.AWBBatchVM
@{
   
    ViewBag.pTitle = "Batch Shipment";
    ViewBag.pageTitle = "Domestic Shipment";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var spath = "/AWBBatch/Index";// System.Configuration.ConfigurationManager.AppSettings["spath"].ToString();
    var _decimal = @Session["Decimal"].ToString();
}
@section styles{
    <link href="~/assets/libs/select2/css/select2.min.css" rel="stylesheet" type="text/css" />

}
<style>
    #movementid + .btn-group button, #movementid + .btn-group {
        display: block;
        width: 100%;
    }

    ul.ui-front {
        z-index: 1100;
    }

    .ui-autocomplete {
        z-index: 100;
    }

    body .ratelabel {
        color: #838384 !important;
        font-size: 14px;
        font-weight: 400;
        margin-bottom: 10px;
    }

    .searchMc .form-control {
        font-size: 13px !important;
    }

    .searchMc .headinglabel {
        font-size: 13px !important;
    }

    .form-control {
        font-size: 13px !important;
    }

    .nav-tabs > li.active > a, .nav-tabs > li.active > a:focus, .nav-tabs > li.active > a:hover {
        color: #fff;
        cursor: default;
        background-color: #35b8eb;
        border: 1px solid #ddd;
        border-bottom-color: #07a7e3;
        padding-bottom: 10px !important;
        font-size: 16px;
        font-weight: 700;
    }

    .nav-tabs > li > a {
        font-size: 16px !important;
        font-weight: 700 !important;
    }
</style>

<style type="text/css">

    .searchMc {
        border: 2px solid #07a7e3;
        position: relative;
        padding: 15px 10px 10px 10px;
        margin: 5px 0;
        border-radius: 5px;
    }

    a {
        cursor: pointer;
    }

    .searchMc h4 {
        padding: 0 30px;
        position: ABSOLUTE;
        top: -21px;
        display: inline-block;
        left: 22px;
        background: #f8fbff;
        text-align: center;
    }

    .scrolling_list th {
        position: sticky;
        top: 0;
        background: #07a7e3;
    }

    body .hyperlink:hover {
        color: blue !important;
    }

    .show-error {
        color: red;
    }

    .show-green {
        color: blue;
        font-size: 16px;
        font-weight: 700;
    }

    .btnwidth {
        min-width: 100px;
        width: auto;
    }

    .multiselect-container {
        margin-top: 0 !important;
    }

    .searchMc .checkboxdesign {
        align-items: flex-start;
    }

    .multiselect.dropdown-toggle {
        display: block;
        width: 100%;
        float: none;
    }

    .multiselect-native-select .btn-group {
        display: block;
    }
</style>

<script>
     function showLocationEntry() {
        debugger;
         $.ajax({
                type: 'POST',
                url: '@Url.Action("ShowLocationEntry", "AWB")',
                datatype: "html",
                success: function (data) {
                    $("#LocationContainer").html(data);
                    $('#Locationpopup').modal('show');
                    setTimeout(function () {
                        $('#LLocationName').focus();
                    },200)

                }
            });
    }
    function SaveLocationEntry() {

        if ($('#LLocationName').val() == '' && $('#LCityName').val() == '' && $('#LCountryName').val() == '') {
            Swal.fire("Data Validation","Enter Location Details", "error");

            return;
        }
        else if ($('#LLocationName').val() != '' && ($('#LCityName').val() == '' || $('#LCountryName').val() == '')) {
            Swal.fire("Data Validation","Enter Location's City/Country Details", "error");
            return;
        }
        var cust = {

            Location: $('#LLocationName').val(),
            CityName: $('#LCityName').val(),
            CountryName: $('#LCountryName').val()
        }

            $.ajax({
                type: 'POST',
                url: '@Url.Action("SaveLocationEntry", "AWB")',
                datatype: "json",
                data: cust,
                success: function (response) {
                    debugger;
                    if (response.status == 'Ok') {
                        //if ($('#lblconsignorLocation').attr('popup') == 'open') {
                        //    $('#ConsignorLocationName').val(response.data.LocationName);
                        //    $('#ConsignorCityName').val(response.data.CityName);
                        //    $('#ConsignorCountryName').val(response.data.CountryName);
                        //}
                        //else if ($('#lblconsigneeLocation').attr('popup') == 'open') {
                        //    $('#ConsigneeLocationName').val(response.data.LocationName);
                        //    $('#ConsigneeCityName').val(response.data.CityName);
                        //    $('#ConsigneeCountryName').val(response.data.CountryName);
                        //}
                        //$('#lblconsigneeLocation').attr('popup', '');
                        //$('#lblconsignorLocation').attr('popup', '');

                        $('#Locationpopup').modal('hide');

                        Swal.fire("Data Validation",response.message, "success");

                    }
                    else {

                        //if ($('#lblconsignorLocation').attr('popup') == 'open') {
                        //    $('#ConsignorLocationName').val(response.data.Location);
                        //    $('#ConsignorCityName').val(response.data.CityName);
                        //    $('#ConsignorCountryName').val(response.data.CountryName);
                        //}
                        //else if ($('#lblconsigneeLocation').attr('popup') == 'open') {
                        //    $('#ConsigneeLocationName').val(response.data.Location);
                        //    $('#ConsigneeCityName').val(response.data.CityName);
                        //    $('#ConsigneeCountryName').val(response.data.CountryName);
                        //}

                        //$('#lblconsigneeLocation').attr('popup', '');
                        //$('#lblconsignorLocation').attr('popup', '');

                        $('#Locationpopup').modal('hide');
                        Swal.fire("Data Validation",response.message, "error");

                    }
                }
            });
    }
    function controlreadonly(obj, status) {
        if (status == true)
            $(obj).attr('readonly', 'readonly');
        else
            $(obj).removeAttr('readonly');
    }
    function lockawbstatus() {
        var maxrow = $('#tbl1 > tr').length;
        if ($('#ID').val() > 0 && maxrow>0) {
            if ($('#CollectedBy').prop('checked')) {

                controlreadonly($('#CollectedBy'), true);
                controlreadonly($('#ReceivedBy'), true);
                controlreadonly($('#PickedupDate'), true);
                controlreadonly($('#PickedUpEmpID'), true);
                controlreadonly($('#InscanVehicleId'), true);

                controlreadonly($('#ReceivedDate'), true);
                controlreadonly($('#DepotReceivedBy'), true);

            }

            if ($('#OutScanDelivery').prop('checked')) {

                controlreadonly($('#OutScanDate'), true);
                controlreadonly($('#OutScanDeliveredID'), true);
                controlreadonly($('#OutscanVehicleId'), true);
            }
            if ($('#Delivered').prop('checked')) {

                controlreadonly($('#DeliveredDate'), true);
                controlreadonly($('#DeliveredBy'), true);

            }
        }
    }
    function deleteawb(InscanId, index1) {
        setawbrowactive(index1);
        if (confirm("Are you sure, You want to Delete AWB Batch?")) {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("DeleteAWB", "AWBBatch")',
                datatype: "html",
                data: {
                    BatchId: $('#ID').val(), InscanId: InscanId
                },
                success: function (response) {
                    if (response.Status == "OK") {
                        Swal.fire("Data Validation",response.Message, "success");
                        showawblist();
                    }
                    else {
                        Swal.fire("Data Validation",response.Message, "error");
                    }
                }
            });
        }
    }
    function editawb(InscanId, index1) {
        $('#spanAWBStatus').html('AWB Valid to Modify!')
         $.ajax({
                type: 'POST',
                url: '@Url.Action("ShowAWBDetail", "AWBBatch")',
                datatype: "html",
                data: {
                    BatchId: $('#ID').val(), InscanId: InscanId
                },
                success: function (data) {
                    $("#AWBEntryContainer").html(data);
                    setawbrowactive(index1);
                    setTimeout(function () {
                        $('#liAWBDetails').trigger('click');
                        if ($('#InScanID').val() == 0)
                            $('#AWBNo').focus();
                        else {
                           // $('#AWBNo').attr('readonly', 'readonly');
                            $('#BranchCountry').val('United Arab Emirates');
                            $('#PaymentTypeId').focus();
                        }

                    },100)

                    ///$('#CargoPopup').modal('show');
                }
            });

    }

    function showawblist() {
        $.ajax({
                type: 'POST',
                url: '@Url.Action("ShowAWBList", "AWBBatch")',
                datatype: "html",
                data: {
                    BatchId: $('#ID').val()
                },
                success: function (data) {
                    $("#AWBListContainer").html(data);
                    $('#TotalAWB').val($('#tbl > tr').length);
                    ///$('#CargoPopup').modal('show');
                }
            });

    }
    function showcustomerentry() {
        debugger;
         $.ajax({
                type: 'POST',
                url: '@Url.Action("ShowCustomerEntry", "AWB")',
                datatype: "html",
                data: {
                    FieldName: 's'
                },
                success: function (data) {
                    $("#customerContainer").html(data);
                    $('#customerpopup').modal('show');

                    setTimeout(function () {
                        $('#NewCustomerName').focus();
                    }, 300)
                }
            });
    }
      function SaveCustomerEntry() {

        if ($('#NewCustomerName').val() == '') {
            Swal.fire("Data Validation","Enter Customer Name", "error");
            return;
        }
        else if ($('#NewPhone').val() == '') {
            Swal.fire("Data Validation","Enter Customer Phone", "error");
            return;
        }
        else if ($('#NewCityName').val() == '' && $('#NewCountryName').val() == '') {
            Swal.fire("Data Validation","Enter Customer Location Details", "error");
            return;
        }

        var cust = {
            CustomerName: $('#NewCustomerName').val(),
            Address1: $('#NewAddress1').val(),
            Address2: $('#NewAddress2').val(),
            Address3: $('#NewAddress3').val(),
            LocationName: $('#NewLocationName').val(),
            CityName: $('#NewCityName').val(),
            CountryName: $('#NewCountryName').val(),
            ContactPerson: $('#NewContactPerson').val(),
            Phone: $('#NewPhone').val(),
            Mobile: $('#NewMobile').val(),
            CustomerType: $('#CustomerType1').val()
        }

            $.ajax({
                type: 'POST',
                url: '@Url.Action("SaveCustomerEntry", "AWB")',
                datatype: "json",
                data: cust,
                success: function (response) {
                    debugger;
                    if (response.status == 'Ok') {

                        $('#CustomerName').val(response.data.CustomerName);
                        $('#CustomerName').attr('customername', response.data.CustomerName)
                        $('#customerpopup').modal('hide');
                        $('#CustomerName').trigger('change');
                        Swal.fire("Data Validation",response.message, "success");

                    }
                    else {
                        $('#customerpopup').modal('hide');
                        $('#CustomerName').val(response.data.CustomerName);
                        Swal.fire("Data Validation",response.message, "error");
                        $('#CustomerName').trigger('change');
                    }
                }
            });
    }
    function LoadCustomerDetail() {
        debugger;
        if ($('#CustomerName').val() != '') {
            $.ajax({
                type: "POST",
                url: "/PickUpRequest/GetCustomerDataByName",
                datatype: "Json",
                data: { CustomerName: $('#CustomerName').val() },
                success: function (data) {
                    $('#CustomerID').val(data.CustID);
                    $("#custcode").val(data.CustCode);
                    $("#Consignor").val(data.CustName);
                    $("#ConsignorContact").val(data.ContactPerson);
                    $("#ConsignorAddress1_Building").val(data.Address1);
                    $("#ConsignorAddress2_Street").val(data.Address2);
                    $("#ConsignorAddress3_PinCode").val(data.Address3);

                    $("#ConsignorPhone").val(data.Phone);
                    $("#ConsignorCountryName").val(data.CountryName);
                    $("#ConsignorCityName").val(data.CityName);
                    $("#ConsignorLocationName").val(data.LocationName);


                    $('#ConsignorMobileNo').val(data.Mobile);
                }
            });
        }
    }
    function checkconsignor() {

        $.ajax({
            type: "GET",
            url: "/AWBBatch/CheckShipperName",
            datatype: "Json",
            data: { term: $('#Shipper').val() },
            success: function (response) {
                debugger;
                if (response == 'NotExists') {
                    $('#Shipper').val('') //.css('color', 'red');
                    $('#Shipper').focus();
                }
                else {
                    //$('#Shipper').css('color', 'black');
                }

            }
        });
    }
    function setorigincitycountry(placeid) {
        var obj = { CountryName: "", CityName: "" };
        $.ajax({
            type: "GET",
            url: "/ZoneChart/GetVenueDetailsByPlace",
            datatype: "Json",
            data: { placeId: placeid},
            success: function (response) {
                debugger;
                // console.log(response);
                $('#OriginCountry').attr('awbcountry', response.Country);
                $('#OriginCountry').val(response.Country);
                $('#OriginCity').attr('awbcity',response.City);
                $('#OriginCity').val(response.City);
                getMovementType();
            }
        });
    }

    function setdestinationcitycountry(placeid) {
        var obj = { CountryName: "", CityName: "" };
        $.ajax({
            type: "GET",
            url: "/ZoneChart/GetVenueDetailsByPlace",
            datatype: "Json",
            data: { placeId: placeid },
            success: function (response) {
                debugger;
                // console.log(response);
                $('#DeliveryCountry').attr('awbcountry',response.Country)
                $('#DeliveryCountry').val(response.Country);
                $('#DeliveryCity').attr('awbcity',response.City);
               $('#DeliveryCity').val(response.City);
                getMovementType();
            }
        });
    }
        function showshipperaddress() {
            var fullform = $('form#FormReceipt').serialize();

                        $.ajax({
                            type: 'POST',
                            url: '@Url.Action("ShowConsignorAddres", "AWBBatch")',
                            datatype: "html",
                            data: {
                                ship: fullform
                            },
                            success: function (data) {
                                $("#listContainer").html(data);
                                $('#shipperpopup').modal('show');
                                var Shipper = $('#Shipper').val();
                                var ConsignorContact = $("#ConsignorContact").val();
                                var ConsignorAddress1 = $("#ConsignorAddress1_Building").val();
                                var ConsignorAddress2 = $("#ConsignorAddress2_Street").val();
                                var ConsignorAddress3 = $("#ConsignorAddress3_PinCode").val();
                                var ConsignorPhone = $("#ConsignorPhone").val();
                                var ConsignorCountryName = $("#ConsignorCountryName").val();
                                var ConsignorCityName = $("#ConsignorCityName").val();
                                var ConsignorLocationName = $("#ConsignorLocationName").val();
                                var ConsignorMobileNo = $('#ConsignorMobileNo').val();
                                $('#Shipper1').val(Shipper);
                                $('#ConsignorContact1').val(ConsignorContact);
                                $('#ConsignorAddress1_1').val(ConsignorAddress1);
                                $('#ConsignorAddress2_1').val(ConsignorAddress2);
                                $('#ConsignorAddress3_1').val(ConsignorAddress3);
                                $('#ConsignorPhone1').val(ConsignorPhone);
                                $('#ConsignorCountryName1').val(ConsignorCountryName);
                                $('#ConsignorCityName1').val(ConsignorCityName);
                                $('#ConsignorLocationName1').val(ConsignorLocationName);
                                $('#ConsignorMobileNo1').val(ConsignorMobileNo);
                                setTimeout(function () {
                                    $('#Shipper1').focus();
                                },300)


                            }
                        });




        }
        function saveshipperaddress() {
            var ConsignorContact = $("#ConsignorContact1").val();
            var ConsignorAddress1 = $("#ConsignorAddress1_1").val();
            var ConsignorAddress2 = $("#ConsignorAddress2_1").val();
            var ConsignorAddress3 = $("#ConsignorAddress3_1").val();
            var ConsignorPhone = $("#ConsignorPhone1").val();
            var ConsignorCountryName = $("#ConsignorCountryName1").val();
            var ConsignorCityName = $("#ConsignorCityName1").val();
            var ConsignorLocationName = $("#ConsignorLocationName1").val();
            var ConsignorMobileNo = $('#ConsignorMobileNo1').val();
            var Shipper = $('#Shipper1').val();
            $('#Shipper').val(Shipper);
            $('#ConsignorContact').val(ConsignorContact);
            $("#ConsignorAddress1_Building").val(ConsignorAddress1);
            $("#ConsignorAddress2_Street").val(ConsignorAddress2);
            $("#ConsignorAddress3_PinCode").val(ConsignorAddress3);
            $('#ConsignorPhone').val(ConsignorPhone);
            $('#ConsignorCountryName').val(ConsignorCountryName);
            $('#ConsignorCityName').val(ConsignorCityName);
            $('#ConsignorLocationName').val(ConsignorLocationName);
            $('#ConsignorMobileNo').val(ConsignorMobileNo);
            $('#PickUpLocation').val(ConsignorLocationName);
            $('#OriginCity').val(ConsignorCityName);
            $('#OriginCountry').val(ConsignorCountryName);
            $('#shipperpopup').modal('hide');
            getMovementType();
            debugger;
            var consignor = {
                ShipperName: Shipper,
                ContactPerson: ConsignorContact,
                    Phone: ConsignorPhone,
                    ConsignorMobileNo: ConsignorMobileNo,
                    Address1 : ConsignorAddress1,
                    Address2: ConsignorAddress2,
                    PinCode: ConsignorAddress3,
                    CityName: ConsignorCityName,
                    CountryName : ConsignorCountryName,
                    LocationName: ConsignorLocationName
                                }

                        $.ajax({
                            type: 'POST',
                            url: '@Url.Action("SaveConsignorAddress", "AWBBatch")',
                            datatype: "json",
                            data: consignor,
                            success: function (data) {



                            }
                        });


        }
    function showreceiveraddress() {
        var fullform = $('form#FormReceipt').serialize();

        $.ajax({
            type: 'POST',
            url: '@Url.Action("ShowConsigneeAddres", "AWBBatch")',
            datatype: "html",
            data: {
                ship: fullform
            },
            success: function (data) {
                $("#listcontainer1").html(data);
                $('#receiverpopup').modal('show');
                var Receiver = $('#Consignee').val();
                var ConsigneeContact = $("#ConsigneeContact").val();
                var ConsigneeAddress1 = $("#ConsigneeAddress1_Building").val();
                var ConsigneeAddress2 = $("#ConsigneeAddress2_Street").val()
                var ConsigneeAddress3 = $("#ConsigneeAddress3_PinCode").val();
                var ConsigneePhone = $("#ConsigneePhone").val();
                var ConsigneeMobile = $("#ConsigneeMobileNo").val();
                var ConsigneeCountryName = $("#ConsigneeCountryName").val();
                var ConsigneeCityName = $("#ConsigneeCityName").val();
                var ConsigneeLocationName = $("#ConsigneeLocationName").val();
                $('#Consignee1').val(Receiver);
                $('#ConsigneeContact1').val(ConsigneeContact);
                $('#ConsigneeAddress1_1').val(ConsigneeAddress1);
                $('#ConsigneeAddress2_1').val(ConsigneeAddress2);
                $('#ConsigneeAddress3_1').val(ConsigneeAddress3);
                $('#ConsigneePhone1').val(ConsigneePhone);
                $('#ConsigneeCountryName1').val(ConsigneeCountryName);
                $('#ConsigneeCityName1').val(ConsigneeCityName);
                $('#ConsigneeLocationName1').val(ConsigneeLocationName);
                $("#ConsigneeMobileNo1").val(ConsigneeMobile);

                setTimeout(function () {
                    $('#Consignee1').focus();
                }, 300)
            }

        });
        }
        function savereceiveraddress() {
            // var Receiver = $('#hdnConsignee1').val();
            var ConsigneeContact = $('#ConsigneeContact1').val();
            var ConsigneeAddress1 = $("#ConsigneeAddress1_1").val();
            var ConsigneeAddress2 = $("#ConsigneeAddress2_1").val()
            var ConsigneeAddress3 = $("#ConsigneeAddress3_1").val();
            var ConsigneePhone = $("#ConsigneePhone1").val();
            var ConsigneeCountryName = $("#ConsigneeCountryName1").val();
            var ConsigneeCityName = $("#ConsigneeCityName1").val();
            var ConsigneeLocationName = $("#ConsigneeLocationName1").val();
            var ConsigneeMobile = $("#ConsigneeMobileNo1").val();
            var Receiver = $('#Consignee1').val();
            $('#Consignee').val(Receiver);
            $("#ConsigneeContact").val(ConsigneeContact);
            $("#ConsigneeAddress1_Building").val(ConsigneeAddress1);
            $("#ConsigneeAddress2_Street").val(ConsigneeAddress2);
            $("#ConsigneeAddress3_PinCode").val(ConsigneeAddress3);
            $('#ConsigneePhone').val(ConsigneePhone);
            $('#ConsigneeCountryName').val(ConsigneeCountryName);
            $('#ConsigneeCityName').val(ConsigneeCityName);
            $('#ConsigneeLocationName').val(ConsigneeLocationName);
            $('#DeliveryLocation').val(ConsigneeLocationName);
            $('#DeliveryCity').val(ConsigneeCityName);
            $('#DeliveryCountry').val(ConsigneeCountryName);
            $("#ConsigneeMobileNo").val(ConsigneeMobile);
            $('#receiverpopup').modal('hide');
            getMovementType();
            var Shipper = $('#Shipper').val();
              var consignor = {
                  ShipperName: Shipper,
                  ConsignorName: Receiver,
                ContactPerson: ConsigneeContact,
                    Phone: ConsigneePhone,
                  ConsignorMobileNo: ConsigneeMobile,
                    Address1 : ConsigneeAddress1,
                    Address2: ConsigneeAddress2,
                    PinCode: ConsigneeAddress3,
                    CityName: ConsigneeCityName,
                    CountryName : ConsigneeCountryName,
                    LocationName: ConsigneeLocationName
                                }

                        $.ajax({
                            type: 'POST',
                            url: '@Url.Action("SaveConsigeeAddress", "AWBBatch")',
                            datatype: "json",
                            data: consignor,
                            success: function (data) {



                            }
                        });
        }
        function CalculateTax() {
            debugger;
            var tax = $('#ChkTaxPercent').prop('checked');
            setTwoNumberDecimal($('#CourierCharge'));
            setTwoNumberDecimal($('#OtherCharge'));
            setTwoNumberDecimal($('#CourierCharge'));
            if (tax == true) {
                //$('#lblTaxPercent').removeClass('hide');
                var taxpercent = parseFloat($('#TaxPercent').val());
                if ($('#CourierCharge').val() == '' || $('#CourierCharge').val() == null)
                    $('#CourierCharge').val(0);
                if ($('#OtherCharge').val() == '' || $('#OtherCharge').val() == null)
                    $('#OtherCharge').val(0);

                setTwoNumberDecimal($('#CourierCharge'));
                var charge = parseFloat($('#CourierCharge').val()) + parseFloat($('#OtherCharge').val());

                var taxval = parseFloat(charge) * (parseFloat(taxpercent) / 100.00);
                $('#TaxAmount').val(parseFloat(taxval).toFixed(@_decimal));
                var net = parseFloat(charge) + parseFloat(taxval)
                $('#NetTotal').val(parseFloat(net).toFixed(@_decimal));
            }
            else {
                $('#TaxAmount').val(0);
                var charge = parseFloat($('#CourierCharge').val()) + parseFloat($('#OtherCharge').val());
                var net = parseFloat(charge);
                $('#NetTotal').val(parseFloat(net).toFixed(2));

            }


        }
        function getCustomerId() {
            $.ajax({
                url: '/AWBBatch/GetConsignorCustomer', //'/AWB/GetConsigneeName',
                datatype: "json",
                data: {
                    customername: $('#Shipper').val()
                },
                success: function (data) {

                    if (data == null) {
                        $('#CustomerID').val(0);
                    }
                    else {
                        $('#CustomerID').val(data.CustomerID);
                    }
                }
            });
        }
        function checkduplicate(awbno) {
            debugger;
            var idtext = 'hdnAWBNo_';
            var maxrow = $('#tbl1 > tr').length;
            if (maxrow > 0) {
                var duplicate = false;
                $('[id^=' + idtext + ']').each(function (index, item) {
                    var deleted = $('#hdndeleted_' + index).val();
                    if (deleted != "true") {
                        var con = $('#hdnAWBNo_' + index).val();
                        if (con.trim() == awbno.trim()) {
                            duplicate = true;
                            var message = 'Duplicate AWB No.!';
                            Swal.fire("Data Validation",'Duplicate AWB No.', 'error');
                            $('#ulerr').removeClass('show-green');
                            $('#ulerr').addClass('show-error');
                            $('#lierr').html(message);
                            $('#btnAdd').attr('disabled', 'disabled');
                            //break;
                        }

                        if (duplicate == false && index == (parseInt(maxrow - 1))) {
                            return true;
                        }
                    }
                });
                if (duplicate == true) {
                    return false;
                }
            }
            else {

                return true;
            }
        }
        function checkDate(obj) {
            var value = '';
            if ($(obj).val() == '' || $(obj).val() == undefined || $(obj).val() == 'undefined' || $(obj).val() == null) {
                return '';
            }
            else {
                var date = $(obj).val().split('-');
                value = date[1] + '/' + date[0] + '/' + date[2];
            }

            return value

        }
        function checkdata(obj) {
            var value = '';
            if ($(obj).val() == '' || $(obj).val() == undefined || $(obj).val() == 'undefined' || $(obj).val() == null) {
                return '';
            }
            else {
                value = $(obj).val();
            }

            return value

        }
        function getdate(date) {
            var myDate = new Date(date);
            var cmon = myDate.getMonth() + 1;
            var entrydate = cmon + "/" + myDate.getDate() + '/' + myDate.getFullYear();
            return entrydate
        }
        function deletetrans(obj, i) {
            $(obj).parent().parent().addClass('hide');
            var obj1 = $(obj).parent().parent().find('.hdndeleted');
            $(obj1).val(true);
        }
        function checkfieldvalidate(obj) {
            if ($(obj).val() == null || $(obj).val().trim() == '') {
                var id = $(obj).attr('id');
                var message = '';
                if (id == 'AWBNo') {
                    message = 'Missing Field..AWB No.!';
                }
                else if (id == 'AWBDate') {
                    message = 'Missing Field..AWB Date!';
                }
                else if (id == 'BatchDate') {
                    message = 'Missing Field..Batch Date!';
                }
                else if (id == 'Pieces') {
                    message = 'Missing Field..Pieces!';
                }
                else if (id == 'Weight') {
                    message = 'Missing Field..Weight!';
                }
                else if (id == 'Shipper') {
                    message = 'Missing Field..Shipper!';
                }
                else if (id == 'Consignee') {
                    message = 'Missing Field..Consignee!';
                }
                else if (id == 'AssignedDate') {
                    message = 'Missing Field..Collected By!';
                }
                else if (id == 'PickedupDate') {
                    message = 'Missing Field..Collected By!';
                }
                else if (id == 'ReceivedDate') {
                    message = 'Missing Field..Received at Store!';
                }
                else if (id == 'OutScanDeliveredID' || id == 'OutScanDate') {
                    message = 'Missing Field..Out for Delivery!';
                }
                else if (id == 'DeliveryAttemptedBy' || id == 'DelieveryAttemptDate') {
                    message = 'Missing Field..Delivery for Attempted!';
                }
                else if (id == 'DeliveredBy' || id == 'DeliveredDate') {
                    message = 'Missing Field..Delivery Attempted!';
                }
                else if (id == 'PickUpLocation') {
                    message = 'Missing Field..Pickup Location!';
                }
                else if (id == 'DeliveryLocation') {
                    message = 'Missing Field..Destination Location!';
                } else if (id == 'ConsignorCountryName') {
                    message = 'Missing Field..Consignor Country Name!';
                }
                else if (id == 'ConsigneeCountryName') {
                    message = 'Missing Field..Receiver Country Name!';
                }

                Swal.fire("Data Validation",message, "error");
                //$('#ulerr').removeClass('show-green');
                //$('#ulerr').addClass('show-error');
                //$('#lierr').html('Please Enter Required Values!');
                $('#btnAdd').removeAttr('disabled');
                $(obj).focus();
                return false;
            }
            else {
                return true;
            }
        }
        function checkdrpfieldvalidate(obj) {

            if ($(obj).val() == null || $(obj).val().trim() == '' || $(obj).val().trim() == '0') {
                debugger;
                //$('#ulerr').removeClass('show-green');
                //$('#ulerr').addClass('show-error');
                //$('#lierr').html('Please Enter Required Values!');
                var message = '';
                var id = $(obj).attr('id');
                if (id == 'MovementID') {
                    message = 'Missing Field..Movement Type!';
                }
                else if (id == 'ParcelTypeID') {
                    message = 'Missing Field..Parcel Type!';
                }
                else if (id == 'ProductTypeID') {
                    message = 'Missing Field..Product Type!';
                }
                else if (id == 'PaymentTypeId') {
                    message = 'Missing Field..Payment Type!';
                }
                //else if (id == 'AssignedEmployeeID') {
                //    message = 'Missing Field..Assigned For Collection!';
                //}
                //else if (id == 'PickedUpEmpID') {
                //    message = 'Missing Field..Collected By!';
                //}
                //else if (id == 'DepotReceivedBy') {
                //    message = 'Missing Field..Received at Store!';
                //}
                //else if (id == 'InscanVehicleId') {
                //    message = 'Missing Field..Received at Store!';
                //}
                //else if (id == 'OutScanDeliveredID') {
                //    message = 'Missing Field..Out for Delivery!';
                //}
                //else if (id == 'OutscanVehicleId') {
                //    message = 'Missing Field..Out for Delivery!';
                //}
                //else if (id == 'DeliveryAttemptedBy' || id == 'DelieveryAttemptDate') {
                //    message = 'Missing Field..Delivery for Attempted!';
                //}
                //else if (id == 'DeliveredBy' || id == 'DeliveredDate') {
                //    message = 'Missing Field..Delivery Attempted!';
                //}
                $('#btnAdd').removeAttr('disabled');
                Swal.fire("Data Validation",message, "error");
                $(obj).focus();
                return false;
            }
            else {
                return true;
            }
        }

        function checkNumberfieldvalidate(obj) {
            if ($(obj).val() == null || $(obj).val().trim() == '') {
                $('#ulerr').removeClass('show-green');
                $('#ulerr').addClass('show-error');
                $('#lierr').html('Please Enter Required Values!');
                $(obj).focus();
                $('#btnAdd').removeAttr('disabled');
                return false;
            }
            else if (parseFloat($(obj).val()) == 0 || parseFloat($(obj).val()) == 0) {
                $('#ulerr').removeClass('show-green');
                $('#ulerr').addClass('show-error');
                $('#lierr').html('Please Enter Required Values!');
                $(obj).focus();
                $('#btnAdd').removeAttr('disabled');
                return false;
            }
            else {
                return true;
            }
    }
    function getParcelType() {
        var ProductTypeID = $('#ProductTypeID').val();

        $.ajax({
            type: "Post",
            url: '/AWBBatch/GetParcelType',
            datatype: "json",
            data: {
                ProductTypeId: ProductTypeID
            },
            success: function (response) {
                debugger;
                if (response != null) {
                    if (response != 0) {
                        $('#ParcelTypeID').val(response);
                    }
                }
            }
        });
    }

    function getMovementType() {
        debugger;
        if ($('#ConsignorCountryName').val() != $('#BranchCountry').val() && $('#ConsigneeCountryName').val() != $('#BranchCountry').val()) {
            $('#MovementID').val(4).trigger('change');//Transhipment
        }
        //else if ($('#OriginCountry').val() != $('#BranchCountry').val()) {
        else if ($('#ConsignorCountryName').val() != $('#BranchCountry').val())//|| ($('#OriginCountry').val() != $('#BranchCountry').val()) {
        {    $('#MovementID').val(3).trigger('change'); //import
        }
        //else if ($('#DeliveryCountry').val() != $('#BranchCountry').val()) {
       else if ($('#ConsigneeCountryName').val() != $('#BranchCountry').val()) {
                        $('#MovementID').val(2).trigger('change');//Export
        }
       else if ($('#ConsigneeCountryName').val() == $('#BranchCountry').val()) {
            $('#MovementID').val(1).trigger('change'); //Domestic
        }


    }

    function checkdeliverylocationvalid() {
        if ($('#PaymentTypeId').val() == 5) //prepaid
        {
            if ($('#DeliveryCountry').val() != $('#DeliveryCountry').attr('country')) {
                Swal.fire("Data Validation",'Delivery coutry not matched with awb paid Country!');
                $('#DeliveryLocation').val('');
            }
            else {
                $('#DeliveryLocation').val(i.item.LocationName);
                $('#DeliveryCity').val('');
                $('#DeliveryCountry').val('');
            }
            if ($('#DeliveryLocation').attr('disabled') != 'disabled')
                $('#DeliveryLocation').val(i.item.LocationName);
        }
        else {
            $('#DeliveryCity').val($('#ConsigneeCityName').val());
            $('#DeliveryCountry').val($('#ConsigneeCountryName').val());
        }
    }
    function getCourierCharge() {
        debugger;
        var CustomerRateTypeID= $('#CustomerRateTypeID').val();
        var CustomerId= $('#CustomerID').val();
        var MovementId = $('#MovementID').val();
        var ProductTypeID = $('#ProductTypeID').val();
        var PaymentModeId = $('#PaymentTypeId').val();
        var Weight = $('#Weight').val();
        var CountryName = $('#ConsigneeCountryName').val(); //Delhi, India $("#ConsigneeCountryName").val();
        var CityName = $('#ConsigneeCityName').val(); //$("#ConsigneeCityName").val();
        var OriginCountry = $('#ConsignorCountryName').val();//$('#OriginCountry').val(); //Delhi, India $("#ConsigneeCountryName").val();
        var OriginCity = $('#ConsignorCityName').val(); //$("#ConsigneeCityName").val();
        var checkstatus = true;
        if (PaymentModeId == 5 || PaymentModeId == '5' && PaymentModeId == null) {
            checkstatus = false;
            $('#CustomerRateType').attr('placeholder', 'No RateType');
            return false;
        }
        if (PaymentModeId == 5 || PaymentModeId == '5' && PaymentModeId == null) {
            checkstatus = false;
            return false;
        }
        if (PaymentModeId == 1 || PaymentModeId == '1' && PaymentModeId == null) {
            checkstatus = false;
            return false;
        }
        if (PaymentModeId !=3 && PaymentModeId !=4) {
            checkstatus = false;
            return false;
        }
        else if (CustomerId == null || CustomerId == '' || CustomerId==null)
        {
            checkstatus = false;
            return false;
        }
        else if (MovementId == null || MovementId=='')
        {
            checkstatus = false;
            return false;
        }
        else if (ProductTypeID == null || ProductTypeID == '' || ProductTypeID==0) {
            checkstatus = false;
            return false;
        }
        else if ( MovementID !=3 && (CountryName == null || CountryName == '' ) ){
            checkstatus = false;
            return false;
        }
        else if (MovementID == 3 && (OriginCountry == null || OriginCountry == '')) {
            checkstatus = false;
            return false;
        }

        if (checkstatus) {
            $.ajax({
                url: '/AWBBatch/GetCustomerRateType',
                datatype: "json",
                data: {
                    term: '', CustomerId: $('#CustomerID').val(), MovementId: $('#MovementID').val(), ProductTypeID: $('#ProductTypeID').val(), PaymentModeId: $('#PaymentTypeId').val(), FAgentID: $('#FAgentID').val(), CityName: CityName, CountryName: CountryName, OriginCountry: OriginCountry, OriginCity: OriginCity
                },
                success: function (response) {
                    var data = response.Customerdata;
                    console.log(data);
                    var status = '';
                    if (data.length > 0) {
                        for (var i = 0; i < data.length; i++) {
                            debugger;
                            if ($('#CustomerRateTypeID').val() == 0) {
                                $('#CustomerRateType').val(data[i].CustomerRateType1);
                                $('#CustomerRateTypeID').val(data[i].CustomerRateTypeID);
                                GetcourierChargenew();
                                status = "ok";
                            }
                            else if (data[i].CustomerRateTypeID == $('#CustomerRateTypeID').val()) {
                                GetcourierChargenew();
                                status = "ok";
                            }

                            if ((i + 1) == data.length) {
                                if (status == '') {
                                    $('#CustomerRateType').val(data[0].CustomerRateType1);
                                    $('#CustomerRateTypeID').val(data[0].CustomerRateTypeID);
                                    GetcourierChargenew();
                                    status = "ok";
                                    $('#CustomerRateType').attr('placeholder', 'Select RateType');
                                }
                            }
                        }
                    }
                    else {
                        $('#CustomerRateTypeID').val(0);
                        $('#CustomerRateType').val("");
                        $('#CourierCharge').val(0);
                        $('#CustomerRateType').attr('placeholder', 'No RateType');
                        //Swal.fire("Data Validation",'Customer Rate Type Not specified!');
                    }
                }
            })
        }
    }
    function GetcourierChargenew() {
        var CustomerRateTypeID = $('#CustomerRateTypeID').val();
        var CustomerId = $('#CustomerID').val();
        var MovementId = $('#MovementID').val();
        var ProductTypeID = $('#ProductTypeID').val();
        var PaymentModeId = $('#PaymentTypeId').val();
        var Weight = $('#Weight').val();
        var CountryName = $('#ConsigneeCountryName').val(); //Delhi, India $("#ConsigneeCountryName").val();
        var CityName = $('#ConsigneeCityName').val(); //$("#ConsigneeCityName").val();
        var CountryName1 = $('#ConsignorCountryName').val(); //Delhi, India $("#ConsigneeCountryName").val();
        var CityName1 = $('#ConsignorCityName').val(); //$("#ConsigneeCityName").val();
        if (Weight == '')
            Weight = 0;
        if (parseFloat(Weight) > 0) {
            $.ajax({
                type: "Post",
                url: '/AWBBatch/GetCourierCharge',
                datatype: "json",
                data: {
                    CustomerRateTypeID: CustomerRateTypeID, CustomerId: CustomerId, MovementId: MovementId, ProductTypeID: ProductTypeID, PaymentModeId: PaymentModeId, Weight: Weight, CountryName: CountryName, CityName: CityName
                },
                success: function (response) {
                    debugger;
                    if (response != null) {
                        if ($('#CustomerRateTypeID').val() != response.CustomerRateTypeID) {
                            $('#CustomerRateTypeID').val(response.CustomerRateTypeID);
                            $('#CustomerRateType').val(response.CustomerRateType);
                        }
                        $('#CourierCharge').val(parseFloat(response.CourierCharge).toFixed(2));
                        
                        CalculateTax();
                    }
                    else {
                        $('#CustomerRateTypeID').val(0);
                        $('#CustomerRateType').val(0);
                        $('#CourierCharge').val(0);
                    }
                }
            });
        }
    }
    function showawbtrackstatus() {
        $.ajax({
            type: "Get",
            url: '/AWBBatch/GetAWBTrackStatus',
            datatype: "json",
            data: {
                awbno: $('#AWBNo').val()
            },
            success: function (response) {
                debugger;
                var status = response.AWBTrackStatus;
                var data = response;
                var CourierId = data.CourierId;
                var VehicleId = data.VehicleId;
                if (status == "Available") {
                    var AssignedForCollection = data.AssignedForCollection;
                    var AssignedEmployeeID = data.AssignedEmployeeID;
                    var AssignedDate = data.AssignedDate;

                    if (AssignedForCollection) {
                        $('#AssignedForCollection').prop('checked', 'checked');
                        $('#AssignedForCollection').attr('disabled', 'disabled');
                        $('#AssignedDate').attr('disabled', 'disabled');
                        $('#AssignedEmployeeID').attr('disabled', 'disabled');
                        $('#AssignedDate').val(AssignedDate);
                        $('#AssignedEmployeeID').val(AssignedEmployeeID).trigger('change');
                    }
                    else {
                        $('#AssignedForCollection').removeAttr('disabled');
                      //  $('#AssignedDate').val('');
                        if (CourierId > 0) {

                            $('#AssignedEmployeeID').val(CourierId).trigger('change');
                        }
                        else {
                           // $('#AssignedEmployeeID').val('').trigger('change');
                        }

                        $('#AssignedDate').removeAttr('disabled', 'disabled');
                        $('#AssignedEmployeeID').removeAttr('disabled', 'disabled');
                    }

                }
                else { }
            }
        });
    }

    // event listener for keyup
    function checkTabPress(e) {
        "use strict";
        // pick passed event or global event object if passed one is empty
        e = e || event;
        var activeElement;
        if (e.keyCode == 9) {
            // Here read the active selected link.
            activeElement = document.activeElement;
            // If HTML element is an anchor <a>
            if ($(activeElement).attr('id') == 'ConsignorContact') {
                  $('#ConsignorMobileNo').focus();
            }
            else if ($(activeElement).attr('id') == 'ConsignorAddress1_Building') {
                $('#ConsignorLocationName').focus();
            }
            else if ($(activeElement).attr('id') == 'Consignee') {
                $('#ConsigneeMobileNo').focus();
            }
            else if ($(activeElement).attr('id') == 'ConsigneeMobileNo') {
                $('#ConsigneeLocationName').focus();
            }
        }
    }
    $(document).ready(function () {
        var startdate = '@Session["FyearFrom"].ToString()';
        var enddate = '@Session["FyearTo"].ToString()';
        var sd = new Date(startdate.split('-')[1] + '-' + startdate.split('-')[0] + '-' + startdate.split('-')[2]);
        var ed = new Date(enddate.split('-')[1] + '-' + enddate.split('-')[0] + '-' + enddate.split('-')[2]);
        //$('#BatchDate').datetimepicker({
        //    maxDate: ed,
        //    minDate: sd,
        //    format: 'DD-MM-YYYY HH:mm'
        //});
        //$('#AssignedDate').datetimepicker({
        //    maxDate: ed,
        //    minDate: sd,
        //    format: 'DD-MM-YYYY HH:mm'
        //});
        //$('#DeliveredDate').datetimepicker({
        //    maxDate: ed,
        //    minDate: sd,
        //    format: 'DD-MM-YYYY HH:mm'
        //});
        //$('#DelieveryAttemptDate').datetimepicker({
        //    maxDate: ed,
        //    minDate: sd,
        //    format: 'DD-MM-YYYY HH:mm'
        //});
        //$('#OutScanDate').datetimepicker({
        //    maxDate: ed,
        //    minDate: sd,
        //    format: 'DD-MM-YYYY HH:mm'
        //});
        //$('#ReceivedDate').datetimepicker({
        //    maxDate: ed,
        //    minDate: sd,
        //    format: 'DD-MM-YYYY HH:mm'
        //});
        //$('#PickedupDate').datetimepicker({
        //    maxDate: ed,
        //    minDate: sd,
        //    format: 'DD-MM-YYYY HH:mm'
        //});
        //$('#BatchDate').datetimepicker({ format: 'DD-MM-YYYY HH:mm' });

        //$('#AssignedDate').datetimepicker({ format: 'DD-MM-YYYY HH:mm' });
        //$('#DeliveredDate').datetimepicker({ format: 'DD-MM-YYYY HH:mm' });
        //$('#DelieveryAttemptDate').datetimepicker({ format: 'DD-MM-YYYY HH:mm' });
        //$('#OutScanDate').datetimepicker({ format: 'DD-MM-YYYY HH:mm' });
        //$('#ReceivedDate').datetimepicker({ format: 'DD-MM-YYYY HH:mm' });
        //$('#PickedupDate').datetimepicker({ format: 'DD-MM-YYYY HH:mm' });

            $("#shipperpopup").on("shown", function () {
            //$("#shipperpopup").on("shown", function () {
            //    initAutocomplete();


            });
       

        //var body = document.querySelector('body');
        //body.addEventListener('keyup', checkTabPress);
        document.addEventListener('keydown', function (event) {
            if (event.code == 'KeyC' && (event.altKey)) {
                showcustomerentry();
            }
            else if (event.code == 'KeyA' && (event.altKey)) {
                $('#btnAdd').trigger('click');
            }
        });
        document.addEventListener('keydown', function (event) {
            if (event.code == 'KeyS' && (event.altKey)) {
                showshipperaddress();
            }
        });
        document.addEventListener('keydown', function (event) {
            if (event.code == 'KeyR' && (event.altKey)) {
                showreceiveraddress();
            }
        });
        document.addEventListener('keydown', function (event) {
            if (event.code == 'KeyL' && (event.altKey)) {
                showLocationEntry();
            }
        });
        $(":text").css({ "border-radius": "5px" });
        $("select").css({ "border-radius": "5px" });
        $("textarea").css({ "border-radius": "5px" });

        $('#MovementID').focus();
        $('#SpecialInstructions').select2();
        //$('#SpecialInstructions').multiselect({
        //    //nonSelectedText: 'Select',
        //    enableClickableOptGroups: true,
        //    enableCollapsibleOptGroups: true,
        //    enableFiltering: false,
        //    includeSelectAllOption: true,
        //    selectAllValue: 'multiselect-all'
        //});





        $('#btnSave').click(function () {
            debugger;
            var defaultdate = checkDate($('#BatchDate'));
            if ($('#QuickInScanId').val() == '')
                $('#QuickInScanId').val(0);

            var QuickInScanId = $('#QuickInScanID').val();

            var AssignedEmployeeID = 0;
            var AssignedDate = defaultdate;
            var AssignedForCollection = $('#AssignedForCollection').prop('checked');

            var PickedUpEmpID = 0;
            var PickedupDate = defaultdate;
            var CollectedBy = $('#CollectedBy').prop('checked');

            var DepotReceivedBy = 0;
            var ReceivedDate = defaultdate;
            var InScanVehicleID = 0;
            var ReceivedBy = $('#ReceivedBy').prop('checked');


                //if (AssignedForCollection) {
                //    if (!checkfieldvalidate($('#AssignedDate')))
                //        return;
                //    if (!checkdrpfieldvalidate($('#AssignedEmployeeID')))
                //        return;
                //    AssignedDate = checkDate($('#AssignedDate'));
                //    AssignedEmployeeID = $('#AssignedEmployeeID').val() // Assigned for collection

                //}

            if (CollectedBy) {
                if (!checkfieldvalidate($('#PickedupDate')))
                    return;
                if (!checkdrpfieldvalidate($('#PickedUpEmpID')))
                    return;
                PickedUpEmpID = $('#PickedUpEmpID').val(); //collected by
                PickedupDate = checkDate($('#PickedupDate'));
                InScanVehicleID = $('#InscanVehicleId ').val();
            }
            else {

                Swal.fire("Data Validation","Enter AWB Collected Details!");
                return false;
            }


                if (ReceivedBy) {
                    if (!checkfieldvalidate($('#ReceivedDate')))
                        return;
                    if (!checkdrpfieldvalidate($('#DepotReceivedBy')))
                        return;
                    if (!checkdrpfieldvalidate($('#InscanVehicleId')))
                        return;
                    DepotReceivedBy = $('#DepotReceivedBy').val(); //employee name
                    ReceivedDate = checkDate($('#ReceivedDate'));

                }
                else {

                    Swal.fire("Data Validation","Enter AWB Depot Received Details!");
                    return false;
                }

            var OutScanDeliveredID = 0;
            var OutScanDate = defaultdate;
            var OutScanVehicleID = 0;
            var OutScanDelivery = $('#OutScanDelivery').prop('checked');
            if (OutScanDelivery) {
                if (!checkfieldvalidate($('#OutScanDate')))
                    return;
                if (!checkdrpfieldvalidate($('#OutScanDeliveredID')))
                    return;
                if (!checkdrpfieldvalidate($('#OutscanVehicleId')))
                    return;
                OutScanDeliveredID = $('#OutScanDeliveredID').val();
                OutScanDate = checkDate($('#OutScanDate'));
                OutScanVehicleID = $('#OutscanVehicleId').val();
            }


            var DeliveredBy = 0;
            var DeliveredDate = defaultdate;
            var Delivered = $('#Delivered').prop('checked');
            if (Delivered) {
                if (!checkfieldvalidate($('#DeliveredDate')))
                    return;
                if (!checkdrpfieldvalidate($('#DeliveredBy')))
                    return;
                DeliveredBy = $('#DeliveredBy').val();
                DeliveredDate = checkDate($('#DeliveredDate'));
            }
          
            var obj = {
                ID:$('#ID').val(),
                BatchNo: $('#BatchNumber').val(),
                BatchDate: $('#BatchDate').val(),
                CollectedBy: CollectedBy,
                ReceivedBy: ReceivedBy,
                PickedUpEmpID: $('#PickedUpEmpID').val(),
                PickedupDate: $('#PickedupDate').val(),
                QuickInScanId: $('#QuickInScanId').val(),
                InscanVehicleId: $('#InscanVehicleId').val(),
                DepotReceivedBy: $('#DepotReceivedBy').val(),
                ReceivedDate:  $('#ReceivedDate').val(), //quick inscan date
                OutScanDelivery: OutScanDelivery,
                OutScanDate: $('#OutScanDate').val(),
                OutScanDeliveredID: $('#OutScanDeliveredID').val(),
                OutscanVehicleId: $('#OutscanVehicleId').val(),
                Delivered: Delivered,
                DeliveredDate: $('#DeliveredDate').val(),
                DeliveredBy: $('#DeliveredBy').val()
            }
            $.ajax({
                type: "POST",
                url: "/AWBBatch/SaveBatch",
                datatype: "Json",
                data: obj,
                success: function (response) {
                    if (response.Status == "Ok") {
                        Swal.fire("Data Validation",response.message, "success");
                        $('#btnSave').removeAttr('disabled');
                        var BatchID = response.BatchID;
                        $('#hpagetitle').html('AWB Batch - Modify');
                        $('#ID').val(BatchID);
                        setTimeout(function () {
                            window.location.href = "/AWBBatch/Create?id=" + BatchID;

                        },100)

                    }
                    else {

                        $('#btnSave').removeAttr('disabled');
                        Swal.fire("Data Validation",response.message, "error");
                        //Swal.fire("Data Validation",response.message, "warning");
                        return false;
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        })


        if (@Model.Details.Count== 0) {
            $('#liAWBDetails').trigger('click');
        }
        
        lockawbstatus();
    });
</script>


<style>
    .nav-tabs li {
        margin-bottom: 10px !important;
    }

        .nav-tabs li a {
            padding: 10px !important;
            border-radius: 3px;
            font-size: 15px !important;
        }
</style>
<!-- Main content -->

@using (Html.BeginForm("Create", "AWBBatch", FormMethod.Post, new { @id = "FormReceipt" }))
{
    @Html.ValidationSummary(true)
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <div class="flex justify-between align-center" style="border-bottom:1px solid #07a7e3;margin-bottom:2px;">

                        <ul class="nav nav-pills nav-justified" role="tablist" id="jobenquiryul">
                            <li class="nav-item waves-effect waves-light" style="border:1px solid blue">
                                <a class="nav-link active" data-bs-toggle="tab" href="#BatchDetails" role="tab">
                                    <span class="d-block d-sm-none"><i class="fas fa-home"></i></span>
                                    <span class="d-none d-sm-block">BATCH DETAILS</span>
                                </a>
                            </li>
                            @{ if (@Model.ID > 0)
                                {
                                    <li class="nav-item waves-effect waves-light" style="border:1px solid blue" id="liAWBDetails">
                                        <a class="nav-link" data-bs-toggle="tab" href="#AWBDetails" role="tab">
                                            <span class="d-block d-sm-none"><i class="far fa-user"></i></span>
                                            <span class="d-none d-sm-block">AWB DETAILS</span>
                                        </a>
                                    </li>


                                }
                            }
                        </ul>
                    </div>
                    <div class="tab-content p-3 text-muted">
                        <div class="tab-pane active" id="BatchDetails" role="tabpanel">



                            @Html.HiddenFor(model => model.ID)

                            @Html.HiddenFor(model => model.QuickInScanId)
                            @Html.HiddenFor(model => model.DRSId)
                            <div class="row no-margin" style="padding-top:0px">
                                <div class="col-xs-12 col-sm-4">
                                    <div class="mb-2">
                                        <label class="col-form-label">Batch No.</label>
                                        @Html.TextBoxFor(model => model.BatchNumber, new { @class = "form-control", @readonly = "readonly" })
                                    </div>
                                </div>

                                <div class="col-xs-12 col-sm-4">
                                    <div class="mb-2">
                                        <label class="col-form-label">Batch Date</label>
                                        <div class="docs-datepicker">
                                            <div class="input-group">
                                                <input type="text" class="form-control docs-date datetimepicker" name="BatchDate" id="BatchDate" data-date-format="dd/MM/yyyy" data-date-autoclose="true" data-provide="datepicker" value="@Convert.ToDateTime(@Model.BatchDate).ToString("dd-MM-yyyy HH:mm")"
                                                       placeholder="Pick a date" autocomplete="off">
                                                <button type="button" class="btn btn-secondary docs-datepicker-trigger" disabled>
                                                    <i class="mdi mdi-calendar" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                            <div class="docs-datepicker-container"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-12 col-sm-4">
                                    <div class="mb-2">
                                        <label class="col-form-label">Total AWB</label>
                                        @Html.TextBoxFor(model => model.TotalAWB, new { @class = "form-control", @readonly = "readonly" })
                                    </div>
                                </div>
                                @*<div class="col-sm-6 text-right hide" style="margin-top:32px;">
                                        <input type="button" class="btn btn-primary  btnwidth" value="Save " name="Command" id="btnSave" />
                                        <a href='@Url.Action("Index", "AWBBatch")' class="btn btn-danger  btnwidth">Cancel</a>

                                    </div>*@
                            </div>
                            <hr style="color:#07a7e3!important" />
                            <h4>AWB Status</h4>
                            <div class="row  searchMc">
                                <div class="row">
                                    <div class="col-xs-12 col-sm-6 mb-4">
                                        <div class="d-flex">
                                            <div class="checkboxdesign no-padding  ">
                                                @Html.CheckBox("CollectedBy", new { @name = "CollectedBy" }) &nbsp
                                                <label class="headinglabel" style="color:#07a7e3!important;padding-left: 0!important"></label>
                                            </div>
                                            <label class="headinglabel required">Collected By</label>

                                        </div>
                                        <div class="docs-datepicker">
                                            <div class="input-group">
                                                <input type="text" class="form-control docs-date datetimepicker" name="PickedupDate" id="PickedupDate" data-date-format="dd/MM/yyyy" data-date-autoclose="true" data-provide="datepicker" value="@Model.PickedupDate"
                                                       placeholder="Pick a date" autocomplete="off">
                                                <button type="button" class="btn btn-secondary docs-datepicker-trigger" disabled>
                                                    <i class="mdi mdi-calendar" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                            <div class="docs-datepicker-container"></div>
                                        </div>

                                        <div class="mb-2 mt-2">
                                            @Html.DropDownListFor(model => model.PickedUpEmpID, new SelectList(ViewBag.Employee, "EmployeeID", "EmployeeName"), "Select", new { @class = "form-select" })
                                        </div>
                                        @Html.DropDownListFor(model => model.InscanVehicleId, new SelectList(ViewBag.Vehicle, "VehicleID", "RegistrationNo"), "Select Vehicle", new { @class = "form-select" })
                                    </div>
                                    <div class="col-xs-12 col-sm-6 mb-4">
                                        <div class="d-flex">
                                            <div class="checkboxdesign no-padding  text-right" style="float:right">
                                                @Html.CheckBox("ReceivedBy", new { @name = "ReceivedBy" }) &nbsp
                                                <label class="headinglabel" style="color:#07a7e3!important;padding-left: 0!important"></label>
                                            </div>
                                            <label class="headinglabel required">Received</label>

                                        </div>
                                        <div class="docs-datepicker">
                                            <div class="input-group">
                                                <input type="text" class="form-control docs-date datetimepicker" name="ReceivedDate" id="ReceivedDate" data-date-format="dd/MM/yyyy" data-date-autoclose="true" data-provide="datepicker" value="@Model.ReceivedDate"
                                                       placeholder="Pick a date" autocomplete="off">
                                                <button type="button" class="btn btn-secondary docs-datepicker-trigger" disabled>
                                                    <i class="mdi mdi-calendar" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                            <div class="docs-datepicker-container"></div>
                                        </div>

                                        <div class="mb-2 mt-2">
                                            @Html.DropDownListFor(model => model.DepotReceivedBy, new SelectList(ViewBag.Employee, "EmployeeID", "EmployeeName"), "Select", new { @class = "form-select" })
                                        </div>

                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xs-12 col-sm-6 mb-4">
                                        <div class="d-flex">
                                            <div class="checkboxdesign no-padding  ">
                                                @Html.CheckBox("OutScanDelivery", new { @name = "OutScanDelivery" }) &nbsp
                                                <label class="headinglabel" style="color:#07a7e3!important;padding-left: 0!important"></label>
                                            </div>
                                            <label class="headinglabel required">Outscan By</label>

                                        </div>
                                        <div class="docs-datepicker">
                                            <div class="input-group">
                                                <input type="text" class="form-control docs-date datetimepicker" name="OutScanDate" id="OutScanDate" data-date-format="dd/MM/yyyy" data-date-autoclose="true" data-provide="datepicker" value="@Model.OutScanDate"
                                                       placeholder="Pick a date" autocomplete="off">
                                                <button type="button" class="btn btn-secondary docs-datepicker-trigger" disabled>
                                                    <i class="mdi mdi-calendar" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                            <div class="docs-datepicker-container"></div>
                                        </div>

                                        <div class="mb-2 mt-2">
                                            @Html.DropDownListFor(model => model.OutScanDeliveredID, new SelectList(ViewBag.Employee, "EmployeeID", "EmployeeName"), "Select", new { @class = "form-select" })
                                        </div>
                                        @Html.DropDownListFor(model => model.OutscanVehicleId, new SelectList(ViewBag.Vehicle, "VehicleID", "RegistrationNo"), "Select Vehicle", new { @class = "form-select" })

                                    </div>

                                    <div class="col-xs-12 col-sm-6 mb-4">
                                        <div class="d-flex">
                                            <div class="checkboxdesign no-padding  text-right">
                                                @Html.CheckBox("Delivered", new { @name = "Delivered" }) &nbsp
                                                <label class="headinglabel" style="color:#07a7e3!important;padding-left: 0!important"></label>
                                            </div>
                                            <label class="headinglabel required">Delivered</label>

                                        </div>
                                        <div class="docs-datepicker">
                                            <div class="input-group">
                                                <input type="text" class="form-control docs-date datetimepicker" name="DeliveredDate" id="DeliveredDate" data-date-format="dd/MM/yyyy" data-date-autoclose="true" data-provide="datepicker" value="@Model.DeliveredDate"
                                                       placeholder="Pick a date" autocomplete="off">
                                                <button type="button" class="btn btn-secondary docs-datepicker-trigger" disabled>
                                                    <i class="mdi mdi-calendar" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                            <div class="docs-datepicker-container"></div>
                                        </div>

                                        <div class="mb-2 mt-2">
                                            @Html.DropDownListFor(model => model.DeliveredBy, new SelectList(ViewBag.Employee, "EmployeeID", "EmployeeName"), "Select", new { @class = "form-select" })
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="row mt-3">

                                <div class="col-md-12 text-md-end">

                                    @if (@Model.ID > 0)
                                    {
                                        <input type="button" class="btn btn-success" value="Update Batch" name="Command" id="btnSave" />
                                    }
                                    else
                                    {
                                        <input type="button" class="btn btn-success" value="Create Batch" name="Command" id="btnSave" />
                                    }
                                    <a href='@Url.Action("Index", "AWBBatch")' class="btn btn-secondary  btnwidth">Cancel</a>

                                </div>
                            </div>

                        </div>
                        <div class="tab-pane" id="AWBDetails" role="tabpanel">
                            <div class="row no-margin" id="AWBEntryContainer">
                                @{Html.RenderPartial("AWBEntry", Model);}
                            </div>
                        </div>


                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">

            <div class="card">
                <div class="card-body">
                    <div class="data" id="AWBListContainer">
                        @{Html.RenderPartial("AWBList", Model);}
                    </div>
                </div>
            </div>
        </div>
    </div>

}

<div class="modal fade" id="shipperpopup" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius:5px">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">
                    Shipper Address
                </h4>
            </div>

            <div class="modal-body">
                <div class="container-fluid" id="listContainer">

                </div>
            </div>
            <div class="modal-footer" style="padding-top: 5px">
                <button type="button" class="btn btn-success" onclick="saveshipperaddress()">Save</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="receiverpopup" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius:5px">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">
                    Receiver Address
                </h4>
            </div>

            <div class="modal-body" id="listcontainer1">

            </div>
            <div class="modal-footer" style="padding-top: 5px">
                <button type="button" class="btn btn-success" onclick="savereceiveraddress()">Save</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="customerpopup" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius:5px">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">
                    Customer Entry
                </h4>
            </div>

            <div class="modal-body">
                <div class="container-fluid" id="customerContainer">

                </div>
            </div>
            <div class="modal-footer" style="padding-top: 5px">
                <button type="button" class="btn btn-success" onclick="SaveCustomerEntry()">Save</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="Locationpopup" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius:5px">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">
                    Location Entry
                </h4>
            </div>

            <div class="modal-body">
                <div class="container-fluid" id="LocationContainer">

                </div>
            </div>
            <div class="modal-footer" style="padding-top: 5px">
                <button type="button" class="btn btn-success" onclick="SaveLocationEntry()">Save</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
@section scripts{

    <script src="~/assets/libs/select2/js/select2.min.js"></script>

    <script src="~/Scripts/JS/AWBBatch.js"></script>
}
