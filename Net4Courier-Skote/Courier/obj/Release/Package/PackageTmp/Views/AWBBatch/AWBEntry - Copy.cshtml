@model Net4Courier.Models.AWBBatchVM
@{

    var _decimal = @Session["Decimal"].ToString();
    var _alphanum = Session["AWBAlphaNumeric"].ToString();
}

<script>
    function RestrictSpaceSpecial(e) {
        var k;
        document.all ? k = e.keyCode : k = e.which;
        //console.log(e.keyCode);
        if ((k >= 48 && k <= 57) || k == 46)
            return true;
        else
            return false;
        //return ((k > 64 && k < 91) || (k > 96 && k < 123) || k == 8 || k == 32 || (k >= 48 && k <= 57));
    }
    function RestrictSpaceSpecial1(e) {
        var k;
        document.all ? k = e.keyCode : k = e.which;
        console.log(e.keyCode);
        if ((k >= 48 && k <= 57))
            return true;
        else
            return false;
        //return ((k > 64 && k < 91) || (k > 96 && k < 123) || k == 8 || k == 32 || (k >= 48 && k <= 57));
    }
    function setawbrowactive(index1) {

        var idtext = 'awbtr_'
        $('[id^=' + idtext + ']').each(function (index, item) {
            $('#awbtr_' + (index+1)).removeClass('rowactive');
        });
        $('#awbtr_' + index1).addClass('rowactive');
    }
    function setTwoNumberDecimal(obj) {

         if ($(obj).val() == '') {
             $(obj).val(0);
         }
         $(obj).val(parseFloat($(obj).val()).toFixed(@_decimal));

    }
    $(document).ready(function () {
        var startdate = '@Session["FyearFrom"].ToString()';
        var enddate = '@Session["FyearTo"].ToString()';
        var sd = new Date(startdate.split('-')[1] + '-' + startdate.split('-')[0] + '-' + startdate.split('-')[2]);
        var ed = new Date(enddate.split('-')[1] + '-' + enddate.split('-')[0] + '-' + enddate.split('-')[2]);

        $('#AWBDate').datetimepicker({
            maxDate: ed,
            minDate: sd,
            format: 'DD-MM-YYYY HH:mm',
        });
        $('#DeliveryLocation').change(function () {
            getMovementType();
            getCourierCharge();
        });

        $('#PickUpLocation').change(function () {

            getMovementType();
            getCourierCharge();

        });
        $('#MovementID').change(function () {
            getCourierCharge();
        });

        $('#Shipper').change(function () {
            getCourierCharge();
        });
        $('#Consignee').change(function () {
            getCourierCharge();
        });
        //$('#AWBNo').blur(function () {
        //    var txt = $('#AWBNo').val().trim();
        //    $('#AWBNo').val(txt.replace(/[^\d,]/g, ''))
        //})
        $('#AWBNo').change(function () {

            if ($('#AWBNo').val().trim() == '') {
                var message = 'Enter AWBNo!';
                $('#ulerr').addClass('show-error');
                $('#ulerr').removeClass('show-green');
                $('#lierr').html(message);
                return;
            }
            else {
                if ('@_alphanum' == 'True') {
                    var txt = $('#AWBNo').val().trim();
                    $('#AWBNo').val(txt.replace(/[^\d,]/g, ''));
                }

                if (checkduplicate($('#AWBNo').val()) == false) {
                    return false;
                }
                $.ajax({
                    type: "POST",
                    url: "/AWB/GetAWB1",
                    datatype: "Json",
                    data: { id: $('#AWBNo').val() },
                    success: function (data) {
                        if (data.Exist == 1) {
                            alert("AWB Already Exist..!");
                            $('#AWBNo').val('');
                            $('#AWBNo').focus();
                        }
                        else {

                            $.ajax({
                                type: "Get",
                                url: '/AWBBatch/GetAWBInfo',
                                datatype: "json",
                                data: {
                                    awbno: $('#AWBNo').val()
                                },
                                success: function (response) {
                                    debugger;
                                    var status = response.Status;
                                    var mode = response.Mode;
                                    var message = 'Status :' + response.Status + ', Mode :' + response.Mode;
                                    $('#CustomerName').attr('AWBCustomerId', 0);
                                    $('#CustomerName').attr('AWBCustomer', '');
                                    if (status == 'Available') {
                                        $('#ulerr').addClass('show-green');
                                        $('#ulerr').removeClass('show-error');
                                        $('#lierr').html(response.Mode);

                                    }
                                    if (status == 'Available' && mode == 'Prepaid') {
                                        var charge = response.CourierCharge;
                                        $('#CourierCharge').val(parseFloat(charge).toFixed(2));
                                        $('#CourierCharge').attr('readonly', 'readonly');
                                        $('#PaymentTypeId').val(0).trigger('change');
                                        $('#PaymentTypeId').val(5).trigger('change');
                                        $('#PaymentTypeId').attr('readonly', 'readonly');
                                        $('#PaymentTypeId').attr('disabled', 'disabled');
                                        //CalculateTax();
                                    }
                                    else if (status == 'Available' && mode == 'NotPrepaid') {
                                        $('#PaymentTypeId').val(0).trigger('change');
                                        $('#PaymentTypeId').val(3).trigger('change');
                                        $('#PaymentTypeId').removeAttr('readonly');
                                        $('#PaymentTypeId').removeAttr('disabled');
                                    }
                                    if (status == 'Available' && (mode == 'Prepaid' || mode == 'NotPrepaid')) {
                                        var InScanID = response.InScanID;
                                        var QuickInScanId = response.QuickInScanID;

                                        showawbtrackstatus();
                                        //if (QuickInScanId > 0)
                                        //    $('#lierr').html(response.Mode + ',Status : Depot Inscan Completed!' );
                                        var CustomerName = response.CustomerName;
                                        var CustomerId = response.CustomerID;
                                        var LocationName = response.LocationName;
                                        var CityName = response.CityName;
                                        var CountryName = response.CountryName;
                                        var Address1 = response.Address1;
                                        var Address2 = response.Address2;
                                        var Address3 = response.Address3;
                                        var PhoneNo = response.Phone;
                                        var Mobile = response.Mobile;
                                        var OriginLocation = response.OriginLocation;
                                        var DestinationLocation = response.DestinationLocation;
                                        var ContactPerson = '';
                                        var PickupSubLocality = response.PickupSubLocality;
                                        var DeliverySubLocality = response.DeliverySubLocality;
                                        var OriginPlaceID = response.OriginPlaceID;
                                        var DestinationPlaceID = response.DestinationPlaceID;
                                        $('#InScanID').val(InScanID);
                                        $('#QuickInScanID').val(QuickInScanId);
                                        $('#CustomerName').val(CustomerName);
                                        $('#CustomerName').attr('AWBCustomerId', CustomerId);
                                        $('#CustomerName').attr('AWBCustomer', CustomerName);
                                        $('#Shipper').val(CustomerName);
                                       // checkconsignor();
                                        //$('#Shipper').attr('readonly', 'readonly');
                                        $('#CustomerID').val(CustomerId);
                                        $("#ConsignorContact").val(ContactPerson);
                                        $("#ConsignorAddress1_Building").val(Address1);
                                        $("#ConsignorAddress2_Street").val(Address2);

                                        $("#ConsignorAddress3_PinCode").val(Address3);

                                        $("#ConsignorPhone").val(PhoneNo);
                                        $('#ConsignorMobileNo').val(Mobile);
                                        $("#ConsignorCountryName").val(CountryName);
                                        $("#ConsignorCityName").val(CityName);
                                        $("#ConsignorLocationName").val(LocationName);
                                        $("#PickUpLocation").val(OriginLocation);
                                        $("#DeliveryLocation").val(DestinationLocation);
                                        $('#PickupSubLocality').val(PickupSubLocality);
                                        $('#DeliverySubLocality').val(DeliverySubLocality);
                                        $('#OriginPlaceID').val(OriginPlaceID);
                                        if (OriginPlaceID != '')
                                            setorigincitycountry(OriginPlaceID);
                                        else {
                                            $('#OriginCity').val('');
                                            $('#OriginCountry').val('');
                                        }
                                        //var originplace = getcitycountry(OriginPlaceID);

                                        // $("#PickUpLocation").attr('readonly', 'readonly');

                                        $('#DestinationPlaceID').val(DestinationPlaceID);
                                        if (DestinationPlaceID != '')
                                            setdestinationcitycountry(DestinationPlaceID);
                                        else {
                                            $('#DeliveryCity').val('');
                                            $('#DeliveryCountry').val('');
                                        }


                                        $("#ConsignorMobileNo").val(Mobile);

                                        $('#btnAdd').removeAttr('disabled');
                                        if (mode == 'Prepaid') {
                                            //$("#DeliveryLocation").attr('readonly', 'readonly');
                                            if ($('#Shipper').val() == '') {
                                                $('#Shipper').focus();
                                            }
                                            else {
                                                $('#Consignee').focus();
                                            }
                                        }
                                        else {
                                            // $("#DeliveryLocation").removeAttr('readonly');
                                            $('#PaymentTypeId').focus();
                                        }


                                    }
                                    else if (status == 'Available') {
                                        var InScanID = response.InScanID;
                                        var QuickInScanId = response.QuickInScanID;

                                        showawbtrackstatus();
                                        //if (QuickInScanId > 0)
                                        //    $('#lierr').html(response.Mode + ',Status : Depot InScan Completed!');
                                        $('#InScanID').val(InScanID);
                                        $('#QuickInScanID').val(QuickInScanId);
                                        $('#Shipper').val('');
                                        $('#Shipper').removeAttr('readonly');
                                        $('#CourierCharge').val(0);
                                        $('#CourierCharge').removeAttr('readonly');
                                        $('#CustomerID').val(0);
                                        $("#ConsignorContact").val('');
                                        $("#ConsignorAddress1_Building").val('');
                                        $("#ConsignorAddress2_Street").val('');
                                        $("#ConsignorAddress3_PinCode").val('');
                                        $("#ConsignorPhone").val('');
                                        $("#ConsignorCountryName").val('');
                                        $("#ConsignorCityName").val('');
                                        $("#ConsignorLocationName").val('');
                                        $("#PickUpLocation").val('');
                                        $('#OriginCity').val('');
                                        $('#OriginCountry').val('');
                                        $("#DeliveryLocation").val('');
                                        $('#DeliveryCity').val('');
                                        $('#DeliveryCountry').val('');
                                        $("#PickUpLocation").removeAttr('readonly');
                                        $("#DeliveryLocation").removeAttr('readonly');
                                        $("#ConsignorMobileNo").val('');
                                        $("#MaterialCost").val(0);
                                        $('#Pieces').val(0);
                                        $('#Weight').val(0);
                                        $('#PaymentTypeId').val('').trigger('change');
                                        $('#PaymentTypeId').val(2).trigger('change');
                                        $('#PaymentTypeId').removeAttr('readonly');
                                        $('#PaymentTypeId').removeAttr('disabled');
                                        $('#btnAdd').removeAttr('disabled');
                                        $('#PaymentTypeId').focus();
                                    }
                                    else if (status == 'NotAvailable') {
                                        $('#InScanID').val('');
                                        $('#QuickInScanID').val('');
                                        $('#Shipper').val('');
                                        $('#Shipper').removeAttr('');
                                        $('#CustomerID').val(0);
                                        $("#ConsignorContact").val('');
                                        $("#ConsignorAddress1_Building").val('');
                                        $("#ConsignorAddress2_Street").val('');

                                        $("#ConsignorAddress3_PinCode").val('');

                                        $("#ConsignorPhone").val('');
                                        $("#ConsignorCountryName").val('');
                                        $("#ConsignorCityName").val('');
                                        $("#ConsignorLocationName").val('');
                                        $("#PickUpLocation").val('');
                                        $("#DeliveryLocation").val('');
                                        $("#ConsignorMobileNo").val('');
                                        $('#OriginPlaceID').val('');
                                        $('#DestinationPlaceID').val('');
                                        $('#PickupSubLocality').val('');
                                        $('#DeliverySubLocality').val('');
                                        $("#Consignee").val('');
                                        $("#MaterialCost").val('');
                                        $('#Pieces').val(0);
                                        $('#Weight').val(0);
                                        $('#btnAdd').attr('disabled', 'disabled');
                                        //$('#ulerr').removeClass('show-green');
                                        //$('#ulerr').addClass('show-error');
                                        //$('#lierr').html(message);
                                        if (response.Mode == 'Used') {
                                            Swal.fire('Data Validation','Air wayBill Used,Duplication not allowed!', "error");
                                        }
                                        else {
                                            Swal.fire('Data Validation','Air wayBill not Available!', "error");
                                        }
                                        $('#AWBNo').val('');
                                        $('#AWBNo').focus();
                                    }

                                }
                            });
                        }
                    }
                });
            }
            });

        $('#btnAdd').click(function () {
            debugger;
            $('#btnAdd').attr('disabled','disabled');
            var defaultdate = checkDate($('#BatchDate'));
            if (!checkdrpfieldvalidate($('#MovementID')))
                return;
            if (!checkdrpfieldvalidate($('#ParcelTypeID')))
                return;

            if (!checkdrpfieldvalidate($('#ProductTypeID')))
                return;



            if (!checkfieldvalidate($('#AWBNo')))
                return;

            if (!checkfieldvalidate($('#AWBDate')))
                return;

            if (!checkfieldvalidate($('#Shipper')))
                return;

            if (!checkfieldvalidate($('#Consignee')))
                return;

            if (!checkNumberfieldvalidate($('#Pieces')))
                return;

            if (!checkNumberfieldvalidate($('#Weight')))
                return;

            if (!checkNumberfieldvalidate($('#CourierCharge')))
                return;

            if (!checkdrpfieldvalidate($('#PaymentTypeId')))
                return;

            if (!checkfieldvalidate($('#PickUpLocation')))
                return;

            if (!checkfieldvalidate($('#DeliveryLocation')))
                return;

            if (!checkfieldvalidate($('#ConsignorCountryName')))
                return;

            if (!checkfieldvalidate($('#ConsigneeCountryName')))
                return;

            var CustomerID = 0;
            var PaymentTypeId = $("#PaymentTypeId").val();
            if (PaymentTypeId == 1)
                CustomerID = $('#CASHCustomerId').val();
            else if (PaymentTypeId == 2)
                CustomerID = $('#CODCustomerID').val();
            else if (PaymentTypeId == 3 || PaymentTypeId == 5)
                CustomerID = $('#CustomerID').val();
            else if (PaymentTypeId == 4)
                CustomerID = $('#FOCCustomerID').val();

            if (CustomerID == 0) {
                $('#lierr').html('Could not find the corresponding Customer!');
                return;
            }

            $('#lierr').html('');
            var DocumentTypeId = 1;
            var ParcelTypeId = $('#ParcelTypeID').val();
            var ProductTypeID = $('#ProductTypeID').val();
            var MovementID = $('#MovementID').val();
            var InScanID = $('#InScanID').val();
            var QuickInScanID = $('#QuickInscanId').val();
            var AWBNo = $('#AWBNo').val();
            var AWBDate = checkDate($('#AWBDate'));
            var Shipper = $('#Shipper').val();

            var ConsignorContact = checkdata($("#ConsignorContact"));
            var ConsignorAddress1 = $("#ConsignorAddress1_Building").val();
            var ConsignorAddress2 = $("#ConsignorAddress2_Street").val();
            var ConsignorAddress3 = $("#ConsignorAddress3_PinCode").val();
            var ConsignorPhone = checkdata($("#ConsignorPhone"));
            var ConsignorMobileNo = checkdata($('#ConsignorMobileNo'));
            var ConsignorCountryName = checkdata($("#ConsignorCountryName"));
            var ConsignorCityName = checkdata($("#ConsignorCityName"));
            var ConsignorLocationName = checkdata($("#ConsignorLocationName"));
            var Receiver = checkdata($('#Consignee'));
            var ConsigneeContact = checkdata($("#ConsigneeContact"));
            var ConsigneeAddress1 = checkdata($("#ConsigneeAddress1_Building"));
            var ConsigneeAddress2 = checkdata($("#ConsigneeAddress2_Street"));
            var ConsigneeAddress3 = checkdata($("#ConsigneeAddress3_PinCode"));
            var ConsigneePhone = checkdata($("#ConsigneePhone"));
            var ConsigneeCountryName = checkdata($("#ConsigneeCountryName"));
            var ConsigneeCityName = checkdata($("#ConsigneeCityName"));
            var ConsigneeLocationName = checkdata($("#ConsigneeLocationName"));
            var ConsigneeMobileNo = checkdata($('#ConsigneeMobileNo'));
            var Pieces = $("#Pieces").val();
            var CourierCharge = $("#CourierCharge").val();
            if ($('#OtherCharge').val() == '')
                $('#OtherCharge').val(0);
            var OtherCharge = $('#OtherCharge').val();
            var TaxPercent = $('#TaxPercent').val();
            var TaxAmount = $('#TaxAmount').val();
            var NetTotal = $('#NetTotal').val();
            var IsEnquiry = true;
            debugger;

            if ($("#MaterialCost").val() == '')
                $("#MaterialCost").val(0);

            var MaterialCost = $("#MaterialCost").val();

            var Weight = parseFloat($("#Weight").val()).toFixed(3);


            var RequestSource = "";

            var PaymentTypetext = $("#PaymentTypeId option:selected").text();
            var PickUpLocation = $('#PickUpLocation').val();
            var DeliveryLocation = $('#DeliveryLocation').val();
            var ItemDescription = checkdata($('#ItemDescription'));

            var InScanID = $('#InScanID').val();

            if ($('#QuickInscanId').val() == '')
                $('#QuickInscanId').val(0);

            var QuickInScanId = $('#QuickInscanId').val();

            var AssignedEmployeeID = 0;
            var AssignedDate = defaultdate;
            var AssignedForCollection = $('#AssignedForCollection').prop('checked');


            var OriginPlaceID = checkdata($('#OriginPlaceID'));;
            var DestinationPlaceID = checkdata($('#DestinationPlaceID'));
            var PickupSubLocality = checkdata($('#PickupSubLocality'));
            var DeliverySubLocality = checkdata($('#DeliverySubLocality'));
            debugger;
            var SpecialInstructions = $('#SpecialInstructions').val();
            var Remarks = $('#Remarks').val();
            var CustomerRateTypeId = $('#CustomerRateTypeID').val();
            var FAgentID = $('#FAgentID').val();
            var item = {
                InScanID: InScanID,
              //  QuickInScanID: QuickInScanID,
                AWBNo: AWBNo,
                CustomerID: CustomerID,
                Consignor: Shipper,
                ConsignorContact: ConsignorContact,
                ConsignorAddress1_Building: ConsignorAddress1,
                ConsignorAddress2_Street: ConsignorAddress2,
                ConsignorAddress3_PinCode: ConsignorAddress3,
                ConsignorPhone: ConsignorPhone,
                ConsignorCountryName: ConsignorCountryName,
                ConsignorCityName: ConsignorCityName,
                ConsignorLocationName: ConsignorLocationName,
                Consignee: Receiver,
                ConsigneeContact: ConsigneeContact,
                ConsigneeAddress1_Building: ConsigneeAddress1,
                ConsigneeAddress2_Street: ConsigneeAddress2,
                ConsigneeAddress3_PinCode: ConsigneeAddress3,
                ConsigneePhone: ConsigneePhone,
                ConsigneeCountryName: ConsigneeCountryName,
                ConsigneeCityName: ConsigneeCityName,
                ConsigneeLocationName: ConsigneeLocationName,
                AssignedEmployeeID: AssignedEmployeeID,
                CourierCharge: CourierCharge,
                OtherCharge: OtherCharge,
                TaxPercent: TaxPercent,
                TaxAmount: TaxAmount,
                Pieces: Pieces,
                Weight: Weight,
                CargoDescription: ItemDescription,
                MovementID: MovementID,
                ProductTypeID: ProductTypeID,
                TransactionDate: AWBDate,
                NetTotal: NetTotal,
                ParcelTypeId: ParcelTypeId,
                MaterialCost: MaterialCost,
                PaymentModeId: PaymentTypeId,
                DocumentTypeId: DocumentTypeId,
                OriginPlaceID: OriginPlaceID,
                DestinationPlaceID: DestinationPlaceID,
                PickupLocation: PickUpLocation,
                DeliveryLocation: DeliveryLocation,
                PickupSubLocality: PickupSubLocality,
                DeliverySubLocality: DeliverySubLocality,
                ConsignorMobileNo: ConsignorMobileNo,
                ConsigneeMobileNo: ConsigneeMobileNo,
                AssignedDate: AssignedDate,
                AssignedForCollection: AssignedForCollection,
                SpecialInstructions1: SpecialInstructions,
                IsEnquiry: IsEnquiry,
                RequestSource: RequestSource,
                Remarks: Remarks,
                CustomerRateTypeId: CustomerRateTypeId,
                FAgentID: FAgentID
            }
            var obj = [];
            obj.push(item);
            $('#btnAdd').attr('disabled', 'disabled');
            $.ajax({
                type: "POST",
                url: "/AWBBatch/SaveBatchAWB",
                datatype: "json",
                data: {
                    BatchID: $('#ID').val(), Details: JSON.stringify(obj)
                },
                success: function (response) {

                    if (response.Status == "Ok") {

                        Swal.fire('Data Validation', response.message, "success");
                        $('#btnAdd').removeAttr('disabled');
                        showawblist();
                        editawb(0);
                        $('#AWBNo').focus();
                        @* location.href = '@Url.Action("Index","DRSReconc")';*@
                        //window.location.href = "/AWBBatch/Create?id=" + BatchID;
                    }
                    else {

                        $('#btnAdd').removeAttr('disabled');
                        Swal.fire('Data Validation', response.message, "success");

                        return false;
                    }
                },
                error: function (err) {
                    $('#btnAdd').removeAttr('disabled');
                    console.log(err);
                }
            });



        });
        $('#SpecialInstructions').select2();
        //$('#SpecialInstructions').multiselect({
        //    //nonSelectedText: 'Select',
        //    enableClickableOptGroups: true,
        //    enableCollapsibleOptGroups: true,
        //    enableFiltering: false,
        //    includeSelectAllOption: true,
        //    selectAllValue: 'multiselect-all'
        //});

                    $("#CustomerRateType").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '/AWBBatch/GetCustomerRateType',
                        datatype: "json",
                        data: {
                            term: request.term, CustomerId: $('#CustomerID').val(), MovementId: $('#MovementID').val(), ProductTypeID: $('#ProductTypeID').val(),PaymentModeId:$('#PaymentTypeId').val(),FAgentID:$('#FAgentID').val(),CityName:$('#DeliveryCity').val(),CountryName:$('#DeliveryCountry').val(),OriginCountry:$('#OriginCountry').val(),OriginCity:$('#OriginCity').val()
                        },
                        success: function (data) {
                            response($.map(data, function (val, item) {
                                console.log(val);
                                return {
                                    label: val.CustomerRateType1,
                                    value: val.CustomerRateTypeID

                                }
                            }))
                        }
                    })
                },
                minLength: 1,
                autoFocus: false,
                focus: function (event, ui) {
                    $('#CustomerRateTypeID').val(ui.item.value);
                    $('#CustomerRateTypeID').attr('label',ui.item.label);
                    $('#CustomerRateType').val(ui.item.label);

                },
                select: function (e, i) {
                    e.preventDefault();
                    $('#CustomerRateTypeID').val(i.item.value);
                    $('#CustomerRateTypeID').attr('label', i.item.label);
                    $('#CustomerRateType').val(i.item.label);
                }
            });

            $('#CustomerRateType').change(function () {
                if ($('#CustomerRateType').val() == '') {
                    $('#CustomerRateTypeID').val(0);
                }
                else if ($('#CustomerRateType').val() != $('#CustomerRateTypeID').attr('label')) {
                    $('#CustomerRateType').val('');
                    $('#CustomerRateTypeID').val(0);
                }
                getCourierCharge();
            });

            $("#FAgentName").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '/AWBBatch/GetForwardingAgent',
                        datatype: "json",
                        data: {
                            term: request.term
                        },
                        success: function (data) {
                            response($.map(data, function (val, item) {
                                console.log(val);
                                return {
                                    label: val.AgentName,
                                    value: val.FAgentID

                                }
                            }))
                        }
                    })
                },
                minLength: 1,
                autoFocus: false,
                focus: function (event, ui) {
                    $('#FAgentName').val(ui.item.label);
                    $('#FAgentID').val(ui.item.value);
                    $('#FAgentID').attr('label', ui.item.label);

                },
                select: function (e, i) {
                    e.preventDefault();
                    $('#FAgentName').val(i.item.label);
                    $('#FAgentID').val(i.item.value);
                    $('#FAgentID').attr('label',i.item.label);
                }
            });
            $("#FAgentName").change(function () {
                if ($("#FAgentName").val() == '') {
                    $('#FAgentID').val(0);
                    $('#FAgentID').attr('label', '');
                }
                else if ($("#FAgentName").val() != $('#FAgentID').attr('label')) {
                    $('#FAgentID').val(0);
                    $('#FAgentID').attr('label', '');
                }
                getCourierCharge();
            });
        $("#ItemDescription").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '/AWBBatch/GetTypeofGoods',
                        datatype: "json",
                        data: {
                            term: request.term
                        },
                        success: function (data) {
                            response($.map(data, function (val, item) {
                                console.log(val);
                                return {
                                    label: val.TypeOfGood1,
                                    value: val.TypeOfGood1

                                }
                            }))
                        }
                    })
                },
                minLength: 1,
                autoFocus: false,
                focus: function (event, ui) {
                    $('#ItemDescription').val(ui.item.value);

                },
                select: function (e, i) {
                    e.preventDefault();
                    $('#ItemDescription').val(i.item.value);
                }
            });
        $("#CustomerName").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: '/AWB/GetCustomerName',
                    datatype: "json",
                    data: {
                        term: request.term
                    },
                    success: function (data) {
                        response($.map(data, function (val, item) {
                            console.log(val);
                            return {
                                label: val.CustomerName,
                                value: val.CustomerName,
                                CustomerId: val.CustomerID,
                                type: val.CustomerType
                            }
                        }))
                    }
                })
            },
            minLength: 1,
            autoFocus: false,
            focus: function (event, ui) {
                $('#CustomerName').val(ui.item.value);
                $('#CustomerName').attr('customername', ui.item.label);
                $('#CustomerID').val(ui.item.CustomerId);
            },
            select: function (e, i) {
                e.preventDefault();
                $("#CustomerName").val(i.item.label);
                $('#CustomerName').attr('customername', i.item.label);
                $('#CustomerID').val(i.item.CustomerId);
            }
        });

            $('#CustomerName').change(function () {
                getCourierCharge();
            });
            $('#ProductTypeID').change(function () {
                getCourierCharge();
            });
            $('#PaymentTypeId').change(function () {
                getCourierCharge();
            });
            $('#Weight').change(function () {
                getCourierCharge();
            });
            $('#PickUpLocation').autocomplete({
            source: function (request, response) {
                $.ajax({
                    //url: "@Url.Action("GetLocationList", "ZoneChart")",
                      url: "@Url.Action("GetCityList", "ZoneChart")",
                    data: { SearchText: request.term },
                    dataType: "json",
                    type: "GET",
                    success: function (data) {
                        response($.map(data, function (val, item) {
                            return {
                                label: val.City,
                                value: val.City,
                                Country: val.CountryName
                            }
                        }))
                    }
                })
            },
            minLength: 1,
            autoFocus: false,
            select: function (e, ui) {
                e.preventDefault();
                $('#PickUpLocation').val(ui.item.label);
                $("#ConsignorCountryName").val(ui.item.Country);
                $("#ConsignorCityName").val(ui.item.City);
                $("#ConsignorLocationName").val(ui.item.label);
                $('#OriginCountry').val(ui.item.Country);
                $('#OriginCity').val(ui.item.City);
                return false;
            },
                focus: function (event, ui) {
                    $('#PickUpLocation').val(ui.item.label);
                    $('#OriginCountry').val(ui.item.Country);
                    $('#OriginCity').val(ui.item.City);
                    $("#ConsignorCountryName").val(ui.item.Country);
                    $("#ConsignorCityName").val(ui.item.City);
                    $("#ConsignorLocationName").val(ui.item.label);
                return false;
            }
          });


        $('#DeliveryLocation').autocomplete({
            source: function (request, response) {
                $.ajax({
                    //url: "@Url.Action("GetLocationList", "ZoneChart")",
                      url: "@Url.Action("GetCityList", "ZoneChart")",
                    data: { SearchText: request.term },
                    dataType: "json",
                    type: "GET",
                    success: function (data) {
                        response($.map(data, function (val, item) {
                            return {
                                label: val.Location,
                                value: val.Location,
                                City: val.CityName,
                                Country: val.CountryName
                            }
                        }))
                    }
                })
            },
            minLength: 1,
            autoFocus: false,
            select: function (e, ui) {
                e.preventDefault();
                $('#DeliveryLocation').val(ui.item.label);
                $('#DeliveryCountry').val(ui.item.Country);
                $('#DeliveryCity').val(ui.item.City);
                $("#ConsigneerCountryName").val(ui.item.Country);
                $("#ConsigneeCityName").val(ui.item.City);
                $("#ConsigneeLocationName").val(ui.item.label);
                return false;
            },
            focus: function (event, ui) {
                event.preventDefault();
                    $('#DeliveryLocation').val(ui.item.label);
                    $('#DeliveryCountry').val(ui.item.Country);
                    $('#DeliveryCity').val(ui.item.City);
                    $("#ConsigneeCountryName").val(ui.item.Country);
                    $("#ConsigneeCityName").val(ui.item.City);
                    $("#ConsigneeLocationName").val(ui.item.label);

                return false;
            }
          });
        $('#btnClear').click(function () {
            editawb(0);
        })
        setTwoNumberDecimal($('#CourierCharge'));
        setTwoNumberDecimal($('#OtherCharge'));
        setTwoNumberDecimal($('#MaterialCost'));
        $("#Pieces").keypress(function (e) {
            return RestrictSpaceSpecial1(e);
        })
        $("#Pieces").change(function () {
            var x = $(this);
            var str = $(this).val().trim();
            if (str != '' && str != null) {
                $(this).val($(this).val().trim());
                str = $(this).val();
                //console.log(str);
                $(this).val(parseFloat(str).toFixed(0));
            }
            else {
                $(this).val(parseFloat(0).toFixed(0));
            }

        });
        $("#Weight").keypress(function (e) {
            return RestrictSpaceSpecial(e);
        })
        $("#Weight").change(function () {
            var x = $(this);
            var str = $(this).val().trim();
            if (str != '' && str != null) {
                $(this).val($(this).val().trim());
                str = $(this).val();
                //console.log(str);
                $(this).val(parseFloat(str).toFixed(3));
            }
            else {
                $(this).val(parseFloat(0).toFixed(3));
            }

        });
        setTimeout(function () {
            console.log('return');
            var values = $('#Specialnstructions').attr('svalue');
            console.log(values);
            if (values != null && values!=undefined) {
                var selectedOptions = values.split(',');
                for (var op1 in selectedOptions) {
                    var optionVal = selectedOptions[op1];

                    $("#Specialnstructions").find("option[value=" + optionVal + "]").prop("selected", "selected");

                }
                //$("#Specialnstructions").multiselect('reload');
                $("#Specialnstructions").select2();
            }
            $('#AWBNo').focus();
        }, 300)
    });
</script>



<div class="row" style="padding-top:10px">
    <div class="col-xs-12 col-sm-4">
        <div class="mb-2">
            <label class=" required col-form-label">Movement Type</label>
            @Html.DropDownListFor(model => model.MovementID, new SelectList(@ViewBag.Movement, "MovementID", "MovementType"), "Select", new { @class = "form-select", @required = "true", @disabled = "disabled" })
            @Html.HiddenFor(model => model.BranchLocation)
            @Html.HiddenFor(model => model.BranchCountry)
            @Html.HiddenFor(model => model.BranchCity)
        </div>
    </div>
    <div class="col-xs-12 col-sm-4">
        <div class="mb-2">
            <label class="required col-form-label">Product Type</label>
            @Html.DropDownListFor(model => model.ProductTypeID, new SelectList(ViewBag.ProductType, "ProductTypeID", "ProductName"), "Select", new { @class = "form-select" })
        </div>
    </div>
    <div class="col-xs-12 col-sm-4">
        <div class="mb-2">
            <label class="col-form-label required">Parcel Type</label>
            @Html.DropDownListFor(model => model.ParcelTypeID, new SelectList(ViewBag.parceltype, "ID", "ParcelType1"), "Select", new { @class = "form-select" })
        </div>
    </div>
    </div>
<div class="row">
    <div class="col-xs-12 col-sm-4">
        <div class="mb-2">
            <label class="col-form-label">AWB Date</label>
            @Html.TextBoxFor(model => model.AWBDate, new { @class = "form-control", @autocomplete = "off" })
        </div>
    </div>
    <div class="col-xs-12 col-sm-4">
        <div class="mb-2">
            <label class="col-form-label">Air Waybill</label>
            @Html.TextBoxFor(model => model.AWBNo, new { @class = "form-control", @autocomplete = "off" })
            @Html.HiddenFor(model => model.InScanID)
        </div>
    </div>
    <div class="col-xs-12 col-sm-4">
        <div class="mb-2">
            <label class="col-form-label">Type</label>
            @Html.DropDownListFor(model => model.PaymentTypeId, new SelectList(@ViewBag.PaymentMode, "ID", "PaymentModeText"), "Select", new { @class = "form-select", @required = "true" })
        </div>
    </div>
    </div>
<div class="row">
    <div class="col-xs-10 col-sm-6">
        <div class="mb-2">
            <div class="flexTitle">
                <a id="lblcustomer" class="col-form-label required hyperlink" style="margin-bottom: 10px !important;">Customer <span class="red">[ ALT+C ]</span></a>
                <div class="checkboxdesign no-padding text-right" style="float:right">
                    @Html.CheckBox("CustomerandShipperSame", new { @name = "CustomerandShipperSame", @checked = "checked" }) &nbsp
                    <label class="col-form-label" style="color:#07a7e3!important;padding-left: 0!important">Copy to shipper</label>
                </div>
            </div>

            @Html.TextBoxFor(model => model.CustomerName, new { @class = "form-select margin_10", @autocomplete = "off" })
            @Html.HiddenFor(model => model.TaxPercent)
        </div>
        </div>
        <div class="col-sm-3">
            <div class="mb-2">
                <label class="col-form-label">Assigned To</label>
                @Html.DropDownListFor(model => model.AssignedEmployeeID, new SelectList(ViewBag.Employee, "EmployeeID", "EmployeeName"), "Select", new { @class = "form-select" })
            </div>
        </div>
        <div class="col-sm-3">
            <div class="mb-2">
                <label class="col-form-label">Rate Type</label>
                @Html.TextBoxFor(model => model.CustomerRateType, new { @class = "form-control", @autocomplete = "off" })
                @Html.HiddenFor(model => model.CustomerRateTypeID)
            </div>
        </div>
    </div>
<div class="row">
    <div class="col-xs-12 col-sm-6">
        <div class="mb-2">
            <div class="flex">
                <div class="checkboxdesign no-padding  ">
                    <a id="btnaddress1" class="col-form-label hyperlink" onclick="showshipperaddress()">Shipper <span class="red">[ ALT+S ] </span></a>
                </div>
            </div>
            @Html.TextBoxFor(model => model.Shipper, new { @class = "form-control", @autocomplete = "off" })
            @Html.HiddenFor(model => model.ConsignorContact)
            @Html.HiddenFor(model => model.ConsignorAddress1_Building)
            @Html.HiddenFor(model => model.ConsignorAddress2_Street)
            @Html.HiddenFor(model => model.ConsignorAddress3_PinCode)
            @Html.HiddenFor(model => model.ConsignorLocationName)
            @Html.HiddenFor(model => model.ConsignorCountryName)
            @Html.HiddenFor(model => model.ConsignorCityName)
            @Html.HiddenFor(model => model.ConsignorPhone)
        </div>
    </div>
    <div class="col-md-3">
        <div class="mb-2">
            <label class="col-form-label">Phone No.</label>
            @Html.TextBoxFor(model => model.ConsignorMobileNo, new { @class = "form-control" })
        </div>
    </div>
    <div class="col-xs-12 col-sm-3">
        <div class="mb-2">
            <div class="flex">
                <div class="input-group">
                    <label class="col-form-label text-lightblue">Origin<span class="red">(Alt+L)</span></label>
                    <div class="input-group-sm mt-16 masterplus " id="lblconsignorLocation">
                        <i class="mdi mdi-dots-horizontal" aria-hidden="true"></i>
                    </div>
                </div>
            </div>            
            @Html.TextBoxFor(model => model.PickUpLocation, new { @class = "form-control" })
            @Html.HiddenFor(model => model.PickupSubLocality)
            @Html.HiddenFor(model => model.OriginPlaceID)
            @Html.HiddenFor(model => model.OriginCity)
            @Html.HiddenFor(model => model.OriginCountry)
        </div>

    </div>



    </div>
<div class="row">
    <div class="col-xs-12 col-sm-6">
        <div class="mb-2">
            <div class="flex">
                <div class="checkboxdesign no-padding  ">
                    <a id="btnaddress1" class="col-form-label hyperlink" onclick="showreceiveraddress()">Receiver <span class="red">[ ALT+R ]</span>    </a>
                    @*<label class="col-form-label">Receiver</label>*@
                </div>


            </div>
        </div>
        @Html.TextBoxFor(model => model.Consignee, new { @class = "form-control", @autocomplete = "off" })
        @Html.HiddenFor(model => model.ConsigneeContact)
        @Html.HiddenFor(model => model.ConsigneeAddress1_Building)
        @Html.HiddenFor(model => model.ConsigneeAddress2_Street)
        @Html.HiddenFor(model => model.ConsigneeAddress3_PinCode)
        @Html.HiddenFor(model => model.ConsigneeLocationName)
        @Html.HiddenFor(model => model.ConsigneeCountryName)
        @Html.HiddenFor(model => model.ConsigneeCityName)
        @Html.HiddenFor(model => model.ConsigneePhone)

    </div>
    <div class="col-md-3">
        <div class="mb-2">
            <label class="col-form-label">Phone No.</label>
            @Html.TextBoxFor(model => model.ConsigneeMobileNo, new { @class = "form-control" })
        </div>
    </div>
    <div class="col-xs-12 col-md-3">
        <div class="mb-2">
            <div class="flex">
                <div class="checkboxdesign no-padding">
                    <a class="col-form-label hyperlink">Delivery Loc.<span class="red">[ ALT+ L ] </span></a>
                </div>
            </div>
            @*<label class="col-form-label">Delivery Location</label>*@
            @*<a id="" class="col-form-label required hyperlink">Delivery Loc. <span class="red">(Alt+L)</span></a>*@
            @Html.TextBoxFor(model => model.DeliveryLocation, new { @class = "form-control" })
            @Html.HiddenFor(model => model.DeliverySubLocality, new { @class = "form-control" })
            @Html.HiddenFor(model => model.DestinationPlaceID)
            @Html.HiddenFor(model => model.DeliveryCity)
            @Html.HiddenFor(model => model.DeliveryCountry)
        </div>

    </div>
</div>

<div class="row">
    <div class="col-sm-3">
        <div class="mb-2">
            <label class="col-form-label">Pieces</label>
            @Html.TextBoxFor(model => model.Pieces, new { @class = "form-control text-right", @autocomplete = "off" })
        </div>
    </div>

    <div class="col-xs-12 col-sm-3">
        <div class="mb-2">
            <label class="col-form-label col-form-label">Weight</label>
            @Html.TextBoxFor(model => model.Weight, new { @class = "form-control text-right", @autocomplete = "off" })
        </div>
    </div>
    <div class="col-xs-12 col-sm-3">
        <div class="mb-2">
            <label class="col-form-label">C. Charge</label>
            @Html.TextBoxFor(model => model.CourierCharge, new { @class = "form-control text-right", @autocomplete = "off", @onchange = "CalculateTax()" })
        </div>
    </div>
    <div class="col-xs-12 col-sm-3">
        <div class="mb-2">
            <label class="col-form-label">Other Charges</label>
            @Html.TextBoxFor(model => model.OtherCharge, new { @class = "form-control text-right", @autocomplete = "off", @onchange = "CalculateTax()" })
        </div>
    </div>
    </div>
<div class="row">
    <div class="col-xs-12 col-sm-3">
        <div class="flexTitle">
            @*<label class="col-form-label required">Tax</label>*@
            <label class="col-form-label red" id="lblTaxPercent" style="font-size:13px">Tax  @Net4Courier.Models.CommonFunctions.GetFormatNumber(@Model.TaxPercent, "2") %</label>
            <div class="checkboxdesign no-padding text-right" style="float:right">
                @Html.CheckBox("ChkTaxPercent", new { @name = "ChkTaxPercent", @onchange = "CalculateTax()", @checked = "checked" }) &nbsp
                <label class="col-form-label" style="color:#07a7e3!important;padding-left: 0!important">Tax</label>
            </div>
        </div>
        @Html.TextBoxFor(model => model.TaxAmount, new { @class = "form-control text-right", @autocomplete = "off", @readonly = "true" })
    </div>
    <div class="col-xs-12 col-sm-3">
        <label class="col-form-label">Total Charges</label>
        @Html.TextBoxFor(model => model.NetTotal, new { @class = "form-control text-right", @autocomplete = "off", @readonly = "readonly" })
    </div>
    <div class="col-xs-12 col-sm-3">
        <label class="col-form-label">Mat. Cost</label>
        @Html.TextBoxFor(model => model.MaterialCost, new { @class = "form-control text-right", @autocomplete = "off" })
    </div>
    <div class="col-xs-12 col-sm-3">
        <label class="col-form-label">Shpr. Notes</label>
        <select id="SpecialInstructions" name="Specialnstructions" multiple="multiple" class="form-control" svalue="@Model.Specialnstructions">
            <option value="1" selected>NCND</option>
            <option value="2">Cash Only</option>
            <option value="3">Cheque Only</option>
            <option value="4">Collect Material</option>
            <option value="5">DO Copy Back</option>
        </select>
        @Html.HiddenFor(model => model.CustomerID)
        @Html.HiddenFor(model => model.CASHCustomerId)
        @Html.HiddenFor(model => model.CODCustomerID)
        @Html.HiddenFor(model => model.CODCustomerName)
        @Html.HiddenFor(model => model.CASHCustomerName)
        @Html.HiddenFor(model => model.FOCCustomerName)
        @Html.HiddenFor(model => model.FOCCustomerID)
    </div>
</div>
<div class="row">
    <div class="col-xs-12 col-sm-4">
        <label class="col-form-label">Forwarding Agent</label>
        @Html.TextBoxFor(model => model.FAgentName, new { @class = "form-control", @autocomplete = "off", @AgentName = Model.FAgentName, @AgentID = Model.FAgentID })
        @Html.HiddenFor(model => model.FAgentID)
    </div>
    <div class="col-xs-12 col-sm-4">
        <label class="col-form-label">Item Desc.</label>
        @Html.TextBoxFor(model => model.ItemDescription, new { @class = "form-control", @autocomplete = "off" })

    </div>
    <div class="col-xs-12 col-sm-4">
        <label class="col-form-label">Remarks</label>
        @Html.TextBoxFor(model => model.Remarks, new { @class = "form-control", @autocomplete = "off" })

    </div>


</div>
<div class="row" style="padding-top:10px">


    <div class="col-md-6 col-sm-6 pull-right" style="">
        @if (@Model.InScanID > 0)
        {
            <a id="btnAdd" class="btn btn-success  btnwidth pull-right">Upd<strong style="text-decoration:underline">a</strong>te & Continue</a>
        }
        else
        {
            <a id="btnAdd" class="btn btn-success  btnwidth pull-right"><strong style="text-decoration:underline">A</strong>dd & Continue</a>
        }
        &nbsp;&nbsp;

    </div>
    <div class="col-md-6">
        <a id="btnClear" class="btn btn-warning  btnwidth">Clear</a>
        <a href='@Url.Action("Index", "AWBBatch")' class="btn btn-dark btnwidth" data-toggle="tooltip" data-placement="right" title="Click here">Cancel</a>

    </div>
</div>






