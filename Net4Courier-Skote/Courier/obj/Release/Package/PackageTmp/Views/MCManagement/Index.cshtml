@model IEnumerable<Net4Courier.Models.DRRRecPayVM>
@{
    ViewBag.Title = "List";
    ViewBag.pTitle = "MC Payment";
    ViewBag.pageTitle = "MC Payment";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var isadd = true;
    var ismodify = true;
    var isdelete = true;
    var isprint = true;
    var isview = true;
    string path = "/CODReceipt/Index";

    if (Convert.ToInt32(Session["UserRoleID"]) > 1)
    {
        Net4Courier.Models.SourceMastersModel obj = new Net4Courier.Models.SourceMastersModel();
        isadd = obj.GetAddpermission(Convert.ToInt32(Session["UserRoleID"]), path);
        ismodify = obj.GetModifypermission(Convert.ToInt32(Session["UserRoleID"]), path);
        isdelete = obj.GetDeletepermission(Convert.ToInt32(Session["UserRoleID"]), path);
        isprint = obj.GetPrintpermission(Convert.ToInt32(Session["UserRoleID"]), path);
        isview = obj.GetViewpermission(Convert.ToInt32(Session["UserRoleID"]), path);

    }
}


<script type="text/javascript">


    //$(function () {
    //    $('#FromDate').datetimepicker({ format: 'DD-MM-YYYY' });

    //});

    //$(function () {
    //    $('#ToDate').datetimepicker({ format: 'DD-MM-YYYY' });

    //    $('#ToDate').datepicker("setDate", new Date());
    //});

    //$(function () {
    //    $('#txtpickuptime').datetimepicker({ format: 'DD-MM-YYYY HH:mm' });
    //});

    //var table = $('#dataTables-example').DataTable();

</script>
<script type="text/javascript">

    function format(d) {
        // `d` is the original data object for the row
        var RecPayId = d[4];

        var DataHtml = '';
        $.ajax({
            type: "Get",
            url: "/MCManagement/GetMCAWBDetails",
            datatype: "Json",
            data: { Id: RecPayId },
            success: function (data) {
                DataHtml = '<table class="subtable">';
                $.each(data, function (index, value) {
                    DataHtml = DataHtml + '<tr><td  class="text-right">' + value.AWBNo + '</td><td>' + value.AWBDate + '</td><td>' + value.ConsignorName + '</td><td>' + value.ConsigneeName + '</td><td>' + parseFloat(value.MaterialCost).toFixed(2) + '</td><td>' + parseFloat(value.Amount).toFixed(2) + '</td></tr>';
                });
                DataHtml = DataHtml + '</table>';
                $('#pr_' + RecPayId).append(DataHtml);
            }
        });

        return '<p id="pr_' + RecPayId + '"></p>';
    }
    $(document).ready(function () {
         var startdate = '@Session["FyearFrom"].ToString()';
        var enddate = '@Session["FyearTo"].ToString()';
        var sd = new Date(startdate.split('-')[1] + '-' + startdate.split('-')[0] + '-' + startdate.split('-')[2]);
        var ed = new Date(enddate.split('-')[1] + '-' + enddate.split('-')[0] + '-' + enddate.split('-')[2]);


        $(function () {
            $('#txtpickuptime').datetimepicker({
                maxDate: ed,
                minDate: sd,
                format: 'DD-MM-YYYY HH:mm',
            });
        });
        $('#dataTables-example tfoot th').each(function () {
            var title = $(this).text();
            $(this).html('<input type="text" />');
        });
        var table = $('#dataTables-example').DataTable({
            "aaSorting": [],
            //"dom": '<"top"i>rt<"top"flp><"clear">',
            //dom: "<'row'<'col-sm-3'l><'col-sm-3'f><'col-sm-6'p>>" +
            //       "<'row'<'col-sm-12'tr>>" +"<'row'<'col-sm-5'i><'col-sm-7'p>>",
            //"pagingType": "simple"
        });
        //table.draw();
        //table.columns().every(function () {
        //    var that = this;

        //    $('input', this.footer()).on('keyup change', function () {
        //        if (that.search() !== this.value) {
        //            that
        //                .search(this.value)
        //                .draw();
        //        }
        //    });
        //});


        //$('#dataTables-example').find('details-control').on('click',function () {
        $('#dataTables-example tbody').on('click', 'td.details-control', function () {
            debugger;
            var tr = $(this).closest('tr');
            var row = table.row(tr);
            if (row.child.isShown()) {
                // This row is already open - close it
                row.child.hide();
                tr.removeClass('shown');
                $(this).find('img').attr('src', '/Content/img/details_open.png');
            }
            else {
                // Open this row
                row.child(format(row.data())).show();
                tr.addClass('shown');
                $(this).find('img').attr('src', '/Content/img/details_close.png');
            }
        });



        if ('@ismodify' == 'False')
        {
            $('#dataTables-example').find('.aedit').each(function () {
                debugger;
                $(this).addClass('hide');
            });
        }
        if ('@isdelete' == 'False')
        {
            $('#dataTables-example').find('.adelete').each(function () {
                debugger;
                $(this).addClass('hide');
            });
        }
        if ('@isprint' == 'False')
        {
            $('#dataTables-example').find('.aprint').each(function () {
                debugger;
                $(this).addClass('hide');
            });
        }

    });


</script>

<div class="card"><div class="card-body">@{ Html.RenderAction("Table", "MCManagement");}</div></div>
@using (Html.BeginForm())
{
  
    <div class="card">
        <div class="card-body">
            <table class="table table-bordered mb-0" id="datatable" width="100%">
                    <thead class="table-light">
                    <tr>
                        <th>
                            Mc Payment Voucher No.
                        </th>
                        <th>
                            Mc Payment Date
                        </th>
                        <th>Total Paid Amount</th>
                        <th></th>
                        <th style="display:none;"></th>
                    </tr>
                </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td class="details-control">
                            <img src="/Content/img/details_open.png" id="plus_minus" style="cursor: pointer;" />
                            @Html.DisplayFor(modelItem => item.DocumentNo)
                        </td>
                        <td>                           
                            @Net4Courier.Models.CommonFunctions.GetShortDateFormat(item.RecPayDate)
                        </td>
                        <td style="text-align:right">
                            @Html.DisplayFor(modelItem => item.FMoney)
                        </td>
                        <td>
                        <div class="d-flex gap-3">
                            @*<a target="_blank" href="ExportShipmentReport?id=@item.CustomerInvoiceID"><i class="fa fa-print"></i></a>*@
                            @*<a  class="aprint" target="_blank" href="InvoicePrint?id=@item.CustomerInvoiceID"><i class="fa fa-print"></i></a>*@

                            @*<a class="aview"  href="Details?id=@item.CustomerInvoiceID"><i class="fa fa-eye"></i></a><br />*@

                            <a class="aedit" href="Create?id=@item.RecPayID" class="text-success"><i class="mdi mdi-pencil font-size-18"></i></a>

                            <a class="adelete" href="#" onclick="Delete(@item.RecPayID)" class="text-danger"><i class="mdi mdi-delete font-size-18"></i></a>
                            @if (isprint)
                            {
                                <a target="_blank" href="@Url.Action("PrintVoucher", "MCManagement", new { id = item.RecPayID })" class="text-danger"><i class="mdi mdi-printer font-size-18"></i></a>
                            }
                            </div>
                        </td>
                        <td style="display:none">
                            @item.RecPayID
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    </div>

}

<script>
        $(document).ready(function () {
            $("#importshipment").addClass("active");
            @if(TempData["toasterMessage"] != null)
            {
                @:toasterMessage("@TempData["toasterMessage"].ToString()");
            }
        });
        function deleteExport(id, controller) {
            debugger;
            swal({
                title: "Are you sure?",
                text: "You will not be able to recover this " + controller,
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-danger",
                confirmButtonText: "Yes, delete it!",
                cancelButtonText: "No, cancel plx!",
                closeOnConfirm: false,
                closeOnCancel: false
            },
                function (isConfirm) {
                    if (isConfirm) {
                        $.ajax({
                            type: "POST",
                            datatype: "html",
                            url: "Delete?id=" + id.toString(),
                            data: id,
                            success: function (data) {
                                debugger;
                                swal({ title: "Deleted!", text: controller + " has been deleted.", type: "success" }, function () { window.location = window.location.href; });
                            }
                        });
                    } else {
                        swal("Cancelled", controller + " is safe :)", "error");
                    }
                });

        }
</script>

