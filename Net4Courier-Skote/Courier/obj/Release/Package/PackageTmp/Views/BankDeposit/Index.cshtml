@model Net4Courier.Models.BankReconcSearch
@using System.Data
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Entry";
    ViewBag.pTitle = "Post Date Transactions";
    ViewBag.pageTitle = "GL Transactions";
    var _decimal = Convert.ToInt32(@Session["Decimal"].ToString());
}
<script type="text/javascript">
    var chequelist = [];
    function setTwoNumberDecimal(obj) {

         $(obj).val(parseFloat($(obj).val()).toFixed(@_decimal));

    }
     
    $(document).ready(function () {
        $('#FromDate2').datepicker({
            dateFormat: 'dd-mm-yy'         
         
        });

        $('#ToDate2').datepicker({
            dateFormat: 'dd-mm-yy'
        });


        $('#btnupdate').click(function () {
            if ($('#ReconcDate').val() == '') {
                Swal.fire("Data Validation","Select Deposit Date!","error")
                return false;
            }
            if ($('#DepositHeadID').val() == '') {
                Swal.fire("Data Validation", "Select Deposit Bank!", "error")
                
                return false;
            }
            if ($('#DepositHeadID').val() == $('#BankHeadID').val()) {
                Swal.fire("Data Validation", "Deposit Bank could not be same!", "error")
                
                return false;
            }
            getchequelist();

        });

        setTimeout(function () {
            var maxrow1 = $('#chequetablebody > tr').length;
            for (j = 0; j < maxrow1; j++) {
                debugger;
                $('#dwstatus_' + j).val($('#dwstatus_' + j).attr('value')).trigger('change');
                setTwoNumberDecimal($('#txtcharge_' + j));
            }
        }, 300)
    });

    function getchequelist() {
        debugger;
        chequelist = [];
        var maxrow1 = $('#chequetablebody > tr').length;
        if (maxrow1 == 0) {
              Swal.fire("Data Validation", "Select Cheque Items for Deposit!", "error")
               
                $('#btnupdate').removeAttr('disabled');
                return;
            }

            for (j = 0; j < maxrow1; j++) {
                debugger;
                var checked = $('#chk_' + j).prop("checked");
                if (checked == true) {
                             var item = {
                                 AcBankDetailID: $('#hdnDetailID_' + j).val(),
                                    Amount: $('#hdnAmount_' + j).val(),
                                    StatusReconciled: $('#chk_' + j).prop('checked'),
                                    PDCOpeningID: $('#hdnPDCOpeningID_' + j).val(),
                                    AcJournalID: $('#hdnPDCAcJournalID_' + j).val(),
                                    VoucherType: $('#hdnVoucherType_'+j).val(),
                                }
                    chequelist.push(item);
                }
                if ((j + 1) == maxrow1) {
                    if (chequelist.length == 0) {
                        Swal.fire("Data Validation", "Select Cheque Item to continue!", "error")
                        
                        $('#btnupdate').removeAttr('disabled');
                    }
                    else {
                        savereconcile();
                    }
                }
            }

    }
    function savereconcile() {
        $.ajax({
            type: "POST",
            url: "/BankDeposit/SaveBankDeposit",
            datatype: "Json",
            data: {
                ReconcDate: $('#ReconcDate').val(), BankHeadID: $('#BankHeadID').val(), DepositBankHeadId: $('#DepositHeadID').val(), Details: JSON.stringify(chequelist) },
            success: function (response) {
                var status = response.Status;
                var documentno = response.DocumentNo;
                var message = response.Message;
                if (status == "Ok") {
                    
                    Swal.fire("Data Validation", message, "success")
                    window.location.href = "/BankDeposit/Index";

                }
                else {
                    $.notify(message, "error");
                }
            }
        });
    }
    function redrawgrid(obj) {
        debugger;
        var DetailId = $(obj).attr('Detailid');
        var statuschecked = $(obj).prop('checked');

        if ($('#ChangeStatus').val() == '') {
            Swal.fire("Data Validation","Select Status to change!", "error")
            
            return false;
        }
    //    $('#loaderpopup').modal('show');
        $.ajax({
            type: "POST",
            url: "/BankDeposit/ShowChequeList",
            datatype: "html",
            data: { DetailId: DetailId, statuschecked: statuschecked, StatusTrans:$('#ChangeStatus').val(), all: false },
            success: function (response) {
                $("#listContainer1").html(response);
              //  $('#loaderpopup').modal('hide');
                setTimeout(function () {
                    var maxrow1 = $('#chequetablebody > tr').length;
                    for (j = 0; j < maxrow1; j++) {
                        debugger;
                        $('#dwstatus_' + j).val($('#dwstatus_' + j).attr('value')).trigger('change');
                    }
                },100)

            }
        });
    }
</script>
 

        @using (Html.BeginForm("Index", "BankDeposit", FormMethod.Post, new { @id = "customerledger" }))
        {
            @Html.AntiForgeryToken()

            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            <div class="card">

    <div class="card-body">
            <div class="row">
              
                    
                <div class="col-md-2">

                    <div class="mb-2">
                        <label class="col-form-label">From Date</label>
                        <div class="docs-datepicker">
                            <div class="input-group">
                                <input type="text" class="form-control docs-date" name="FromDate" id="FromDate2" value="@Model.FromDate.ToShortDateString()"
                                       placeholder="Pick a From Date" autocomplete="off">
                                <button type="button"
                                        class="btn btn-secondary docs-datepicker-trigger"
                                        disabled>
                                    <i class="mdi mdi-calendar" aria-hidden="true"></i>
                                </button>
                            </div>
                            <div class="docs-datepicker-container"></div>
                        </div>
                    </div>

                </div>
                <div class="col-md-2">

                    <div class="mb-2">
                        <label class="col-form-label">To Date</label>
                        <div class="docs-datepicker">
                            <div class="input-group">
                                <input type="text" class="form-control docs-date" name="ToDate" id="ToDate2" data-date-format="dd/MM/yyyy" data-date-autoclose="true" data-provide="datepicker" value="@Model.ToDate.ToShortDateString()"
                                       placeholder="Pick a date" autocomplete="off">
                                <button type="button" class="btn btn-secondary docs-datepicker-trigger" disabled>
                                    <i class="mdi mdi-calendar" aria-hidden="true"></i>
                                </button>
                            </div>
                            <div class="docs-datepicker-container"></div>
                        </div>
                    </div>

                </div>
                <div class="col-md-2">
                    <div class="mb-2">
                        <label class="col-form-label required">Bank</label>
                        @Html.DropDownListFor(model => model.BankHeadID, new SelectList(ViewBag.BankList, "AcHeadID", "Achead"), "Select", new { @class = "form-select", @required = "required" })
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="mb-2">
                        <label class="col-form-label  required">Output</label>
                        @Html.DropDownList("FilterStatus", new List<SelectListItem>
                        {
                            new SelectListItem{ Text="Deposit Pending", Value = "Pending" },
                            new SelectListItem{ Text="Deposited", Value = "Deposited" },
                         }, "Select", new { @class = "form-select", @value = Model.FilterStatus, @required = "true" })
                    </div>
                </div>
                        <div class="col-md-1">
                            <div class="mt-2">
                            <button class="btn btn-primary btn-success" id="btngenerate" type="submit" style="margin-top: 30px;"><i class="fa fa-search"></i></button>
                        </div>
                        </div>
                    </div>
                   
                 
            <div class="row">
               
                <div class="col-md-2">
                    <div class="mb-2">
                        <label class="col-form-label">Deposit Date</label>
                        <div class="docs-datepicker">
                            <div class="input-group">
                                <input type="text" class="form-control docs-date" name="ReconcDate" id="ReconcDate" data-date-format="dd/MM/yyyy" data-date-autoclose="true" data-provide="datepicker" value="@Model.ReconcDate.ToShortDateString()"
                                       placeholder="Pick a Reconc date" autocomplete="off">
                                <button type="button" class="btn btn-secondary docs-datepicker-trigger" disabled>
                                    <i class="mdi mdi-calendar" aria-hidden="true"></i>
                                </button>
                            </div>
                            <div class="docs-datepicker-container"></div>
                        </div>
                    </div>

                </div>
                    <div class="col-md-4">
                        <label class="col-form-label required">Deposit Bank</label>
                        @Html.DropDownListFor(model => model.DepositHeadID, new SelectList(ViewBag.BankList, "AcHeadID", "Achead"), "Select", new { @class = "form-select" })
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-primary btn-success" id="btnupdate" type="button" style="margin-top: 30px;">Update</button>
                    </div>
                </div>
            </div>            </div>
            <div class="card">
                <div class="card-body">
            <div class="row no-margin" style="padding-top: 10px">
                 <div class="col-md-12" id="listContainer1">
                        @{Html.RenderPartial("BankChequeList", Model);}

                    </div>
                    @*<div class="col-md-6" id="listContainer2">
                        @{Html.RenderPartial("AWBList", Model);}

                    </div>*@

</div>
    </div>
            </div>
        }
     




