@model IEnumerable<Net4Courier.Models.CustmorVM>

@{
   ViewBag.Title = "List";
    ViewBag.pTitle = "Manage Customer";
    ViewBag.pageTitle = "Account Receivable";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script type="text/javascript">
    function exportexcel() {
         $.ajax({
                    type: 'POST',
                    url: '@Url.Action("CustomerListExcel", "Reports")',                                        
                    success: function (response) {
                    
                    }
                });
    }
    $(document).ready(function () {
        $('#dataTables-example tfoot th').each(function () {
            var title = $(this).text();
            $(this).html('<input type="text" style="width:100%" />');
        });


        var table = $('#dataTables-example').DataTable();

        table.columns().every(function () {
            var that = this;

            $('input', this.footer()).on('keyup change', function () {
                if (that.search() !== this.value) {
                    that
                        .search(this.value)
                        .draw();
                }
            });
        });
        $("#SearchText").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: '/CustomerMaster/GetCustomerName',
                    datatype: "json",
                    data: {
                        term: request.term
                    },
                    success: function (data) {
                        response($.map(data, function (val, item) {
                            return {
                                label: val.CustomerName,
                                value: val.CustomerName,
                                CustomerId: val.CustomerID,
                                type: val.CustomerType
                            }
                        }))
                    }
                })
            },
            minLength: 1,
            autoFocus: false,
            focus: function (event, ui) {
                $("#SearchText").val(ui.item.value);
            
            },
            select: function (e, i) {
                e.preventDefault();
                $("#SearchText").val(i.item.label);
             
            },

        });
    });


</script>

    @using (Html.BeginForm("CustomerListExcel", "Reports", FormMethod.Post, new { @id = "reportparam" }))
    {
<div class="card">
    <div class="card-body">
        <div class="row">
            <div class="col-md-3">
                <label class="col-form-label">Search Contains</label>
                <input type="text" id="SearchText" class="form-control ora_border" value="@ViewBag.SearchText" />
            </div>

            <div class="col-md-1">
                <div class="mb-2 mt-2">
                    <button type="button" class="btn btn-success waves-effect waves-light filter btn_top" id="btnreport" onclick="location.href='@Url.Action("Index", "CustomerMaster")?SearchText=' + $('#SearchText').val()">
                        <i class="bx bx-search mt-1" style="font-size: 21px;"></i>
                    </button>
                </div>
            </div>
            @*<a href="JavaScript:void(0)" onclick="exportexcel()" class="btn btn-primary"> Report PDF </a>*@
     
            <div class="col-md-8 text-md-end">
                <button type="button" class="btn btn-success waves-effect waves-light filter btn_top me-1" id="btnreport" title="Export to Excel" onclick="ExportExcel()">
                    <i class="far fa-file-excel mt-1" style="font-size: 21px;"></i>
                </button>
                <button class="refresh_img small_btn_mar hide" id="btnreport" type="submit"><img src="/Content/img/refresh.png" alt="logolarge"></button>
               
                <a  class="btn btn-primary waves-effect waves-light text-md-end btn_top" href="/CustomerMaster/Create"><i class="mdi mdi-plus me-1"></i> New Customer</a>
            </div>
        </div>
         </div> </div>
    }

    
<div class="clearfix"></div>



      @if (TempData["SuccessMsg"] != null)
      {
    @* <div class="alert alert-success alert-dismissable" role="alert" id="divMsgHeader" ng-show="SuccessAlert">
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>
                                            <h4><i class="icon fa fa-check"></i>Alert!</h4>
                                            <div id="divFinalMsg">@TempData["SuccessMsg"]</div>
                                        </div>*@
             <script type="text/javascript">
                 $(document).ready(function () {
                     $.notify("@TempData["SuccessMsg"]", "success");
                 });
                                                </script>
      }
      <div class="card">
      <div class="card-body">
    
<table class="table table-bordered mb-0" id="datatable" style="width:100%">
                <thead class="table-light">
        <tr>
            <th>
                 Code

            </th>


            <th>
              Customer Name
            </th>
            <th>
                Type
            </th>

            <th>
              Contact Person
            </th>

            <th>
                Phone
            </th>
            <th>
                Mobile
            </th>
            <th>
                Log Detail
            </th>

            <th>Action</th>
        </tr>
        </thead>

    
<tbody>
@foreach (var item in Model)
{
    
    <tr>


        <td>
            @Html.DisplayFor(modelItem => item.CustomerCode)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.CustomerName)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.CustomerType)
        </td>

        <td>
            @Html.DisplayFor(modelItem => item.ContactPerson)
        </td>

        <td class="textright">
            @Html.DisplayFor(modelItem => item.Phone)
        </td>
        <td class="textright">
            @Html.DisplayFor(modelItem => item.Mobile)
        </td>
        
        <td>
            <span class="colorblue" style="font-size:11px;" title="Created Detail">@Net4Courier.Models.CommonFunctions.GetShortDateFormat(@item.CreatedDate) - @Html.DisplayFor(modelItem => item.CreatedBy) </span>
            <br />
            <span class="colorred" style="font-size:11px;" title="Modified Detail">@Net4Courier.Models.CommonFunctions.GetShortDateFormat(@item.ModifiedDate) - @Html.DisplayFor(modelItem => item.ModifiedBy)</span>
        </td>
     
        <td>
        <div class="d-flex gap-3">
            <a href="@Url.Action("Create", new { id = item.CustomerID })" class="text-success"><i class="mdi mdi-pencil font-size-18"></i></a> 
            @*<a href="@Url.Action("Delete", new { id = item.RoleID })"><i class="fa fa-times"></i></a>*@
            <a href="#" onclick="Delete(ID=@item.CustomerID)" class="text-danger"><i class="mdi mdi-delete font-size-18"></i></a>
            </div>
        </td>
    </tr>
}
    </tbody>

</table>
        </div>
    </section>
<script type="text/javascript">
    function ExportExcel() {
        $('#btnreport').trigger('click');
     
    }
    // function Delete(ID) {
    //     if (confirm("Are you sure, You want to Delete Customer?")) {
    //         window.location.href = "/CustomerMaster/DeleteConfirmed/?id=" + ID;
    //     }
    // }

     function Delete(ID) {
        Swal.fire({ title: "Are you sure?", text: "Do you want to delete this?", icon: "warning", showCancelButton: !0, confirmButtonColor: "#34c38f", cancelButtonColor: "#f46a6a", confirmButtonText: "Yes, delete it!" }).then(
            function (t) {
                if (t.value) {
                     $.ajax({
                         type: "POST",
                         url: '/CustomerMaster/DeleteConfirmed',
                         datatype: "html",
                         data: {
                             'id': ID
                         },
                         success: function (response) {
                             if (response.status == "OK") {
                                 Swal.fire("Delete Status!", response.message, "success");
                                 window.location.reload();
                             }
                             else {
                                 Swal.fire("Delete Status!", response.message, "error");
                             }
                         }
                     });
                }
            });

    }
</script>