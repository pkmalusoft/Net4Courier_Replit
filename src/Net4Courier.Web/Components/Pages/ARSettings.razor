@page "/ar-settings"
@using Net4Courier.Infrastructure.Data
@using Microsoft.EntityFrameworkCore
@using Net4Courier.Web.Services
@inject ApplicationDbContext DbContext
@inject ISnackbar Snackbar
@inject AppAuthStateProvider AuthState

<PageTitle>AR Settings - Net4Courier</PageTitle>

<MudPaper Class="pa-4">
    <MudText Typo="Typo.h5" Class="mb-4">Account Receivables Settings</MudText>

    <MudGrid>
        <MudItem xs="12" md="6">
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-3">Invoice Settings</MudText>
                <MudStack Spacing="3">
                    <MudTextField @bind-Value="_invoicePrefix" Label="Invoice Number Prefix" Variant="Variant.Outlined" />
                    <MudNumericField @bind-Value="_invoiceStartNo" Label="Starting Invoice Number" Variant="Variant.Outlined" />
                    <MudNumericField @bind-Value="_defaultPaymentTerms" Label="Default Payment Terms (Days)" Variant="Variant.Outlined" />
                    <MudSwitch @bind-Value="_autoGenerateInvoiceNo" Label="Auto-Generate Invoice Numbers" Color="Color.Primary" />
                </MudStack>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" md="6">
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-3">Receipt Settings</MudText>
                <MudStack Spacing="3">
                    <MudTextField @bind-Value="_receiptPrefix" Label="Receipt Number Prefix" Variant="Variant.Outlined" />
                    <MudNumericField @bind-Value="_receiptStartNo" Label="Starting Receipt Number" Variant="Variant.Outlined" />
                    <MudSwitch @bind-Value="_autoAllocateReceipts" Label="Auto-Allocate Receipts to Oldest Invoices" Color="Color.Primary" />
                </MudStack>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" md="6">
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-3">Credit Control</MudText>
                <MudStack Spacing="3">
                    <MudNumericField @bind-Value="_defaultCreditLimit" Label="Default Credit Limit" Variant="Variant.Outlined" Adornment="Adornment.Start" AdornmentText="@AuthState.CurrencyCode" />
                    <MudNumericField @bind-Value="_defaultCreditDays" Label="Default Credit Days" Variant="Variant.Outlined" />
                    <MudSwitch @bind-Value="_enforceCredit" Label="Enforce Credit Limits" Color="Color.Primary" />
                    <MudSwitch @bind-Value="_blockOverdueCustomers" Label="Block Orders for Overdue Customers" Color="Color.Warning" />
                </MudStack>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" md="6">
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-3">Reminders & Notifications</MudText>
                <MudStack Spacing="3">
                    <MudSwitch @bind-Value="_sendPaymentReminders" Label="Send Payment Reminders" Color="Color.Primary" />
                    <MudNumericField @bind-Value="_reminderDaysBefore" Label="Days Before Due Date" Variant="Variant.Outlined" Disabled="@(!_sendPaymentReminders)" />
                    <MudSwitch @bind-Value="_sendOverdueNotice" Label="Send Overdue Notices" Color="Color.Warning" />
                    <MudNumericField @bind-Value="_overdueNoticeDays" Label="Days After Due Date" Variant="Variant.Outlined" Disabled="@(!_sendOverdueNotice)" />
                </MudStack>
            </MudPaper>
        </MudItem>
    </MudGrid>

    <MudStack Row="true" Justify="Justify.FlexEnd" Class="mt-4">
        <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Save" OnClick="SaveSettings">
            Save Settings
        </MudButton>
    </MudStack>
</MudPaper>

@code {
    private string _invoicePrefix = "INV-";
    private int _invoiceStartNo = 1001;
    private int _defaultPaymentTerms = 30;
    private bool _autoGenerateInvoiceNo = true;

    private string _receiptPrefix = "REC-";
    private int _receiptStartNo = 1001;
    private bool _autoAllocateReceipts = true;

    private decimal _defaultCreditLimit = 50000;
    private int _defaultCreditDays = 30;
    private bool _enforceCredit = true;
    private bool _blockOverdueCustomers = false;

    private bool _sendPaymentReminders = true;
    private int _reminderDaysBefore = 3;
    private bool _sendOverdueNotice = true;
    private int _overdueNoticeDays = 7;

    private async Task SaveSettings()
    {
        await Task.Delay(100);
        Snackbar.Add("AR Settings saved successfully", Severity.Success);
    }
}
