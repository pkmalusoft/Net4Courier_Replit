@page "/temp-location"
@using MudBlazor
@using Microsoft.EntityFrameworkCore
@using Net4Courier.Infrastructure.Data
@using Net4Courier.Masters.Entities
@inject ApplicationDbContext DbContext

<MudContainer MaxWidth="MaxWidth.Small" Class="mt-4">
    <MudPaper Elevation="2" Class="pa-6">
        <MudText Typo="Typo.h5" Class="mb-4">Location Selector Test</MudText>
        
        <MudGrid>
            <MudItem xs="12">
                <MudSelect T="long?" 
                           Label="Country" 
                           Value="_selectedCountryId"
                           ValueChanged="OnCountryChanged"
                           Variant="Variant.Outlined"
                           Clearable="true">
                    @foreach (var country in _countries)
                    {
                        <MudSelectItem T="long?" Value="@((long?)country.Id)">@country.Name</MudSelectItem>
                    }
                </MudSelect>
            </MudItem>
            
            <MudItem xs="12">
                <MudSelect T="long?" 
                           Label="State" 
                           Value="_selectedStateId"
                           ValueChanged="OnStateChanged"
                           Variant="Variant.Outlined"
                           Clearable="true"
                           Disabled="@(_selectedCountryId == null)">
                    @foreach (var state in _states)
                    {
                        <MudSelectItem T="long?" Value="@((long?)state.Id)">@state.Name</MudSelectItem>
                    }
                </MudSelect>
            </MudItem>
            
            <MudItem xs="12">
                <MudSelect T="long?" 
                           @bind-Value="_selectedCityId"
                           Label="City" 
                           Variant="Variant.Outlined"
                           Clearable="true"
                           Disabled="@(_selectedStateId == null)">
                    @foreach (var city in _cities)
                    {
                        <MudSelectItem T="long?" Value="@((long?)city.Id)">@city.Name</MudSelectItem>
                    }
                </MudSelect>
            </MudItem>
        </MudGrid>
        
        <MudDivider Class="my-4" />
        
        <MudText Typo="Typo.subtitle2" Color="Color.Primary">
            Selected Values:
        </MudText>
        <MudText Typo="Typo.body2">Country ID: @(_selectedCountryId?.ToString() ?? "None")</MudText>
        <MudText Typo="Typo.body2">State ID: @(_selectedStateId?.ToString() ?? "None")</MudText>
        <MudText Typo="Typo.body2">City ID: @(_selectedCityId?.ToString() ?? "None")</MudText>
    </MudPaper>
</MudContainer>

@code {
    private List<Country> _countries = new();
    private List<State> _states = new();
    private List<City> _cities = new();
    
    private long? _selectedCountryId;
    private long? _selectedStateId;
    private long? _selectedCityId;

    protected override async Task OnInitializedAsync()
    {
        _countries = await DbContext.Countries.OrderBy(c => c.Name).ToListAsync();
    }

    private async Task OnCountryChanged(long? countryId)
    {
        _selectedCountryId = countryId;
        _selectedStateId = null;
        _selectedCityId = null;
        _states.Clear();
        _cities.Clear();

        if (countryId.HasValue)
        {
            _states = await DbContext.States
                .Where(s => s.CountryId == countryId.Value)
                .OrderBy(s => s.Name)
                .ToListAsync();
        }
    }

    private async Task OnStateChanged(long? stateId)
    {
        _selectedStateId = stateId;
        _selectedCityId = null;
        _cities.Clear();

        if (stateId.HasValue)
        {
            _cities = await DbContext.Cities
                .Where(c => c.StateId == stateId.Value)
                .OrderBy(c => c.Name)
                .ToListAsync();
        }
    }
}
