@using MudBlazor
@using Net4Courier.Operations.Entities

<MudDialog>
    <DialogContent>
        <MudStack Spacing="3">
            <MudTextField @bind-Value="Schedule.Name" Label="Schedule Name" Required="true" 
                          Placeholder="e.g., Morning Slot" />
            <MudTextField @bind-Value="Schedule.Description" Label="Description" 
                          Placeholder="e.g., Standard morning pickup window" />
            <MudGrid>
                <MudItem xs="6">
                    <MudTimePicker @bind-Time="_fromTime" Label="From Time" Required="true" />
                </MudItem>
                <MudItem xs="6">
                    <MudTimePicker @bind-Time="_toTime" Label="To Time" Required="true" />
                </MudItem>
            </MudGrid>
            <MudNumericField @bind-Value="Schedule.SortOrder" Label="Sort Order" Min="0" />
            <MudSwitch @bind-Value="Schedule.IsActive" Label="Active" Color="Color.Primary" />
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="Submit"
                   Disabled="@(string.IsNullOrWhiteSpace(Schedule.Name) || !_fromTime.HasValue || !_toTime.HasValue)">
            @(IsNew ? "Add" : "Save")
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; } = null!;
    [Parameter] public PickupSchedule Schedule { get; set; } = new();
    [Parameter] public bool IsNew { get; set; } = true;

    private TimeSpan? _fromTime;
    private TimeSpan? _toTime;

    protected override void OnInitialized()
    {
        _fromTime = Schedule.FromTime == TimeSpan.Zero ? new TimeSpan(9, 0, 0) : Schedule.FromTime;
        _toTime = Schedule.ToTime == TimeSpan.Zero ? new TimeSpan(12, 0, 0) : Schedule.ToTime;
    }

    private void Cancel() => MudDialog.Cancel();

    private void Submit()
    {
        if (_fromTime.HasValue) Schedule.FromTime = _fromTime.Value;
        if (_toTime.HasValue) Schedule.ToTime = _toTime.Value;
        MudDialog.Close(DialogResult.Ok(Schedule));
    }
}
