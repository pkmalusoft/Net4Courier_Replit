@using MudBlazor
@using Net4Courier.Masters.Entities

<MudDialog>
    <DialogContent>
        <MudStack Spacing="4">
            <MudPaper Class="pa-4" Elevation="0" Style="background-color: var(--mud-palette-background-grey);">
                <MudText Typo="Typo.h6">@Customer.Name</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">@Customer.Code</MudText>
            </MudPaper>

            <MudGrid>
                <MudItem xs="6">
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Contact Person</MudText>
                    <MudText Typo="Typo.body1">@(Customer.ContactPerson ?? "-")</MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Phone</MudText>
                    <MudText Typo="Typo.body1">@(Customer.Phone ?? "-")</MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Email</MudText>
                    <MudText Typo="Typo.body1">@(Customer.Email ?? "-")</MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Status</MudText>
                    <MudChip T="string" Size="Size.Small" Color="@GetStatusColor(Customer.CreditApprovalStatus)">
                        @Customer.CreditApprovalStatus
                    </MudChip>
                </MudItem>
            </MudGrid>

            <MudDivider />

            <MudText Typo="Typo.subtitle1"><strong>Credit Request Details</strong></MudText>
            <MudGrid>
                <MudItem xs="6">
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Requested Credit Limit</MudText>
                    <MudText Typo="Typo.body1"><strong>@((Customer.RequestedCreditLimit ?? 0).ToString("N2"))</strong></MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Requested Credit Days</MudText>
                    <MudText Typo="Typo.body1"><strong>@(Customer.RequestedCreditDays ?? 0) days</strong></MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Request Date</MudText>
                    <MudText Typo="Typo.body1">@(Customer.CreditRequestDate?.ToString("dd-MMM-yyyy HH:mm") ?? "-")</MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Request Remarks</MudText>
                    <MudText Typo="Typo.body1">@(Customer.CreditRequestRemarks ?? "-")</MudText>
                </MudItem>
            </MudGrid>

            @if (Customer.CreditApprovalStatus != CreditApprovalStatus.Pending && Customer.CreditApprovalStatus != CreditApprovalStatus.NotApplicable)
            {
                <MudDivider />
                
                <MudText Typo="Typo.subtitle1"><strong>@(Customer.CreditApprovalStatus == CreditApprovalStatus.Approved ? "Approval" : "Rejection") Details</strong></MudText>
                <MudGrid>
                    <MudItem xs="6">
                        <MudText Typo="Typo.caption" Color="Color.Secondary">Current Credit Limit</MudText>
                        <MudText Typo="Typo.body1"><strong>@Customer.CreditLimit.ToString("N2")</strong></MudText>
                    </MudItem>
                    <MudItem xs="6">
                        <MudText Typo="Typo.caption" Color="Color.Secondary">Current Credit Days</MudText>
                        <MudText Typo="Typo.body1"><strong>@Customer.CreditDays days</strong></MudText>
                    </MudItem>
                    <MudItem xs="6">
                        <MudText Typo="Typo.caption" Color="Color.Secondary">@(Customer.CreditApprovalStatus == CreditApprovalStatus.Approved ? "Approved" : "Rejected") Date</MudText>
                        <MudText Typo="Typo.body1">@(Customer.CreditApprovalDate?.ToString("dd-MMM-yyyy HH:mm") ?? "-")</MudText>
                    </MudItem>
                    <MudItem xs="6">
                        <MudText Typo="Typo.caption" Color="Color.Secondary">@(Customer.CreditApprovalStatus == CreditApprovalStatus.Approved ? "Approved" : "Rejected") By</MudText>
                        <MudText Typo="Typo.body1">@(Customer.CreditApprovedByUserName ?? "-")</MudText>
                    </MudItem>
                    <MudItem xs="12">
                        <MudText Typo="Typo.caption" Color="Color.Secondary">Remarks</MudText>
                        <MudText Typo="Typo.body1">@(Customer.CreditApprovalRemarks ?? "-")</MudText>
                    </MudItem>
                </MudGrid>
            }
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Close">Close</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; } = null!;
    [Parameter] public Party Customer { get; set; } = new();

    private void Close() => MudDialog.Close();

    private Color GetStatusColor(CreditApprovalStatus status) => status switch
    {
        CreditApprovalStatus.Pending => Color.Warning,
        CreditApprovalStatus.Approved => Color.Success,
        CreditApprovalStatus.Rejected => Color.Error,
        _ => Color.Default
    };
}
