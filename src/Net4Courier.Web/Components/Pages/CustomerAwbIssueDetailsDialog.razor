@using OpEntities = Net4Courier.Operations.Entities
@using Net4Courier.Operations.Entities

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.Receipt" Class="mr-2" />
            AWB Issue Details - @Issue?.IssueNo
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudGrid>
            <MudItem xs="6" md="3">
                <MudText Typo="Typo.caption" Color="Color.Default">Issue Date</MudText>
                <MudText Typo="Typo.body1">@Issue?.IssueDate.ToString("dd-MM-yyyy")</MudText>
            </MudItem>
            <MudItem xs="6" md="3">
                <MudText Typo="Typo.caption" Color="Color.Default">Customer</MudText>
                <MudText Typo="Typo.body1">@Issue?.CustomerName</MudText>
            </MudItem>
            <MudItem xs="6" md="3">
                <MudText Typo="Typo.caption" Color="Color.Default">Type</MudText>
                <MudChip T="string" Size="Size.Small" Color="@(Issue?.IssueType == AwbIssueType.Prepaid ? Color.Primary : Color.Secondary)">
                    @Issue?.IssueType
                </MudChip>
            </MudItem>
            <MudItem xs="6" md="3">
                <MudText Typo="Typo.caption" Color="Color.Default">Status</MudText>
                <MudChip T="string" Size="Size.Small" Color="@GetStatusColor(Issue?.Status ?? AwbIssueStatus.Issued)">
                    @Issue?.Status
                </MudChip>
            </MudItem>

            @if (Issue?.IssueType == AwbIssueType.Prepaid)
            {
                <MudItem xs="6" md="3">
                    <MudText Typo="Typo.caption" Color="Color.Default">Origin</MudText>
                    <MudText Typo="Typo.body1">@(Issue?.Origin ?? "-")</MudText>
                </MudItem>
                <MudItem xs="6" md="3">
                    <MudText Typo="Typo.caption" Color="Color.Default">Destination</MudText>
                    <MudText Typo="Typo.body1">@(Issue?.Destination ?? "-")</MudText>
                </MudItem>
                <MudItem xs="6" md="3">
                    <MudText Typo="Typo.caption" Color="Color.Default">Rate per AWB</MudText>
                    <MudText Typo="Typo.body1">@Issue?.RatePerAWB.ToString("N2")</MudText>
                </MudItem>
                <MudItem xs="6" md="3">
                    <MudText Typo="Typo.caption" Color="Color.Default">Total Amount</MudText>
                    <MudText Typo="Typo.body1" Color="Color.Primary">@Issue?.TotalAmount.ToString("N2")</MudText>
                </MudItem>
                <MudItem xs="6" md="3">
                    <MudText Typo="Typo.caption" Color="Color.Default">Payment Mode</MudText>
                    <MudText Typo="Typo.body1">@Issue?.PaymentMode</MudText>
                </MudItem>
                <MudItem xs="6" md="3">
                    <MudText Typo="Typo.caption" Color="Color.Default">Account</MudText>
                    <MudText Typo="Typo.body1">@(Issue?.CashAccountName ?? Issue?.BankAccountName ?? "-")</MudText>
                </MudItem>
                @if (!string.IsNullOrEmpty(Issue?.BankReferenceNo))
                {
                    <MudItem xs="6" md="3">
                        <MudText Typo="Typo.caption" Color="Color.Default">Bank Reference</MudText>
                        <MudText Typo="Typo.body1">@Issue.BankReferenceNo</MudText>
                    </MudItem>
                }
                <MudItem xs="6" md="3">
                    <MudText Typo="Typo.caption" Color="Color.Default">Payment Date</MudText>
                    <MudText Typo="Typo.body1">@(Issue?.PaymentDate?.ToString("dd-MM-yyyy") ?? "-")</MudText>
                </MudItem>
            }

            @if (!string.IsNullOrEmpty(Issue?.Remarks))
            {
                <MudItem xs="12">
                    <MudText Typo="Typo.caption" Color="Color.Default">Remarks</MudText>
                    <MudText Typo="Typo.body1">@Issue.Remarks</MudText>
                </MudItem>
            }

            <MudItem xs="12">
                <MudDivider Class="my-2" />
                <MudText Typo="Typo.subtitle2" Class="mb-2">AWB Numbers (@Details?.Count)</MudText>
            </MudItem>

            <MudItem xs="12">
                <MudTable Items="@Details" Dense="true" Hover="true" Striped="true" FixedHeader="true" Height="300px">
                    <HeaderContent>
                        <MudTh>AWB No.</MudTh>
                        <MudTh>Status</MudTh>
                        <MudTh>Used Date</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="AWB No.">@context.AWBNo</MudTd>
                        <MudTd DataLabel="Status">
                            <MudChip T="string" Size="Size.Small" Color="@GetDetailStatusColor(context.Status)">
                                @context.Status
                            </MudChip>
                        </MudTd>
                        <MudTd DataLabel="Used Date">@(context.UsedDate?.ToString("dd-MM-yyyy") ?? "-")</MudTd>
                    </RowTemplate>
                </MudTable>
            </MudItem>
        </MudGrid>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Close">Close</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="Print">
            <MudIcon Icon="@Icons.Material.Filled.Print" Class="mr-1" /> Print
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; } = null!;
    [Parameter] public OpEntities.CustomerAwbIssue? Issue { get; set; }
    [Parameter] public List<OpEntities.CustomerAwbIssueDetail>? Details { get; set; }

    private void Close() => MudDialog.Close();

    private void Print()
    {
        MudDialog.Close();
    }

    private Color GetStatusColor(AwbIssueStatus status) => status switch
    {
        AwbIssueStatus.Issued => Color.Success,
        AwbIssueStatus.PartiallyUsed => Color.Warning,
        AwbIssueStatus.FullyUsed => Color.Info,
        AwbIssueStatus.Cancelled => Color.Error,
        _ => Color.Default
    };

    private Color GetDetailStatusColor(AwbDetailStatus status) => status switch
    {
        AwbDetailStatus.Issued => Color.Success,
        AwbDetailStatus.Used => Color.Info,
        AwbDetailStatus.Cancelled => Color.Error,
        _ => Color.Default
    };
}
