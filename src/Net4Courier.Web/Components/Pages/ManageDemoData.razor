@page "/manage-demo-data"
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.EntityFrameworkCore
@using Net4Courier.Infrastructure.Data
@using Net4Courier.Infrastructure.Services
@using Net4Courier.Web.Services
@attribute [Authorize(Roles = "PlatformAdmin")]
@inject IDemoDataService DemoDataService
@inject ISnackbar Snackbar
@inject IDialogService DialogService
@inject AuthService AuthService
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager Navigation

<PageTitle>Manage Demo Data - Net4Courier</PageTitle>

<MudBreadcrumbs Items="_breadcrumbs" Class="mb-2" />

<MudText Typo="Typo.h4" GutterBottom="true">Manage Demo Data</MudText>
<MudText Typo="Typo.subtitle1" Class="mb-4" Color="Color.Secondary">Create or delete demo data for training and demonstration purposes</MudText>

@if (_loading)
{
    <MudProgressLinear Color="Color.Primary" Indeterminate="true" />
}
else
{
    <MudGrid>
        <MudItem xs="12" lg="6">
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4">
                    <MudIcon Icon="@Icons.Material.Filled.BarChart" Class="mr-2" />Demo Data Statistics
                </MudText>
                
                <MudText Typo="Typo.subtitle2" Class="mb-2" Color="Color.Primary">Master Data</MudText>
                <MudSimpleTable Dense="true" Hover="true" Class="mb-4">
                    <tbody>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.People" Size="Size.Small" Class="mr-2" />Customers</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.Customers</td>
                        </tr>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.Store" Size="Size.Small" Class="mr-2" />Vendors</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.Vendors</td>
                        </tr>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.SupportAgent" Size="Size.Small" Class="mr-2" />Agents</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.Agents</td>
                        </tr>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.LocalShipping" Size="Size.Small" Class="mr-2" />Courier Partners</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.Couriers</td>
                        </tr>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.Badge" Size="Size.Small" Class="mr-2" />Employees</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.Employees</td>
                        </tr>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.DirectionsCar" Size="Size.Small" Class="mr-2" />Vehicles</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.Vehicles</td>
                        </tr>
                    </tbody>
                </MudSimpleTable>

                <MudText Typo="Typo.subtitle2" Class="mb-2" Color="Color.Primary">AWB Stock & Prepaid</MudText>
                <MudSimpleTable Dense="true" Hover="true" Class="mb-4">
                    <tbody>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.Inventory" Size="Size.Small" Class="mr-2" />AWB Stocks</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.AWBStocks</td>
                        </tr>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.Description" Size="Size.Small" Class="mr-2" />Prepaid Documents</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.PrepaidDocuments</td>
                        </tr>
                    </tbody>
                </MudSimpleTable>

                <MudText Typo="Typo.subtitle2" Class="mb-2" Color="Color.Primary">Operations</MudText>
                <MudSimpleTable Dense="true" Hover="true" Class="mb-4">
                    <tbody>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.MoveToInbox" Size="Size.Small" Class="mr-2" />Pickup Requests</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.PickupRequests</td>
                        </tr>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.QrCode" Size="Size.Small" Class="mr-2" />AWBs (Shipments)</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.AWBs</td>
                        </tr>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.DeliveryDining" Size="Size.Small" Class="mr-2" />Delivery Run Sheets</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.DRS</td>
                        </tr>
                    </tbody>
                </MudSimpleTable>

                <MudText Typo="Typo.subtitle2" Class="mb-2" Color="Color.Primary">CRM</MudText>
                <MudSimpleTable Dense="true" Hover="true" Class="mb-4">
                    <tbody>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.ConfirmationNumber" Size="Size.Small" Class="mr-2" />Tickets</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.Tickets</td>
                        </tr>
                    </tbody>
                </MudSimpleTable>

                <MudText Typo="Typo.subtitle2" Class="mb-2" Color="Color.Primary">Finance</MudText>
                <MudSimpleTable Dense="true" Hover="true" Class="mb-4">
                    <tbody>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.Receipt" Size="Size.Small" Class="mr-2" />Invoices</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.Invoices</td>
                        </tr>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.Payment" Size="Size.Small" Class="mr-2" />Receipts</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.Receipts</td>
                        </tr>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.Book" Size="Size.Small" Class="mr-2" />Journals</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.Journals</td>
                        </tr>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.Payments" Size="Size.Small" Class="mr-2" />Cash/Bank Transactions</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.CashBankTransactions</td>
                        </tr>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.AccountBalance" Size="Size.Small" Class="mr-2" />Bank Accounts</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.BankAccounts</td>
                        </tr>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.Balance" Size="Size.Small" Class="mr-2" />Bank Reconciliations</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.BankReconciliations</td>
                        </tr>
                    </tbody>
                </MudSimpleTable>

                <MudText Typo="Typo.subtitle2" Class="mb-2" Color="Color.Primary">General Ledger (TrueBooks)</MudText>
                <MudSimpleTable Dense="true" Hover="true">
                    <tbody>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.AccountTree" Size="Size.Small" Class="mr-2" />Chart of Accounts</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.ChartOfAccounts</td>
                        </tr>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.CurrencyExchange" Size="Size.Small" Class="mr-2" />Currencies</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.Currencies</td>
                        </tr>
                        <tr>
                            <td><MudIcon Icon="@Icons.Material.Filled.Percent" Size="Size.Small" Class="mr-2" />Tax Codes</td>
                            <td style="text-align: right; color: #2196f3; font-weight: bold;">@_stats.TaxCodes</td>
                        </tr>
                    </tbody>
                </MudSimpleTable>
                
                <MudDivider Class="my-4" />
                
                <MudButton Variant="Variant.Outlined" Color="Color.Primary" OnClick="RefreshStats" 
                           StartIcon="@Icons.Material.Filled.Refresh" Class="mr-2">
                    Refresh Stats
                </MudButton>
            </MudPaper>
        </MudItem>
        
        <MudItem xs="12" lg="6">
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4">
                    <MudIcon Icon="@Icons.Material.Filled.AccountTree" Class="mr-2" />GL Data (TrueBooks)
                </MudText>
                <MudText Typo="Typo.body2" Class="mb-3" Color="Color.Secondary">
                    Create Chart of Accounts, Currencies, Tax Codes, and Voucher Numbering for a courier company.
                </MudText>
                <MudButton Variant="Variant.Filled" Color="Color.Tertiary" OnClick="CreateGLData" 
                           Disabled="@_processing" StartIcon="@Icons.Material.Filled.AccountTree" Class="mb-2" FullWidth="true">
                    @if (_processing && _processingAction == "gl") { <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" /> }
                    Create GL Data
                </MudButton>
            </MudPaper>
            
            <MudPaper Class="pa-4 mt-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4">
                    <MudIcon Icon="@Icons.Material.Filled.Group" Class="mr-2" />Master Data
                </MudText>
                <MudText Typo="Typo.body2" Class="mb-3" Color="Color.Secondary">
                    Create Customers, Vendors, Agents, Courier Partners, Employees, and Vehicles.
                </MudText>
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="CreateMasterData" 
                           Disabled="@_processing" StartIcon="@Icons.Material.Filled.PersonAdd" Class="mb-2" FullWidth="true">
                    @if (_processing && _processingAction == "master") { <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" /> }
                    Create Master Data
                </MudButton>
            </MudPaper>
            
            <MudPaper Class="pa-4 mt-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4">
                    <MudIcon Icon="@Icons.Material.Filled.Inventory" Class="mr-2" />AWB Stock & Prepaid
                </MudText>
                <MudText Typo="Typo.body2" Class="mb-3" Color="Color.Secondary">
                    Create AWB Stock entries and Prepaid Documents for customers.
                </MudText>
                <MudButton Variant="Variant.Filled" Color="Color.Info" OnClick="CreateAWBStockData" 
                           Disabled="@_processing" StartIcon="@Icons.Material.Filled.Inventory" Class="mb-2" FullWidth="true">
                    @if (_processing && _processingAction == "awbstock") { <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" /> }
                    Create AWB Stock Data
                </MudButton>
            </MudPaper>
            
            <MudPaper Class="pa-4 mt-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4">
                    <MudIcon Icon="@Icons.Material.Filled.LocalShipping" Class="mr-2" />Operations Data
                </MudText>
                <MudText Typo="Typo.body2" Class="mb-3" Color="Color.Secondary">
                    Create complete courier workflows: Pickup → AWB → DRS → Delivery → Invoice → Receipt.
                </MudText>
                <MudButton Variant="Variant.Filled" Color="Color.Secondary" OnClick="CreateTransactionData" 
                           Disabled="@_processing" StartIcon="@Icons.Material.Filled.LocalShipping" Class="mb-2" FullWidth="true">
                    @if (_processing && _processingAction == "transaction") { <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" /> }
                    Create Operations Data
                </MudButton>
            </MudPaper>
            
            <MudPaper Class="pa-4 mt-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4">
                    <MudIcon Icon="@Icons.Material.Filled.SupportAgent" Class="mr-2" />CRM Data
                </MudText>
                <MudText Typo="Typo.body2" Class="mb-3" Color="Color.Secondary">
                    Create Ticket Categories and sample Tickets linked to AWBs.
                </MudText>
                <MudButton Variant="Variant.Filled" Color="Color.Warning" OnClick="CreateCRMData" 
                           Disabled="@_processing" StartIcon="@Icons.Material.Filled.ConfirmationNumber" Class="mb-2" FullWidth="true">
                    @if (_processing && _processingAction == "crm") { <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" /> }
                    Create CRM Data
                </MudButton>
            </MudPaper>
            
            <MudPaper Class="pa-4 mt-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4">
                    <MudIcon Icon="@Icons.Material.Filled.AccountBalanceWallet" Class="mr-2" />Finance Data
                </MudText>
                <MudText Typo="Typo.body2" Class="mb-3" Color="Color.Secondary">
                    Create Journal Entries, Cash/Bank Transactions, Bank Accounts, and Reconciliations.
                </MudText>
                <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="CreateFinanceData" 
                           Disabled="@_processing" StartIcon="@Icons.Material.Filled.AccountBalanceWallet" Class="mb-2" FullWidth="true">
                    @if (_processing && _processingAction == "finance") { <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" /> }
                    Create Finance Data
                </MudButton>
            </MudPaper>
            
            <MudPaper Class="pa-4 mt-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4" Color="Color.Error">
                    <MudIcon Icon="@Icons.Material.Filled.DeleteForever" Class="mr-2" />Delete Demo Data
                </MudText>
                <MudText Typo="Typo.body2" Class="mb-3" Color="Color.Secondary">
                    Permanently remove all demo data from the system. Real data will not be affected.
                </MudText>
                <MudButton Variant="Variant.Filled" Color="Color.Error" OnClick="DeleteDemoData" 
                           Disabled="@_processing" StartIcon="@Icons.Material.Filled.Delete" FullWidth="true">
                    @if (_processing && _processingAction == "delete") { <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" /> }
                    Delete All Demo Data
                </MudButton>
            </MudPaper>
            
            <MudPaper Class="pa-4 mt-4" Elevation="2" Style="border: 2px solid #d32f2f;">
                <MudText Typo="Typo.h6" Class="mb-2" Color="Color.Error">
                    <MudIcon Icon="@Icons.Material.Filled.Warning" Class="mr-2" />DANGER ZONE
                </MudText>
                <MudText Typo="Typo.h6" Class="mb-4" Color="Color.Error">
                    <MudIcon Icon="@Icons.Material.Filled.DeleteSweep" Class="mr-2" />Delete ALL Data
                </MudText>
                <MudAlert Severity="Severity.Error" Class="mb-3" Dense="true">
                    This will permanently delete ALL business data including customers, shipments, invoices, receipts, and all other records. 
                    This action CANNOT be undone. Only use this to reset the system for a fresh start.
                </MudAlert>
                
                <MudText Typo="Typo.body2" Class="mb-2" Color="Color.Secondary">
                    Current data that will be deleted:
                </MudText>
                <MudSimpleTable Dense="true" Hover="true" Class="mb-4" Style="max-width: 400px;">
                    <tbody>
                        <tr><td>Parties (Customers, Vendors, etc.)</td><td style="text-align: right; font-weight: bold;">@_allStats.Parties</td></tr>
                        <tr><td>Employees</td><td style="text-align: right; font-weight: bold;">@_allStats.Employees</td></tr>
                        <tr><td>Vehicles</td><td style="text-align: right; font-weight: bold;">@_allStats.Vehicles</td></tr>
                        <tr><td>AWBs (Shipments)</td><td style="text-align: right; font-weight: bold;">@_allStats.AWBs</td></tr>
                        <tr><td>Pickup Requests</td><td style="text-align: right; font-weight: bold;">@_allStats.PickupRequests</td></tr>
                        <tr><td>Delivery Run Sheets</td><td style="text-align: right; font-weight: bold;">@_allStats.DRS</td></tr>
                        <tr><td>Invoices</td><td style="text-align: right; font-weight: bold;">@_allStats.Invoices</td></tr>
                        <tr><td>Receipts</td><td style="text-align: right; font-weight: bold;">@_allStats.Receipts</td></tr>
                        <tr><td>Journals</td><td style="text-align: right; font-weight: bold;">@_allStats.Journals</td></tr>
                    </tbody>
                </MudSimpleTable>
                
                <MudText Typo="Typo.body2" Class="mb-2">
                    Type <strong style="color: #d32f2f;">DELETE ALL</strong> to confirm:
                </MudText>
                <MudTextField @bind-Value="_deleteConfirmText" Label="Confirmation" Variant="Variant.Outlined" 
                              Placeholder="Type DELETE ALL" Class="mb-3" />
                
                <MudButton Variant="Variant.Filled" Color="Color.Error" OnClick="DeleteAllData" 
                           Disabled="@(_processing || _deleteConfirmText != "DELETE ALL")" 
                           StartIcon="@Icons.Material.Filled.DeleteSweep" FullWidth="true">
                    @if (_processing && _processingAction == "deleteall") { <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" /> }
                    Delete ALL Data Permanently
                </MudButton>
            </MudPaper>
        </MudItem>
    </MudGrid>
    
    <MudPaper Class="pa-4 mt-4" Elevation="2">
        <MudText Typo="Typo.h6" Class="mb-3">
            <MudIcon Icon="@Icons.Material.Filled.Info" Class="mr-2" />About Demo Data
        </MudText>
        <MudGrid>
            <MudItem xs="12" md="6">
                <MudText Typo="Typo.body2">
                    <ul>
                        <li><strong>GL Data:</strong> Creates Chart of Accounts (55 accounts), 4 Currencies, and 3 Tax Codes for a courier company</li>
                        <li><strong>Master Data:</strong> Creates 5 Customers, 3 Vendors, 2 Agents, 3 Courier Partners, 5 Employees, and 3 Vehicles</li>
                        <li><strong>AWB Stock:</strong> Creates 2 AWB Stock entries and 2 Prepaid Documents</li>
                        <li><strong>Operations:</strong> Creates 5 complete shipment workflows with tracking events</li>
                    </ul>
                </MudText>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudText Typo="Typo.body2">
                    <ul>
                        <li><strong>CRM Data:</strong> Creates 5 Ticket Categories and 5 Tickets with various statuses</li>
                        <li><strong>Finance Data:</strong> Creates 3 Journal Entries, 6 Cash/Bank Transactions, 1 Bank Account, and 1 Reconciliation</li>
                        <li><strong>Identification:</strong> All demo records are marked with <span style="color: #2196f3; font-weight: bold;">blue text</span> in data grids</li>
                        <li><strong>Safe Deletion:</strong> Only demo records are deleted; real business data is never affected</li>
                    </ul>
                </MudText>
            </MudItem>
        </MudGrid>
    </MudPaper>
}

@code {
    private bool _loading = true;
    private bool _processing = false;
    private string _processingAction = "";
    private bool _isPlatformAdmin = false;
    private DemoDataStats _stats = new();
    private AllDataStats _allStats = new();
    private string _deleteConfirmText = "";
    
    private List<BreadcrumbItem> _breadcrumbs = new()
    {
        new BreadcrumbItem("Platform Administration", href: null, disabled: true),
        new BreadcrumbItem("Manage Demo Data", href: null, disabled: true)
    };

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        var username = authState.User?.Identity?.Name;
        
        if (!string.IsNullOrEmpty(username))
        {
            _isPlatformAdmin = await AuthService.IsPlatformAdminByUsernameAsync(username);
        }
        
        if (!_isPlatformAdmin)
        {
            Navigation.NavigateTo("/access-denied", replace: true);
            return;
        }
        
        await RefreshStats();
        _loading = false;
    }

    private async Task RefreshStats()
    {
        try
        {
            _stats = await DemoDataService.GetDemoDataStatsAsync();
            _allStats = await DemoDataService.GetAllDataStatsAsync();
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error loading stats: {ex.Message}", Severity.Error);
        }
    }

    private async Task CreateGLData()
    {
        _processing = true;
        _processingAction = "gl";
        StateHasChanged();
        
        try
        {
            var result = await DemoDataService.CreateGLDataAsync();
            if (result)
            {
                Snackbar.Add("GL data (Chart of Accounts, Currencies, Tax Codes) created successfully!", Severity.Success);
                await RefreshStats();
            }
            else
            {
                Snackbar.Add("Failed to create GL data", Severity.Error);
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error: {ex.Message}", Severity.Error);
        }
        finally
        {
            _processing = false;
            _processingAction = "";
        }
    }

    private async Task CreateMasterData()
    {
        _processing = true;
        _processingAction = "master";
        StateHasChanged();
        
        try
        {
            var result = await DemoDataService.CreateMasterDataAsync();
            if (result)
            {
                Snackbar.Add("Master data (Parties, Employees, Vehicles) created successfully!", Severity.Success);
                await RefreshStats();
            }
            else
            {
                Snackbar.Add("Failed to create master data", Severity.Error);
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error: {ex.Message}", Severity.Error);
        }
        finally
        {
            _processing = false;
            _processingAction = "";
        }
    }

    private async Task CreateAWBStockData()
    {
        _processing = true;
        _processingAction = "awbstock";
        StateHasChanged();
        
        try
        {
            var result = await DemoDataService.CreateAWBStockDataAsync();
            if (result)
            {
                Snackbar.Add("AWB Stock and Prepaid documents created successfully!", Severity.Success);
                await RefreshStats();
            }
            else
            {
                Snackbar.Add("Failed to create AWB Stock data", Severity.Error);
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error: {ex.Message}", Severity.Error);
        }
        finally
        {
            _processing = false;
            _processingAction = "";
        }
    }

    private async Task CreateTransactionData()
    {
        _processing = true;
        _processingAction = "transaction";
        StateHasChanged();
        
        try
        {
            var result = await DemoDataService.CreateTransactionDataAsync();
            if (result)
            {
                Snackbar.Add("Operations data (Pickups, AWBs, DRS, Invoices, Receipts) created successfully!", Severity.Success);
                await RefreshStats();
            }
            else
            {
                Snackbar.Add("Failed to create operations data", Severity.Error);
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error: {ex.Message}", Severity.Error);
        }
        finally
        {
            _processing = false;
            _processingAction = "";
        }
    }

    private async Task CreateCRMData()
    {
        _processing = true;
        _processingAction = "crm";
        StateHasChanged();
        
        try
        {
            var result = await DemoDataService.CreateCRMDataAsync();
            if (result)
            {
                Snackbar.Add("CRM data (Ticket Categories, Tickets) created successfully!", Severity.Success);
                await RefreshStats();
            }
            else
            {
                Snackbar.Add("Failed to create CRM data", Severity.Error);
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error: {ex.Message}", Severity.Error);
        }
        finally
        {
            _processing = false;
            _processingAction = "";
        }
    }

    private async Task CreateFinanceData()
    {
        _processing = true;
        _processingAction = "finance";
        StateHasChanged();
        
        try
        {
            var result = await DemoDataService.CreateFinanceDataAsync();
            if (result)
            {
                Snackbar.Add("Finance data (Journals, Cash/Bank Transactions, Bank Reconciliations) created successfully!", Severity.Success);
                await RefreshStats();
            }
            else
            {
                Snackbar.Add("Failed to create finance data", Severity.Error);
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error: {ex.Message}", Severity.Error);
        }
        finally
        {
            _processing = false;
            _processingAction = "";
        }
    }

    private async Task DeleteDemoData()
    {
        var result = await DialogService.ShowMessageBox(
            "Confirm Delete",
            "Are you sure you want to delete ALL demo data? This will remove demo data from all modules including GL, Masters, Operations, CRM, and Finance. This action cannot be undone.",
            yesText: "Yes, Delete All",
            cancelText: "Cancel");
        
        if (result != true) return;
        
        _processing = true;
        _processingAction = "delete";
        StateHasChanged();
        
        try
        {
            var deleteResult = await DemoDataService.DeleteAllDemoDataAsync();
            if (deleteResult)
            {
                Snackbar.Add("All demo data deleted successfully!", Severity.Success);
                await RefreshStats();
            }
            else
            {
                Snackbar.Add("Failed to delete demo data", Severity.Error);
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error: {ex.Message}", Severity.Error);
        }
        finally
        {
            _processing = false;
            _processingAction = "";
        }
    }

    private async Task DeleteAllData()
    {
        if (_deleteConfirmText != "DELETE ALL") return;
        
        var result = await DialogService.ShowMessageBox(
            "FINAL CONFIRMATION",
            "You are about to delete ALL data from the system. This includes ALL customers, shipments, invoices, receipts, employees, vehicles, and all other records. This action is IRREVERSIBLE. Are you absolutely sure?",
            yesText: "Yes, Delete Everything",
            cancelText: "Cancel");
        
        if (result != true) return;
        
        _processing = true;
        _processingAction = "deleteall";
        StateHasChanged();
        
        try
        {
            var deleteResult = await DemoDataService.DeleteAllDataAsync();
            if (deleteResult)
            {
                Snackbar.Add("All data has been permanently deleted!", Severity.Success);
                _deleteConfirmText = "";
                await RefreshStats();
            }
            else
            {
                Snackbar.Add("Failed to delete all data", Severity.Error);
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error: {ex.Message}", Severity.Error);
        }
        finally
        {
            _processing = false;
            _processingAction = "";
        }
    }
}
