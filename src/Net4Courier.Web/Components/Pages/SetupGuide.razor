@page "/setup-guide"
@using MudBlazor
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>First-Time Setup Guide</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="py-4">
    <MudPaper Elevation="2" Class="pa-6 mb-4">
        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Class="mb-4">
            <MudStack>
                <MudText Typo="Typo.h4">First-Time System Setup Guide</MudText>
                <MudText Typo="Typo.subtitle1" Color="Color.Secondary">Complete these steps before starting operations</MudText>
            </MudStack>
            <MudChip T="string" Color="Color.Info" Size="Size.Large">@GetProgressText()</MudChip>
        </MudStack>

        <MudAlert Severity="Severity.Warning" Class="mb-4" Icon="@Icons.Material.Filled.Warning">
            <strong>Important:</strong> Follow each step in order. Do not skip steps. If a step is incomplete, fix it before moving ahead.
        </MudAlert>

        <MudStepper @bind-ActiveIndex="_activeStep" Linear="false" Color="Color.Primary" Vertical="true" Class="setup-stepper">
            @* Section 1: Company & Location Setup *@
            <MudStep Title="Company & Location Setup" Icon="@Icons.Material.Filled.Business">
                <ChildContent>
                    <MudText Typo="Typo.subtitle2" Color="Color.Secondary" Class="mb-3">This defines who you are and where you operate.</MudText>
                    
                    <MudExpansionPanels MultiExpansion="true">
                        <MudExpansionPanel Text="Step 1.1 - Company Profile" IsInitiallyExpanded="true">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Settings → Organization → Company Settings</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">Company name & logo</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">Address & contact details</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">Tax registration numbers</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">Default currency</MudListItem>
                                </MudList>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small" 
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/tenant-settings"))">Go to Company Settings</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 1.2 - Branches">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Settings → Organization → Branches</MudText>
                                <MudText>Create all operating branches:</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem Icon="@Icons.Material.Filled.Store">Head office</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.Store">Origin branches</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.Store">Destination branches</MudListItem>
                                </MudList>
                                <MudAlert Severity="Severity.Warning" Dense="true">Every shipment must belong to a branch.</MudAlert>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/branches"))">Go to Branches</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 1.3 - Warehouses / Hubs">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Settings → Organization → Warehouses</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem Icon="@Icons.Material.Filled.Warehouse">Assign each warehouse to a branch</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.Warehouse">Mark hub type (Origin / Destination / Transit)</MudListItem>
                                </MudList>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/warehouses"))">Go to Warehouses</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 1.4 - Geography Masters">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Masters → Geography</MudText>
                                <MudText>Create in this exact order:</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem Icon="@Icons.Material.Filled.Public">1. Country</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.Map">2. State</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.LocationCity">3. City</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.LocationOn">4. Location / Pincode</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.Flight">5. Ports (if international)</MudListItem>
                                </MudList>
                                <MudAlert Severity="Severity.Error" Dense="true">Do not create shipments without location mapping.</MudAlert>
                                <MudStack Row="true" Spacing="2" Class="flex-wrap">
                                    <MudButton Variant="Variant.Outlined" Size="Size.Small" OnClick="@(() => Navigation.NavigateTo("/countries"))">Countries</MudButton>
                                    <MudButton Variant="Variant.Outlined" Size="Size.Small" OnClick="@(() => Navigation.NavigateTo("/states"))">States</MudButton>
                                    <MudButton Variant="Variant.Outlined" Size="Size.Small" OnClick="@(() => Navigation.NavigateTo("/cities"))">Cities</MudButton>
                                    <MudButton Variant="Variant.Outlined" Size="Size.Small" OnClick="@(() => Navigation.NavigateTo("/locations"))">Locations</MudButton>
                                    <MudButton Variant="Variant.Outlined" Size="Size.Small" OnClick="@(() => Navigation.NavigateTo("/ports"))">Ports</MudButton>
                                </MudStack>
                            </MudStack>
                        </MudExpansionPanel>
                    </MudExpansionPanels>
                </ChildContent>
            </MudStep>

            @* Section 2: Operations Masters *@
            <MudStep Title="Operations Masters" Icon="@Icons.Material.Filled.Build">
                <ChildContent>
                    <MudText Typo="Typo.subtitle2" Color="Color.Secondary" Class="mb-3">Defines how shipments move.</MudText>
                    
                    <MudExpansionPanels MultiExpansion="true">
                        <MudExpansionPanel Text="Step 2.1 - Service Configuration" IsInitiallyExpanded="true">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Masters → Operations → Service Types</MudText>
                                <MudText>Examples: Document, Parcel, Cargo</MudText>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/service-types"))">Go to Service Types</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 2.2 - Shipment Modes">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Masters → Operations → Shipment Modes</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem>Domestic</MudListItem>
                                    <MudListItem>Export</MudListItem>
                                    <MudListItem>Import</MudListItem>
                                    <MudListItem>Transhipment</MudListItem>
                                </MudList>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/shipment-modes"))">Go to Shipment Modes</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 2.3 - Inco Terms">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Masters → Operations → Inco Terms</MudText>
                                <MudText>Required for international shipments.</MudText>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/inco-terms"))">Go to Inco Terms</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 2.4 - Shipment Status Setup">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Masters → Operations → Status Management</MudText>
                                <MudText>Ensure all lifecycle statuses are created:</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem>Pickup Requested, Collected, Inscan</MudListItem>
                                    <MudListItem>Outscan, In Transit, Delivered</MudListItem>
                                    <MudListItem>RTO, Exceptions, etc.</MudListItem>
                                </MudList>
                                <MudAlert Severity="Severity.Warning" Dense="true">Statuses drive reports and billing.</MudAlert>
                                <MudStack Row="true" Spacing="2">
                                    <MudButton Variant="Variant.Outlined" Size="Size.Small" OnClick="@(() => Navigation.NavigateTo("/status-management"))">Status Management</MudButton>
                                    <MudButton Variant="Variant.Outlined" Size="Size.Small" OnClick="@(() => Navigation.NavigateTo("/status-event-mappings"))">Event Mappings</MudButton>
                                </MudStack>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 2.5 - Vehicles & Resources">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Masters → Operations → Vehicles</MudText>
                                <MudText>Register delivery and linehaul vehicles.</MudText>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/vehicles"))">Go to Vehicles</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 2.6 - AWB Stock">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Masters → Operations → AWB Stock Management</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem Icon="@Icons.Material.Filled.QrCode">Upload system AWB ranges</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.QrCode">Configure customer AWB (if applicable)</MudListItem>
                                </MudList>
                                <MudAlert Severity="Severity.Error" Dense="true">No AWB = No shipment creation.</MudAlert>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/awb-stock"))">Go to AWB Stock</MudButton>
                            </MudStack>
                        </MudExpansionPanel>
                    </MudExpansionPanels>
                </ChildContent>
            </MudStep>

            @* Section 3: Pricing & Commercial Setup *@
            <MudStep Title="Pricing & Commercial Setup" Icon="@Icons.Material.Filled.AttachMoney">
                <ChildContent>
                    <MudText Typo="Typo.subtitle2" Color="Color.Secondary" Class="mb-3">Without pricing, billing will fail.</MudText>
                    
                    <MudExpansionPanels MultiExpansion="true">
                        <MudExpansionPanel Text="Step 3.1 - Zone Categories" IsInitiallyExpanded="true">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Pricing → Zone Categories</MudText>
                                <MudText>Example: Zone A (Metro), Zone B (Non-metro), Zone C (Remote)</MudText>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/zone-categories"))">Go to Zone Categories</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 3.2 - Zone Matrix">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Pricing → Zone Matrix</MudText>
                                <MudText>Map: Origin → Destination → Zone</MudText>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/zone-matrix"))">Go to Zone Matrix</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 3.3 - Rate Cards">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Pricing → Rate Cards</MudText>
                                <MudText>Define:</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem>Weight slabs</MudListItem>
                                    <MudListItem>Service-wise rates</MudListItem>
                                    <MudListItem>Mode-wise pricing</MudListItem>
                                </MudList>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/rate-cards"))">Go to Rate Cards</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 3.4 - Additional Charges">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Pricing → Other Charges</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem>Fuel surcharge</MudListItem>
                                    <MudListItem>Special charges</MudListItem>
                                    <MudListItem>Discounts</MudListItem>
                                </MudList>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/other-charges"))">Go to Other Charges</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 3.5 - Rate Validation">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Pricing → Rate Simulator</MudText>
                                <MudText>Test multiple scenarios to validate rates.</MudText>
                                <MudAlert Severity="Severity.Error" Dense="true">If rate is incorrect → fix before operations.</MudAlert>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/rate-simulator"))">Go to Rate Simulator</MudButton>
                            </MudStack>
                        </MudExpansionPanel>
                    </MudExpansionPanels>
                </ChildContent>
            </MudStep>

            @* Section 4: Customer & Contract Setup *@
            <MudStep Title="Customer & Contract Setup" Icon="@Icons.Material.Filled.People">
                <ChildContent>
                    <MudText Typo="Typo.subtitle2" Color="Color.Secondary" Class="mb-3">Who you ship for and how you charge them.</MudText>
                    
                    <MudExpansionPanels MultiExpansion="true">
                        <MudExpansionPanel Text="Step 4.1 - Customer Master" IsInitiallyExpanded="true">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Customers → Customer List</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem>Legal name</MudListItem>
                                    <MudListItem>Address & billing details</MudListItem>
                                    <MudListItem>Default service type</MudListItem>
                                </MudList>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/customers"))">Go to Customers</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 4.2 - Contracts & SLAs">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Customers → SLA Agreements</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem>Assign rate card to customer</MudListItem>
                                    <MudListItem>Define SLA terms</MudListItem>
                                    <MudListItem>Set credit terms</MudListItem>
                                </MudList>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/sla-agreements"))">Go to SLA Agreements</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 4.3 - Credit & Payment Rules">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Customers → Customer Edit → Credit Settings</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem>Prepaid / Credit / COD</MudListItem>
                                    <MudListItem>Credit limit</MudListItem>
                                    <MudListItem>Payment cycle</MudListItem>
                                </MudList>
                            </MudStack>
                        </MudExpansionPanel>
                    </MudExpansionPanels>
                </ChildContent>
            </MudStep>

            @* Section 5: Finance & Accounting Setup *@
            <MudStep Title="Finance & Accounting Setup" Icon="@Icons.Material.Filled.AccountBalance">
                <ChildContent>
                    <MudText Typo="Typo.subtitle2" Color="Color.Secondary" Class="mb-3">Mandatory for invoicing and compliance.</MudText>
                    
                    <MudExpansionPanels MultiExpansion="true">
                        <MudExpansionPanel Text="Step 5.1 - Financial Year" IsInitiallyExpanded="true">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Finance → GL → Financial Periods</MudText>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/financial-periods"))">Go to Financial Periods</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 5.2 - Chart of Accounts">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Finance → GL → Chart of Accounts</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem>Revenue accounts</MudListItem>
                                    <MudListItem>Receivables</MudListItem>
                                    <MudListItem>Payables</MudListItem>
                                    <MudListItem>Expenses</MudListItem>
                                </MudList>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/gl/chart-of-accounts"))">Go to Chart of Accounts</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 5.3 - Tax Setup">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Masters → Finance → Tax Rates</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem>GST / VAT rates</MudListItem>
                                    <MudListItem>Tax slabs</MudListItem>
                                </MudList>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/tax-management"))">Go to Tax Rates</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 5.4 - Banks & Cash">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Finance → Cash & Bank → Bank Accounts</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem>Bank accounts</MudListItem>
                                    <MudListItem>Cash ledger</MudListItem>
                                </MudList>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/bank-accounts"))">Go to Bank Accounts</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 5.5 - Account Heads">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Masters → Finance → Account Heads</MudText>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/gl/chart-of-accounts"))">Go to Account Heads</MudButton>
                            </MudStack>
                        </MudExpansionPanel>
                    </MudExpansionPanels>
                </ChildContent>
            </MudStep>

            @* Section 6: Users & Access Control *@
            <MudStep Title="Users & Access Control" Icon="@Icons.Material.Filled.Security">
                <ChildContent>
                    <MudText Typo="Typo.subtitle2" Color="Color.Secondary" Class="mb-3">Who can do what.</MudText>
                    
                    <MudExpansionPanels MultiExpansion="true">
                        <MudExpansionPanel Text="Step 6.1 - Organization Structure" IsInitiallyExpanded="true">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Settings → User Management</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem>Departments</MudListItem>
                                    <MudListItem>Designations</MudListItem>
                                </MudList>
                                <MudStack Row="true" Spacing="2">
                                    <MudButton Variant="Variant.Outlined" Size="Size.Small" OnClick="@(() => Navigation.NavigateTo("/departments"))">Departments</MudButton>
                                    <MudButton Variant="Variant.Outlined" Size="Size.Small" OnClick="@(() => Navigation.NavigateTo("/designations"))">Designations</MudButton>
                                </MudStack>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 6.2 - Employees & Users">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Settings → User Management</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem>Create employees</MudListItem>
                                    <MudListItem>Create user accounts</MudListItem>
                                </MudList>
                                <MudStack Row="true" Spacing="2">
                                    <MudButton Variant="Variant.Outlined" Size="Size.Small" OnClick="@(() => Navigation.NavigateTo("/employees"))">Employees</MudButton>
                                    <MudButton Variant="Variant.Outlined" Size="Size.Small" OnClick="@(() => Navigation.NavigateTo("/users"))">Users</MudButton>
                                </MudStack>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 6.3 - Roles & Permissions">
                            <MudStack Spacing="2">
                                <MudText><strong>Menu:</strong> Settings → User Management → Roles</MudText>
                                <MudText>Assign appropriate roles:</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem>Administrator - Full access</MudListItem>
                                    <MudListItem>Operations - AWB, Pickup, Tracking</MudListItem>
                                    <MudListItem>Finance - Invoicing, Payments</MudListItem>
                                    <MudListItem>Courier - Delivery, POD, COD</MudListItem>
                                </MudList>
                                <MudAlert Severity="Severity.Warning" Dense="true">Never give full access to all users.</MudAlert>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/roles"))">Go to Roles</MudButton>
                            </MudStack>
                        </MudExpansionPanel>
                    </MudExpansionPanels>
                </ChildContent>
            </MudStep>

            @* Section 7: Final System Check *@
            <MudStep Title="Final System Check" Icon="@Icons.Material.Filled.FactCheck">
                <ChildContent>
                    <MudAlert Severity="Severity.Error" Class="mb-3">Do not skip this section. Test before going live.</MudAlert>
                    
                    <MudExpansionPanels MultiExpansion="true">
                        <MudExpansionPanel Text="Step 7.1 - Test Shipment" IsInitiallyExpanded="true">
                            <MudStack Spacing="2">
                                <MudText>Create a dummy shipment and complete the full cycle:</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem Icon="@Icons.Material.Filled.CheckBox">1. Create pickup request</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.CheckBox">2. Assign AWB</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.CheckBox">3. Inscan at origin</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.CheckBox">4. Create manifest & outscan</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.CheckBox">5. Deliver and capture POD</MudListItem>
                                    <MudListItem Icon="@Icons.Material.Filled.CheckBox">6. Generate invoice</MudListItem>
                                </MudList>
                                <MudButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.Add"
                                           OnClick="@(() => Navigation.NavigateTo("/awb-entry"))">Start Test Shipment</MudButton>
                            </MudStack>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="Step 7.2 - Verify Reports">
                            <MudStack Spacing="2">
                                <MudText>Verify these reports show correct data:</MudText>
                                <MudList T="string" Dense="true">
                                    <MudListItem>Shipment register</MudListItem>
                                    <MudListItem>Delivery report</MudListItem>
                                    <MudListItem>Invoice register</MudListItem>
                                </MudList>
                                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.OpenInNew"
                                           OnClick="@(() => Navigation.NavigateTo("/reports"))">Go to Reports</MudButton>
                            </MudStack>
                        </MudExpansionPanel>
                    </MudExpansionPanels>
                </ChildContent>
            </MudStep>

            @* Section 8: Go-Live Confirmation *@
            <MudStep Title="Go-Live Confirmation" Icon="@Icons.Material.Filled.RocketLaunch">
                <ChildContent>
                    <MudPaper Class="pa-4 mb-4" Style="background-color: #e8f5e9;">
                        <MudText Typo="Typo.h6" Color="Color.Success" Class="mb-3">Go-Live Checklist</MudText>
                        <MudList T="string" Dense="true">
                            <MudListItem Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">All masters created</MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">Rate calculator validated</MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">Test shipment successful</MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">Invoice generated correctly</MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">User roles verified</MudListItem>
                        </MudList>
                    </MudPaper>

                    <MudAlert Severity="Severity.Success" Icon="@Icons.Material.Filled.Celebration">
                        <strong>SYSTEM READY FOR DAILY OPERATIONS</strong>
                    </MudAlert>

                    <MudText Typo="Typo.h6" Class="mt-4 mb-2">What Happens Next</MudText>
                    <MudList T="string" Dense="true">
                        <MudListItem Icon="@Icons.Material.Filled.ArrowRight">Users follow Daily Operations Workflow</MudListItem>
                        <MudListItem Icon="@Icons.Material.Filled.ArrowRight">Admin monitors via dashboards</MudListItem>
                        <MudListItem Icon="@Icons.Material.Filled.ArrowRight">Finance closes billing cycles</MudListItem>
                    </MudList>

                    <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="mt-4"
                               StartIcon="@Icons.Material.Filled.PlayArrow"
                               OnClick="@(() => Navigation.NavigateTo("/operations-workflow"))">
                        View Operations Workflow Guide
                    </MudButton>
                </ChildContent>
            </MudStep>
        </MudStepper>
    </MudPaper>
</MudContainer>

@code {
    private int _activeStep = 0;
    private const int TotalSteps = 8;

    private string GetProgressText()
    {
        return $"Step {_activeStep + 1} of {TotalSteps}";
    }
}
