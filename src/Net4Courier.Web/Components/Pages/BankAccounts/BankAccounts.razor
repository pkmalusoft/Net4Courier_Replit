@page "/bank-accounts"

@using Net4Courier.Web.Services.CashBank
@using Net4Courier.Web.DTOs

@inject IBankAccountService BankAccountService
@inject NavigationManager Navigation
@inject ISnackbar Snackbar

<PageTitle>Bank Accounts</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Class="mt-4">
    <MudText Typo="Typo.h4" Class="mb-4">Bank Accounts</MudText>
    
    <MudPaper Class="pa-4">
        <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" Class="mb-4" OnClick="CreateNew">
            Add Bank Account
        </MudButton>

        @if (loading)
        {
            <MudProgressLinear Indeterminate="true" />
        }
        else if (!bankAccounts.Any())
        {
            <MudAlert Severity="Severity.Info">
                No bank accounts found. Click "Add Bank Account" to create one.
            </MudAlert>
        }
        else
        {
            <MudTable Items="@bankAccounts" Hover="true" Striped="true">
                <HeaderContent>
                    <MudTh>Account Number</MudTh>
                    <MudTh>Account Name</MudTh>
                    <MudTh>Bank Name</MudTh>
                    <MudTh>Currency</MudTh>
                    <MudTh>Status</MudTh>
                    <MudTh>Actions</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Account Number">@context.AccountNumber</MudTd>
                    <MudTd DataLabel="Account Name">@context.AccountName</MudTd>
                    <MudTd DataLabel="Bank Name">@context.BankName</MudTd>
                    <MudTd DataLabel="Currency">@context.Currency</MudTd>
                    <MudTd DataLabel="Status">
                        <MudChip T="string" Color="@(context.IsActive ? Color.Success : Color.Default)" Size="Size.Small">
                            @(context.IsActive ? "Active" : "Inactive")
                        </MudChip>
                    </MudTd>
                    <MudTd DataLabel="Actions">
                        <MudIconButton Icon="@Icons.Material.Filled.Edit" Size="Size.Small" OnClick="@(() => Edit(context.Id))" />
                    </MudTd>
                </RowTemplate>
            </MudTable>
        }
    </MudPaper>
</MudContainer>

@code {
    private List<BankAccountListDto> bankAccounts = new();
    private bool loading = true;

    private static readonly Guid TenantId = Guid.Parse("11111111-1111-1111-1111-111111111111");

    protected override async Task OnInitializedAsync()
    {
        try
        {
            bankAccounts = await BankAccountService.GetAllAsync(TenantId);
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error loading bank accounts: {ex.Message}", Severity.Error);
        }
        finally
        {
            loading = false;
        }
    }

    private void CreateNew()
    {
        Navigation.NavigateTo("/bank-accounts/new");
    }

    private void Edit(Guid id)
    {
        Navigation.NavigateTo($"/bank-accounts/edit/{id}");
    }
}
