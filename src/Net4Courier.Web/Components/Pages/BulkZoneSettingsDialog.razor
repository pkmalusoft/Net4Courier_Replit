@using MudBlazor
@using Net4Courier.Masters.Entities

<MudDialog>
    <DialogContent>
        <MudText Class="mb-4">Apply settings to @SelectedCount selected zone(s). Only checked fields will be applied.</MudText>
        
        <MudStack Spacing="3">
            <MudStack Row="true" AlignItems="AlignItems.Center">
                <MudCheckBox T="bool" @bind-Value="_settings.ApplyBaseWeight" Color="Color.Primary" />
                <MudNumericField T="decimal" @bind-Value="_settings.BaseWeight" Label="Base Weight (kg)" 
                                 Variant="Variant.Outlined" Margin="Margin.Dense" Disabled="@(!_settings.ApplyBaseWeight)"
                                 Format="N3" Style="flex:1" />
            </MudStack>

            <MudStack Row="true" AlignItems="AlignItems.Center">
                <MudCheckBox T="bool" @bind-Value="_settings.ApplyBaseRate" Color="Color.Primary" />
                <MudNumericField T="decimal" @bind-Value="_settings.BaseRate" Label="Base Rate" 
                                 Variant="Variant.Outlined" Margin="Margin.Dense" Disabled="@(!_settings.ApplyBaseRate)"
                                 Format="N2" Style="flex:1" />
            </MudStack>

            <MudStack Row="true" AlignItems="AlignItems.Center">
                <MudCheckBox T="bool" @bind-Value="_settings.ApplyMinCharge" Color="Color.Primary" />
                <MudNumericField T="decimal?" @bind-Value="_settings.MinCharge" Label="Min Charge" 
                                 Variant="Variant.Outlined" Margin="Margin.Dense" Disabled="@(!_settings.ApplyMinCharge)"
                                 Format="N2" Style="flex:1" Clearable="true" />
            </MudStack>

            <MudStack Row="true" AlignItems="AlignItems.Center">
                <MudCheckBox T="bool" @bind-Value="_settings.ApplyMaxCharge" Color="Color.Primary" />
                <MudNumericField T="decimal?" @bind-Value="_settings.MaxCharge" Label="Max Charge" 
                                 Variant="Variant.Outlined" Margin="Margin.Dense" Disabled="@(!_settings.ApplyMaxCharge)"
                                 Format="N2" Style="flex:1" Clearable="true" />
            </MudStack>

            <MudStack Row="true" AlignItems="AlignItems.Center">
                <MudCheckBox T="bool" @bind-Value="_settings.ApplyTaxPercent" Color="Color.Primary" />
                <MudNumericField T="decimal" @bind-Value="_settings.TaxPercent" Label="Tax %" 
                                 Variant="Variant.Outlined" Margin="Margin.Dense" Disabled="@(!_settings.ApplyTaxPercent)"
                                 Format="N2" Style="flex:1" />
            </MudStack>

            <MudStack Row="true" AlignItems="AlignItems.Center">
                <MudCheckBox T="bool" @bind-Value="_settings.ApplyTaxMode" Color="Color.Primary" />
                <MudSelect T="TaxMode" @bind-Value="_settings.TaxMode" Label="Tax Mode" 
                           Variant="Variant.Outlined" Margin="Margin.Dense" Disabled="@(!_settings.ApplyTaxMode)"
                           Style="flex:1">
                    <MudSelectItem T="TaxMode" Value="TaxMode.Inclusive">Inclusive</MudSelectItem>
                    <MudSelectItem T="TaxMode" Value="TaxMode.Exclusive">Exclusive</MudSelectItem>
                </MudSelect>
            </MudStack>
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="Submit" 
                   Disabled="@(!HasAnySelection)">Apply</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] private MudDialogInstance MudDialog { get; set; } = default!;
    [Parameter] public int SelectedCount { get; set; }

    private BulkZoneSettings _settings = new BulkZoneSettings();

    private bool HasAnySelection => _settings.ApplyBaseWeight || _settings.ApplyBaseRate || 
                                     _settings.ApplyMinCharge || _settings.ApplyMaxCharge ||
                                     _settings.ApplyTaxPercent || _settings.ApplyTaxMode;

    private void Cancel() => MudDialog.Cancel();
    private void Submit() => MudDialog.Close(DialogResult.Ok(_settings));

    public class BulkZoneSettings
    {
        public bool ApplyBaseWeight { get; set; }
        public decimal BaseWeight { get; set; } = 0.5m;
        
        public bool ApplyBaseRate { get; set; }
        public decimal BaseRate { get; set; } = 0m;
        
        public bool ApplyMinCharge { get; set; }
        public decimal? MinCharge { get; set; }
        
        public bool ApplyMaxCharge { get; set; }
        public decimal? MaxCharge { get; set; }
        
        public bool ApplyTaxPercent { get; set; }
        public decimal TaxPercent { get; set; } = 0m;
        
        public bool ApplyTaxMode { get; set; }
        public TaxMode TaxMode { get; set; } = TaxMode.Exclusive;
    }
}
