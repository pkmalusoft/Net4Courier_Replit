@using MudBlazor
@using Net4Courier.Operations.Entities

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">@(IsEdit ? "Edit AWB Stock" : "Add AWB Stock")</MudText>
    </TitleContent>
    <DialogContent>
        <MudForm @ref="_form">
            <MudGrid>
                <MudItem xs="12" md="6">
                    <MudSelect T="string" Label="Item Name" @bind-Value="Stock.ItemName"
                               Variant="Variant.Outlined" Required="true" RequiredError="Item name is required">
                        <MudSelectItem Value="@("AWB Book")">AWB Book</MudSelectItem>
                        <MudSelectItem Value="@("AWB Sticker")">AWB Sticker</MudSelectItem>
                        <MudSelectItem Value="@("AWB Roll")">AWB Roll</MudSelectItem>
                        <MudSelectItem Value="@("Other")">Other</MudSelectItem>
                    </MudSelect>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudSelect T="string" Label="Item Type" @bind-Value="Stock.ItemType"
                               Variant="Variant.Outlined">
                        <MudSelectItem Value="@("")">None</MudSelectItem>
                        <MudSelectItem Value="@("Domestic")">Domestic</MudSelectItem>
                        <MudSelectItem Value="@("International")">International</MudSelectItem>
                        <MudSelectItem Value="@("Express")">Express</MudSelectItem>
                    </MudSelect>
                </MudItem>
                <MudItem xs="12">
                    <MudTextField @bind-Value="Stock.ReferenceNo" Label="Reference No."
                                  Variant="Variant.Outlined" />
                </MudItem>
                <MudItem xs="12" md="4">
                    <MudNumericField @bind-Value="Stock.Qty" Label="Qty" Min="1"
                                     Variant="Variant.Outlined" Required="true" />
                </MudItem>
                <MudItem xs="12" md="4">
                    <MudNumericField @bind-Value="Stock.Rate" Label="Rate" Format="N2"
                                     Variant="Variant.Outlined" />
                </MudItem>
                <MudItem xs="12" md="4">
                    <MudNumericField Value="@(Stock.Qty * Stock.Rate)" Label="Amount" Format="N2"
                                     Variant="Variant.Outlined" ReadOnly="true" />
                </MudItem>
                <MudItem xs="12" md="4">
                    <MudNumericField @bind-Value="Stock.AWBCount" Label="AWB Count" Min="1"
                                     Variant="Variant.Outlined" Required="true" />
                </MudItem>
                <MudItem xs="12" md="4">
                    <MudTextField @bind-Value="Stock.AWBNoFrom" Label="AWB NO. From"
                                  Variant="Variant.Outlined" Required="true" RequiredError="AWB From is required" />
                </MudItem>
                <MudItem xs="12" md="4">
                    <MudTextField @bind-Value="Stock.AWBNoTo" Label="AWB NO. To"
                                  Variant="Variant.Outlined" Required="true" RequiredError="AWB To is required" />
                </MudItem>
                <MudItem xs="12">
                    <MudTextField @bind-Value="Stock.Remarks" Label="Remarks" Lines="2"
                                  Variant="Variant.Outlined" />
                </MudItem>
            </MudGrid>
        </MudForm>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="Submit">Save</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] private MudDialogInstance MudDialog { get; set; } = default!;
    
    [Parameter] public AWBStock Stock { get; set; } = new();
    [Parameter] public bool IsEdit { get; set; }
    
    private MudForm? _form;
    
    private async Task Submit()
    {
        if (_form != null)
        {
            await _form.Validate();
            if (!_form.IsValid) return;
        }
        
        Stock.Amount = Stock.Qty * Stock.Rate;
        MudDialog.Close(DialogResult.Ok(Stock));
    }
    
    private void Cancel() => MudDialog.Cancel();
}
