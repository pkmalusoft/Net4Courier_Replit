@page "/gl/profile"
@using Net4Courier.Web.Services
@inject ISnackbar Snackbar

<PageTitle>GL Profile Settings</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
    <MudPaper Class="pa-6" Elevation="2">
        <MudText Typo="Typo.h4" Class="mb-2">General Ledger Profile</MudText>
        <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-6">
            Configure core GL settings, account structure, and default behaviors
        </MudText>

        <MudTabs Elevation="0" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6">
            <MudTabPanel Text="Account Structure">
                <MudGrid>
                    <MudItem xs="12" md="6">
                        <MudTextField @bind-Value="accountCodeLength" Label="Account Code Length" Type="number"
                                     Variant="Variant.Outlined" HelperText="Number of digits in account codes" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudSelect @bind-Value="accountCodeFormat" Label="Code Format" Variant="Variant.Outlined">
                            <MudSelectItem Value="@("Numeric")">Numeric Only (e.g., 1000)</MudSelectItem>
                            <MudSelectItem Value="@("Alphanumeric")">Alphanumeric (e.g., A1000)</MudSelectItem>
                            <MudSelectItem Value="@("Hierarchical")">Hierarchical (e.g., 1000.100.10)</MudSelectItem>
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudNumericField @bind-Value="accountLevels" Label="Account Hierarchy Levels"
                                        Variant="Variant.Outlined" Min="1" Max="5" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudSwitch @bind-Value="autoGenerateCodes" Label="Auto-generate Account Codes" Color="Color.Primary" />
                    </MudItem>
                </MudGrid>
            </MudTabPanel>

            <MudTabPanel Text="Fiscal Settings">
                <MudGrid>
                    <MudItem xs="12" md="6">
                        <MudSelect @bind-Value="fiscalYearStart" Label="Fiscal Year Start Month" Variant="Variant.Outlined">
                            <MudSelectItem Value="@(1)">January</MudSelectItem>
                            <MudSelectItem Value="@(4)">April</MudSelectItem>
                            <MudSelectItem Value="@(7)">July</MudSelectItem>
                            <MudSelectItem Value="@(10)">October</MudSelectItem>
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudSelect @bind-Value="periodType" Label="Period Type" Variant="Variant.Outlined">
                            <MudSelectItem Value="@("Monthly")">Monthly (12 periods)</MudSelectItem>
                            <MudSelectItem Value="@("Quarterly")">Quarterly (4 periods)</MudSelectItem>
                            <MudSelectItem Value="@("Custom")">Custom periods</MudSelectItem>
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudSwitch @bind-Value="allowPostToClosedPeriod" Label="Allow Posting to Soft-Closed Periods" Color="Color.Warning" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudSwitch @bind-Value="requirePeriodSelection" Label="Require Period Selection on Entry" Color="Color.Primary" />
                    </MudItem>
                </MudGrid>
            </MudTabPanel>

            <MudTabPanel Text="Posting Rules">
                <MudGrid>
                    <MudItem xs="12" md="6">
                        <MudSwitch @bind-Value="requireNarration" Label="Require Narration on All Entries" Color="Color.Primary" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudSwitch @bind-Value="allowUnbalancedEntries" Label="Allow Unbalanced Journal Entries (Draft)" Color="Color.Warning" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudSwitch @bind-Value="autoPostRecurring" Label="Auto-post Recurring Entries" Color="Color.Primary" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudSwitch @bind-Value="requireApproval" Label="Require Approval for Large Entries" Color="Color.Primary" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudNumericField @bind-Value="approvalThreshold" Label="Approval Threshold Amount"
                                        Variant="Variant.Outlined" Disabled="@(!requireApproval)" />
                    </MudItem>
                </MudGrid>
            </MudTabPanel>

            <MudTabPanel Text="Currency">
                <MudGrid>
                    <MudItem xs="12" md="6">
                        <MudSelect @bind-Value="baseCurrency" Label="Base Currency" Variant="Variant.Outlined">
                            <MudSelectItem Value="@("USD")">USD - US Dollar</MudSelectItem>
                            <MudSelectItem Value="@("AED")">AED - UAE Dirham</MudSelectItem>
                            <MudSelectItem Value="@("EUR")">EUR - Euro</MudSelectItem>
                            <MudSelectItem Value="@("GBP")">GBP - British Pound</MudSelectItem>
                            <MudSelectItem Value="@("INR")">INR - Indian Rupee</MudSelectItem>
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudSwitch @bind-Value="enableMultiCurrency" Label="Enable Multi-Currency" Color="Color.Primary" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudSelect @bind-Value="exchangeRateType" Label="Default Exchange Rate Type" 
                                  Variant="Variant.Outlined" Disabled="@(!enableMultiCurrency)">
                            <MudSelectItem Value="@("Spot")">Spot Rate</MudSelectItem>
                            <MudSelectItem Value="@("Average")">Average Rate</MudSelectItem>
                            <MudSelectItem Value="@("Fixed")">Fixed Rate</MudSelectItem>
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudSwitch @bind-Value="autoRevaluation" Label="Enable Auto Currency Revaluation" 
                                  Color="Color.Primary" Disabled="@(!enableMultiCurrency)" />
                    </MudItem>
                </MudGrid>
            </MudTabPanel>

            <MudTabPanel Text="Reporting">
                <MudGrid>
                    <MudItem xs="12" md="6">
                        <MudSelect @bind-Value="defaultReportFormat" Label="Default Report Format" Variant="Variant.Outlined">
                            <MudSelectItem Value="@("PDF")">PDF</MudSelectItem>
                            <MudSelectItem Value="@("Excel")">Excel</MudSelectItem>
                            <MudSelectItem Value="@("CSV")">CSV</MudSelectItem>
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudSwitch @bind-Value="showZeroBalanceAccounts" Label="Show Zero Balance Accounts in Reports" Color="Color.Primary" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudSwitch @bind-Value="includeNotes" Label="Include Notes in Financial Statements" Color="Color.Primary" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudSwitch @bind-Value="comparativePeriods" Label="Show Comparative Periods by Default" Color="Color.Primary" />
                    </MudItem>
                </MudGrid>
            </MudTabPanel>
        </MudTabs>

        <MudDivider Class="my-4" />

        <div class="d-flex justify-end gap-2">
            <MudButton Variant="Variant.Text" Color="Color.Default">Reset to Defaults</MudButton>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="SaveSettings">Save Settings</MudButton>
        </div>
    </MudPaper>
</MudContainer>

@code {
    private int accountCodeLength = 4;
    private string accountCodeFormat = "Numeric";
    private int accountLevels = 3;
    private bool autoGenerateCodes = true;
    
    private int fiscalYearStart = 4;
    private string periodType = "Monthly";
    private bool allowPostToClosedPeriod = false;
    private bool requirePeriodSelection = true;
    
    private bool requireNarration = true;
    private bool allowUnbalancedEntries = false;
    private bool autoPostRecurring = true;
    private bool requireApproval = false;
    private decimal approvalThreshold = 100000m;
    
    private string baseCurrency = "AED";
    private bool enableMultiCurrency = true;
    private string exchangeRateType = "Spot";
    private bool autoRevaluation = false;
    
    private string defaultReportFormat = "PDF";
    private bool showZeroBalanceAccounts = false;
    private bool includeNotes = true;
    private bool comparativePeriods = true;

    private async Task SaveSettings()
    {
        await Task.Delay(500);
        Snackbar.Add("GL Profile settings saved successfully", Severity.Success);
    }
}
