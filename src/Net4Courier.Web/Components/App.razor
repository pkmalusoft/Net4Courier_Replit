<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <link href="lib/mudblazor/MudBlazor.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="Net4Courier.Web.styles.css" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <HeadOutlet @rendermode="InteractiveServer" />
    <style>
        /* Fix for MudBlazor popover in iframe environments (Replit) */
        .mud-popover-provider {
            position: absolute !important;
        }
        .mud-popover-fixed {
            position: absolute !important;
        }
        .mud-popover {
            position: absolute !important;
        }
        /* Ensure popover container is relative */
        .mud-popover-cascading-value {
            position: relative;
        }
    </style>
</head>

<body>
    <Routes @rendermode="InteractiveServer" />
    <script src="_framework/blazor.web.js"></script>
    <script src="lib/mudblazor/MudBlazor.min.js"></script>
    <script>
        // Diagnostic: Monitor MudBlazor popover positioning
        (function() {
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    mutation.addedNodes.forEach((node) => {
                        if (node.nodeType === 1) {
                            // Check for popover elements
                            if (node.classList && (node.classList.contains('mud-popover') || node.classList.contains('mud-popover-open'))) {
                                logPopoverDiagnostics(node, 'Added');
                            }
                            // Also check children
                            const popovers = node.querySelectorAll ? node.querySelectorAll('.mud-popover, .mud-popover-open') : [];
                            popovers.forEach(p => logPopoverDiagnostics(p, 'Child added'));
                        }
                    });
                });
            });
            
            observer.observe(document.body, { childList: true, subtree: true });
            
            function logPopoverDiagnostics(popover, event) {
                const rect = popover.getBoundingClientRect();
                const styles = window.getComputedStyle(popover);
                
                console.group('[POPOVER DIAGNOSTIC] ' + event);
                console.log('Element:', popover);
                console.log('Classes:', popover.className);
                console.log('BoundingRect:', {
                    top: rect.top,
                    left: rect.left,
                    width: rect.width,
                    height: rect.height
                });
                console.log('Computed styles:', {
                    position: styles.position,
                    top: styles.top,
                    left: styles.left,
                    transform: styles.transform,
                    zIndex: styles.zIndex
                });
                
                // Check for transform on ancestors
                let parent = popover.parentElement;
                let transformFound = false;
                while (parent && parent !== document.body) {
                    const parentStyles = window.getComputedStyle(parent);
                    if (parentStyles.transform !== 'none') {
                        console.warn('TRANSFORM FOUND on ancestor:', parent, 'transform:', parentStyles.transform);
                        transformFound = true;
                    }
                    if (parentStyles.filter !== 'none') {
                        console.warn('FILTER FOUND on ancestor:', parent, 'filter:', parentStyles.filter);
                    }
                    parent = parent.parentElement;
                }
                if (!transformFound) {
                    console.log('No transform found on ancestors');
                }
                console.groupEnd();
            }
            
            console.log('[POPOVER DIAGNOSTIC] Observer installed');
        })();
    </script>
</body>

</html>
