Noted. Below is the **formal refinement to MAWB Processing rules**, explicitly excluding **On-Hold shipments**, and aligned with both **manual selection** and **barcode scanning** workflows.

---

## 21. On-Hold Shipment Exclusion Rules (Mandatory)

### 21.1 Definition of “On Hold” Shipment

A shipment is considered **On Hold** when:

* Shipment Status = **On Hold**
* OR Hold Flag = TRUE
* OR Hold Reason exists (Customs Hold, Payment Pending, Address Issue, Documentation Missing, Compliance Hold, etc.)

> Any of the above conditions qualifies the shipment as **ineligible** for MAWB / Bagging.

---

## 22. Eligibility Criteria – Final (Consolidated)

A shipment is **eligible for MAWB inclusion** only if **ALL** conditions are met:

1. Origin = MAWB Origin
2. Destination = MAWB Destination
3. Shipment is **not already assigned** to any MAWB
4. Shipment is **not already assigned** to any Bag
5. Shipment Status ∈

   * Shipment Collected
   * Inscan – Received at Warehouse
   * Processing at Warehouse
6. **Shipment Status ≠ On Hold**
7. Hold Flag = FALSE

---

## 23. Manual Selection Screen – Behavior Update

### 23.1 Shipment Listing Rules

* **On-Hold shipments must not be listed** at all by default
* Optional filter (Admin only): *“Show On-Hold Shipments”* (read-only)

### 23.2 Visual Safeguard (If Shown)

If on-hold shipments are displayed for audit:

* Disabled checkbox
* Status highlighted in red
* Tooltip showing hold reason

---

## 24. Barcode Scanning – Validation Update

### 24.1 Scan-Time Validation Rule (Hard Stop)

When an AWB barcode is scanned:

| Validation Step             | Result                 |
| --------------------------- | ---------------------- |
| AWB exists                  | Continue               |
| Route matches MAWB          | Continue               |
| Shipment already manifested | Reject                 |
| Shipment already bagged     | Reject                 |
| **Shipment is On Hold**     | **Reject (Hard Stop)** |

### 24.2 Error Message (Standardized)

> **“Shipment is on hold and cannot be manifested. Resolve hold before bagging.”**

* Audible error beep (optional)
* Shipment is **not added** to Bag or MAWB
* No partial update allowed

---

## 25. Status & Audit Handling

### 25.1 Shipment Status Integrity

* Scanning or manual selection **must not**:

  * Change On-Hold status
  * Bypass hold restrictions

### 25.2 Audit Log Entry (Rejected Attempt)

Log the following:

* AWB Number
* Attempted MAWB Number
* User ID
* Rejection Reason = *On Hold*
* Date & Time

---

## 26. MAWB Finalization Validation (Fail-Safe)

Before MAWB is finalized:

* System revalidates **all shipments**
* If **any shipment is found On Hold**:

  * MAWB finalization is blocked
  * System shows blocking message
  * User must remove affected shipment(s)

---

## 27. Operational Rationale (Why This Is Critical)

* Prevents customs violations
* Avoids airline rejection
* Ensures regulatory compliance
* Maintains shipment integrity across hubs
* Matches real-world courier SOPs

---

## 28. Summary Rule (For Developers & QA)

> **No shipment with On-Hold status or Hold flag may be added to a Bag or MAWB—by manual selection or barcode scanning—under any circumstance.**

---

If you want next, I can:

* Define **Hold Types & Resolution workflow**
* Add **role-based override rules (if any)**
* Provide **SQL / EF Core validation logic**
* Map **hold events into shipment timeline**

Tell me the next layer you want to lock down.
